var tokenKey="tk";var selectReply="txt";var sex={"0":"未知","1":"男","2":"女"};var topic={"0":"资讯","1":"奖报","2":"活动"};var msgStatus={"0":"待审核","1":"审核不通过","2":"审核通过"};var msgSendStatus={"0":"未发送","1":"发送中","2":"发送成功","3":"发送失败"};var formatStatus={"0":"未开奖","1":"未中奖","2":"已中奖"};var formatResult={"0":"主负","1":"平","3":"主胜"};var matchFlag={"0":"否","1":"是"};var ruleType={"0":"被添加自动回复","1":"消息自动回复","2":"关键词自动回复"};var flag="1";var topicNum=2;var awardLevel={"1":"一","2":"二","3":"三","4":"四","5":"五","6":"六","7":"七","8":"八","9":"九","10":"十"};var guessingType={"1":"得分","2":"三分球","3":"篮板","4":"助攻"};var activityType={"3":"绑定赠送","4":"拆红包"};var prizeLevel={"1":"一等奖","2":"二等奖","3":"三等奖","4":"四等奖","5":"五等奖","0":"六等奖"};function toLogin(){$.ajax({url:getPath()+"/manage/logout.do",dataType:"json",success:function(a){window.location=getPath()+"/html/loginwx.html"}})}function pageLoad(){var c=getCookie(tokenKey);if(c){var b=c.split("-")[1];var d=b.split("|")[0];if(d){var a=template("head",{username:decodeURI(d)});$("#menu").html(a);return}}window.location=getPath()+"/html/loginwx.html"}function switchSysBar(){var a=document.documentElement.clientWidth-10;if(switchPoint.innerHTML==3){switchPoint.innerHTML=4;document.all("left").style.width="0%";document.getElementById("switchPoint").className="left_io2"}else{switchPoint.innerHTML=3;document.all("left").style.width="198px";document.getElementById("switchPoint").className="left_io"}}function hasPermission(d){var c=getCookie(tokenKey);if(c){var b=c.split("-")[1];var a=b.split("|")[1];if(a){a=decodeURIComponent(a);if(a.indexOf(d)>-1){return true}}}return false}function showMenu(a){var b=getCookie(tokenKey);if(b){var e=b.split("-")[1];var k=e.split("|")[1];if(k){k=decodeURIComponent(k);if(k.indexOf(a)==-1){alert("没有权限");toLogin();return}var f=k.split(",");var c=a.substring(0,2);for(var d=0;d<f.length;d++){$("#m"+f[d]).show();var h=f[d].substring(0,2);$("#m"+h).show();if(c==h){var g=f[d].substring(0,4);$("#m"+g).show();$("#m"+g+"00").show()}}$("#m"+c).addClass("on");$("#m"+a).addClass("on")}}}function addMsg(){var d=document.getElementById("mid").value;var c="";for(var a=0;a<8;a++){var b=document.getElementById("s"+a);if(b){if(c.length>0){c+=","}c+=b.value}}if(c.length<10){alert("请先添加消息");return}$.ajax({type:"post",url:getPath()+"/manage/addmsg.do",data:"msg="+encodeURIComponent(c)+"&id="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e&&e.r=="no permission"){alert("没有权限")}else{if(e&&e.r=="timeout"){window.location=getPath()+"/html/loginwx.html"}else{if(e&&e.r=="ok"){alert("提交成功")}}}}})}function previewMsg(c){var b=document.getElementById(c);var a=window.open("");a.document.write("<html><body><br>"+b.innerHTML+"</body></html>");a.focus()}function loadMsg(){document.getElementById("mid").value="";document.getElementById("title").value="";document.getElementById("author").value="";document.getElementById("link").value="";document.getElementById("showpic").checked=false;document.getElementById("topic").options[0].selected=true;var b,a=location.search.substring(1,location.search.length);if(a.length>0){b=parseParam(a);var c=b.id;if(c){$.ajax({type:"post",url:getPath()+"/manage/searchmsg.do",data:"id="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(h){if(h&&h.r&&h.r.length>0){var k=JSON.parse(h.r[0].txt);document.getElementById("mid").value=c;document.getElementById("cnt").value=k.length;var e=document.getElementById("res");for(var d=0;d<k.length;d++){var g=e.insertRow(e.rows.length);g.setAttribute("id","a"+d);g.onmouseover=showEdit;g.onmouseout=hideEdit;var l=g.insertCell(g.cells.length);var f="<a name='au"+d+"'></a><input type='hidden' id='s"+d+"' value='"+JSON.stringify(k[d])+"'><br>";if(d==0){l.colSpan=2;f+="<img id='p"+d+"' src='"+downloadPath+k[d].thumb_media_id+"' width='288px' height='160px'><div id='t"+d+"'>"+k[d].title+"</div><div id='e"+d+"' style='visibility:hidden'><a href='javascript:editArticle("+d+")'>编辑</a></div>";l.innerHTML=f}else{l.innerHTML=f+"<div id='t"+d+"'>"+k[d].title+"</div><div id='e"+d+"' style='visibility:hidden'><a href='javascript:editArticle("+d+")'>编辑</a> <a href='javascript:delArticle("+d+")'>删除</a></div>";l=g.insertCell(g.cells.length);l.innerHTML="<img id='p"+d+"' src='"+downloadPath+k[d].thumb_media_id+"' width='78px' height='78px'>"}}}}})}}}function delMsg(b,a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/manage/delmsg.do",data:"id="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c&&c.r){if(c.r=="ok"){searchMsg(a)}else{alert(c.r)}}}})}}function searchsw(){var a=$.trim(document.getElementById("w").value);$.ajax({type:"post",url:getPath()+"/manage/searchsw.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e&&e.r=="no permission"){alert("没有权限");return}else{if(e&&e.r=="timeout"){window.location=getPath()+"/html/loginwx.html";return}}var d=document.getElementById("res"),c="";if(e==null||!(e.r instanceof Array)||e.r.length<1){c="没有设置敏感词"}else{var f=e.r;for(var b=0;b<f.length;b++){if(f[b]){c+="<label><input type='checkbox'> <input type='text' readonly style='border:0;color:";if(a.length>0&&f[b]==a){c+="red"}else{c+="black"}c+=";width:"+f[b].length*12+"px' value='"+f[b]+"'></label>&nbsp;&nbsp;"}}c+="<br><br><br><a href='javascript:modifysw()'>修改</a>&nbsp;&nbsp;<a href='javascript:delsw()'>删除</a>"}d.innerHTML=c}})}function addsw(a){var a=$.trim(document.getElementById("w").value);if(!a){alert("请填写敏感词");return}$.ajax({type:"post",url:getPath()+"/manage/addsw.do",data:"w="+encodeURIComponent(a),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b&&b.r){searchsw()}}})}function delsw(){var a="";$(":checked+input").each(function(){a+="w="+encodeURIComponent($(this).val())+"&"});if(a.length<2){alert("请选择要删除的敏感词");return}if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/manage/delsw.do",data:a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b&&b.r){searchsw()}}})}}function modifysw(){var c=$(":checked+input");if(c.length!=1){alert("请选择一个需要修改的敏感词");return}var b,a=prompt("请输入新的敏感词：","");if($.trim(a)){c.each(function(){b=$(this).val()});$.ajax({type:"post",url:getPath()+"/manage/modifysw.do",data:"w="+encodeURIComponent(b)+"&w2="+encodeURIComponent(a),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d&&d.r){searchsw()}}})}}function showApplyBox(b){var a=template("applyDialog",{id:b});showMessageBox("申请发送消息",a,500);groupSearch("msg")}function applySendMsg(c){var a=document.getElementById("groupChoose");var b=document.getElementById("planTime").value;$.ajax({type:"post",url:getPath()+"/manage/applysendmsg.do",data:"msg="+c+"&planTime="+b+"&receid="+a.value+"&recename="+a.options[a.selectedIndex].text,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){closeWindow();if(d&&d.r=="ok"){alert("提交成功")}}})}function upload(fileElementId,picId){if(!$("#"+fileElementId).val()){alert("请选择上传文件");return}var action="uploadimage";if(arguments.length>2&&arguments[2]==2){action="uploadmntpic"}$.ajaxFileUpload({url:getPath()+"/controller.jsp?action="+action,secureuri:false,fileElementId:fileElementId,dataType:"txt",success:function(data,status){eval("data = "+data);if(data.url){var picview=document.getElementById(picId);picview.innerHTML="<img src='"+data.url+"'>"}else{if(data.state){alert(data.state)}}}})}function addArticle(){var e=document.getElementById("aid").value;var a=document.getElementById("res");if(e==""&&a.rows.length>7){alert("最多只能添加8条");return}var u=document.getElementById("title").value;if(u==""){alert("请填写标题");return}var p=UE.getEditor("container");if(!p.hasContents()){alert("请填写正文");return}var m=$("#picview img:first-child");if(!m.length){alert("请上传封面");return}var g=p.getContent();var c=document.getElementById("author").value;var n=querySensitiveWord();if(checkSensitiveWord(u,n,"标题")){return}if(checkSensitiveWord(g,n,"正文")){return}if(c&&checkSensitiveWord(c,n,"作者")){return}var f=document.getElementById("link").value;var q=document.getElementById("topic").value;var o=0;if(document.getElementById("showpic").checked){o=1}var s=m.attr("src");var k={};k.thumb_media_id=getMediaPath(s);k.author=c;k.title=u;k.content_source_url=f;k.content=g;k.topic=q;k.show_cover_pic=o;var d=JSON.stringify(k);var r;if(e!=""){r=e;document.getElementById("s"+r).value=d;document.getElementById("p"+r).src=s;document.getElementById("t"+r).innerHTML=u;var v=document.getElementById("addButten");v.value="添加";v.title="添加这篇文章";document.getElementById("aid").value=""}else{if(a.rows.length==0){document.getElementById("cnt").value=0}r=document.getElementById("cnt").value;var b=a.insertRow(a.rows.length);b.setAttribute("id","a"+r);b.onmouseover=showEdit;b.onmouseout=hideEdit;var h=b.insertCell(b.cells.length);var l="<a name='au"+r+"'></a><input type='hidden' id='s"+r+"' value='"+d+"'><br>";if(r==0){h.colSpan=2;l+="<img id='p"+r+"' src='"+s+"' width='288px' height='160px'><div id='t"+r+"'>"+u+"</div><div id='e"+r+"' style='visibility:hidden'><a href='javascript:editArticle("+r+")'>编辑</a></div>";h.innerHTML=l}else{h.innerHTML=l+"<div id='t"+r+"'>"+u+"</div><div id='e"+r+"' style='visibility:hidden'><a href='javascript:editArticle("+r+")'>编辑</a> <a href='javascript:delArticle("+r+")'>删除</a></div>";h=b.insertCell(b.cells.length);h.innerHTML="<img id='p"+r+"' src='"+s+"' width='78px' height='78px'>"}document.getElementById("cnt").value=parseInt(r,10)+1}window.location="#au"+r;p.setContent("");document.getElementById("title").value="";document.getElementById("author").value="";document.getElementById("link").value="";document.getElementById("picview").innerHTML="";document.getElementById("showpic").checked=false;document.getElementById("topic").options[0].selected=true;document.getElementById("uppic").value=null}function querySensitiveWord(){var a=null;$.ajax({async:false,type:"post",url:getPath()+"/manage/searchsw.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b&&b.r){a=b.r}}});return a}function checkSensitiveWord(a,c,d){if(c){for(var b=0;b<c.length;b++){if(a.indexOf(c[b])>-1){alert(d+" 含有敏感词："+c[b]);return true}}}return false}function getMenu(){$.ajax({url:getPath()+"/manage/getmenu.do",dataType:"json",success:function(f){if(!f.menu){$("#res").html("没有设置菜单");return}var c=f.menu.button;var a=[];for(var d=0;d<c.length;d++){a[d]={};var h=c[d].name;if(c[d].url){h+=" ( "+c[d].url+" )"}a[d].text=h;var e=c[d].sub_button;if(e&&e.length>0){a[d].children=[];for(var b=0;b<e.length;b++){a[d].children[b]={};var g=e[b].name;if(e[b].url){g+=" ( "+e[b].url+" )"}a[d].children[b].text=g}}}$("#res").jstree({core:{data:a}})}})}function showEdit(){var a=document.getElementById(arguments[0]);if(!a){a=document.getElementById("e"+this.id.substring(1))}a.style.visibility="visible"}function hideEdit(){var a=document.getElementById(arguments[0]);if(!a){a=document.getElementById("e"+this.id.substring(1))}a.style.visibility="hidden"}function editArticle(e){document.getElementById("aid").value=e;var b=document.getElementById("addButten");b.value="修改";b.title="修改这篇文章";var k=document.getElementById("s"+e).value;var c=JSON.parse(k);document.getElementById("title").value=c.title;document.getElementById("author").value=c.author;document.getElementById("link").value=c.content_source_url;var h=document.getElementById("showpic");if(c.show_cover_pic==1){h.checked=true}else{h.checked=false}var f=document.getElementById("topic").options;for(var d=0;d<f.length;d++){if(f[d].value==c.topic){f[d].selected=true;break}}var a=document.getElementById("picview");a.innerHTML="<img src='"+document.getElementById("p"+e).src+"'>";var g=UE.getEditor("container");g.ready(function(){g.setContent(c.content)})}function delArticle(a){$("#a"+a).remove()}function getMediaPath(d){var c=d;var a=0;for(var b=0;b<3;b++){a=c.lastIndexOf("/");c=c.substring(0,a)}return d.substring(a+1)}function searchMsg(a){showRunning(8);var c=document.getElementById("title").value;var b=document.getElementById("author").value;$.ajax({type:"post",url:getPath()+"/manage/searchmsg.do",data:"title="+c+"&author="+b+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d&&d.r=="no permission"){alert("没有权限")}else{if(d&&d.r=="timeout"){window.location=getPath()+"/html/loginwx.html"}else{searchMsgCallback(d)}}}})}function searchMsgCallback(dt){var tr,td,i;var tbody=document.getElementById("res");while(tbody.rows.length>0){tbody.removeChild(tbody.firstChild)}if(dt==null||!(dt.r instanceof Array)||dt.r.length<1){drawPages(0,"searchMsg",0);tr=tbody.insertRow(tbody.rows.length);td=tr.insertCell(tr.cells.length);td.colSpan=8;td.innerHTML=noRecord;tr.style.height="200px"}else{drawPages(dt.c,"searchMsg",dt.s);var data=dt.r;var exData=dt.x;for(i=0;i<data.length;i++){if(data[i]!=null){var j;eval("j="+data[i].txt);tr=tbody.insertRow(tbody.rows.length);tr.className="td_int";td=tr.insertCell(tr.cells.length);td.innerHTML=data[i].id;td=tr.insertCell(tr.cells.length);var asso=getAssociative(exData,data[i].id);var asso1=asso.length;td.innerHTML=asso[0];if(asso1>1){td.title=asso[1]}td=tr.insertCell(tr.cells.length);if(j.length>1){td.innerHTML="多图文"}else{td.innerHTML="单图文"}td=tr.insertCell(tr.cells.length);td.className="td_left";var t='<table cellspacing="0" cellpadding="0">';for(var m=0;m<j.length;m++){t+="<tr><td ";if(m==j.length-1){t+='style="border-bottom:none"'}t+=">"+topic[j[m].topic]+"</td></tr>"}t+="</table>";td.innerHTML=t;td=tr.insertCell(tr.cells.length);td.className="td_left";var t='<table cellspacing="0" cellpadding="0">';for(var m=0;m<j.length;m++){t+="<tr><td ";if(m==j.length-1){t+='style="border-bottom:none"'}t+="><a href=\"javascript:previewMsg('x"+i+"-"+m+"')\">"+j[m].title+'</a><span id="x'+i+"-"+m+'" style="display:none">';if(j[m].show_cover_pic==1){t+="<img src='"+downloadPath+j[m].thumb_media_id+"' width='288px' height='160px'><br><br>"}t+=j[m].content+"</span></td></tr>"}t+="</table>";td.innerHTML=t;td=tr.insertCell(tr.cells.length);td.className="td_left";var t='<table cellspacing="0" cellpadding="0">';for(var m=0;m<j.length;m++){t+="<tr><td ";if(m==j.length-1){t+='style="border-bottom:none"'}t+=">"+j[m].author+"&nbsp;</td></tr>"}t+="</table>";td.innerHTML=t;td=tr.insertCell(tr.cells.length);td.innerHTML=formatDate(data[i].createTime);td=tr.insertCell(tr.cells.length);var t="";if(hasPermission("010102")){t+='<a href="javascript:modifyMsg('+data[i].id+","+asso1+')"><img src="../imgs/xiugai.png" title="修改消息"/></a>';if(asso1==1){t+=' <a href="javascript:delMsg('+data[i].id+","+dt.s+')"><img src="../imgs/shanchu.png" title="删除消息"/></a>'}t+=' <a href="javascript:showApplyBox('+data[i].id+')"><img src="../imgs/mima.png" title="申请发送消息"/></a>'}td.innerHTML=t}}}}function modifyMsg(b,a){if(a>1){if(confirm("该消息已关联，确认修改？")){window.location=getPath()+"/html/addmsg.html?id="+b}}else{window.location=getPath()+"/html/addmsg.html?id="+b}}function getAssociative(c,d){var b="";if(c){for(var a=0;a<c.length;a++){if(c[a].msg==d){b+=ruleType[c[a].type];if(c[a].keyword){b+=" ( "+c[a].keyword+" )"}b+="\n"}}}if(b.length<1){return["未关联"]}return["关联","已关联\n"+b]}function rmSpChar(a){return a.replace(/[%&;_]/g,"")}function rmSpChar2(a){return a.replace(/[%&]/g,"")}function searchLog(c){showRunning(9);var e=document.getElementById("title").value;var d=document.getElementById("author").value;var a=document.getElementById("status1").value;var b=document.getElementById("status2").value;$.ajax({type:"post",url:getPath()+"/manage/searchlog.do",data:"title="+e+"&author="+d+"&startIdx="+c+"&status="+a+"&sendStatus="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f&&f.r=="no permission"){alert("没有权限")}else{if(f&&f.r=="timeout"){window.location=getPath()+"/html/loginwx.html"}else{searchLogCallback(f)}}}})}function searchLogCallback(dt){var tr,td,i;var tbody=document.getElementById("res");while(tbody.rows.length>0){tbody.removeChild(tbody.firstChild)}if(dt==null||!(dt.r instanceof Array)||dt.r.length<1){drawPages(0,"searchLog",0);tr=tbody.insertRow(tbody.rows.length);td=tr.insertCell(tr.cells.length);td.colSpan=9;td.innerHTML=noRecord;tr.style.height="200px"}else{drawPages(dt.c,"searchLog",dt.s);var data=dt.r;for(i=0;i<data.length;i++){if(data[i]!=null){var j;eval("j="+data[i].txt);tr=tbody.insertRow(tbody.rows.length);tr.className="td_int";td=tr.insertCell(tr.cells.length);if(j.length>1){td.innerHTML="多图文"}else{td.innerHTML="单图文"}td=tr.insertCell(tr.cells.length);td.className="td_left";var t='<table cellspacing="0" cellpadding="0">';for(var m=0;m<j.length;m++){t+="<tr><td ";if(m==j.length-1){t+='style="border-bottom:none"'}t+=">"+topic[j[m].topic]+"</td></tr>"}t+="</table>";td.innerHTML=t;td=tr.insertCell(tr.cells.length);td.className="td_left";var t='<table cellspacing="0" cellpadding="0">';for(var m=0;m<j.length;m++){t+="<tr><td ";if(m==j.length-1){t+='style="border-bottom:none"'}t+="><a href=\"javascript:previewMsg('x"+i+"-"+m+"')\">"+j[m].title+'</a><span id="x'+i+"-"+m+'" style="display:none">';if(j[m].show_cover_pic==1){t+="<img src='"+downloadPath+j[m].thumb_media_id+"' width='288px' height='160px'><br><br>"}t+=j[m].content+"</span></td></tr>"}t+="</table>";td.innerHTML=t;td=tr.insertCell(tr.cells.length);td.className="td_left";var t='<table cellspacing="0" cellpadding="0">';for(var m=0;m<j.length;m++){t+="<tr><td ";if(m==j.length-1){t+='style="border-bottom:none"'}t+=">"+j[m].author+"&nbsp;</td></tr>"}t+="</table>";td.innerHTML=t;td=tr.insertCell(tr.cells.length);td.innerHTML=formatDate(data[i].submitTime);td=tr.insertCell(tr.cells.length);if(data[i].planTime){td.innerHTML=formatDate(data[i].planTime)}if(data[i].sendTime){td.title="实际发送时间："+formatDate(data[i].sendTime)}td=tr.insertCell(tr.cells.length);td.innerHTML=data[i].receiverName;td=tr.insertCell(tr.cells.length);td.innerHTML=msgStatus[data[i].status]+msgSendStatus[data[i].sendStatus];if(data[i].status==1){td.title=data[i].remark}td=tr.insertCell(tr.cells.length);var t="";if(data[i].status==0){t='<a href="javascript:auditMsg('+data[i].id+","+dt.s+')"><img src="../imgs/mima.png" title="审核发送消息"/></a>'}td.innerHTML=t}}}}function auditMsg(c,b){var a=template("auditDialog",{id:c,sidx:b});showMessageBox("审核",a,500)}function auditPass(b,a){document.getElementById("p").disabled=true;document.getElementById("f").disabled=true;document.getElementById("msg").innerHTML=this.running1+getPath()+this.running2;$.ajax({type:"post",url:getPath()+"/manage/sendmsg.do",data:"msg="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){closeWindow();searchLog(a);if(c.r!="ok"){alert(c.r)}}})}function auditFail(c,a){var b=$.trim(document.getElementById("reason").value);if(b.length<1){alert("请填写理由");return}document.getElementById("p").disabled=true;document.getElementById("f").disabled=true;document.getElementById("msg").innerHTML=this.running1+getPath()+this.running2;$.ajax({type:"post",url:getPath()+"/manage/updlog.do",data:"msg="+c+"&remark="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){closeWindow();if(d&&d.r=="ok"){searchLog(a)}}})}function searchAccount(a){showRunning(5);$.ajax({type:"post",url:getPath()+"/manage/searchaccount.do",data:"startIdx="+a,dataType:"json",success:function(b){if(b&&b.r=="timeout"){window.location=getPath()+"/html/loginwx.html"}else{searchAccountCallback(b)}}})}function searchRole(){$.ajax({type:"post",url:getPath()+"/manage/searchrole.do",dataType:"json",success:function(e){if(e&&e.r=="no permission"){alert("没有权限");return}else{if(e&&e.r=="timeout"){window.location=getPath()+"/html/loginwx.html";return}}if(e){var g=document.getElementById("role");if(g){for(var c=0;c<e.length;c++){g.options[g.options.length]=new Option(e[c].roleName,e[c].id,false,false)}return}var d,f,c,a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}for(c=0;c<e.length;c++){d=a.insertRow(a.rows.length);d.className="td_int";f=d.insertCell(d.cells.length);f.innerHTML=e[c].id;f=d.insertCell(d.cells.length);f.innerHTML=e[c].roleName;f=d.insertCell(d.cells.length);f.innerHTML=e[c].privilege;f=d.insertCell(d.cells.length);var b="";if(hasPermission("070104")&&e[c].id!=1){b+='<a href="addrole?id='+e[c].id+'"><img src="../imgs/xiugai.png" title="修改"/></a>';b+=' <a href="delRole('+e[c].id+')"><img src="../imgs/shanchu.png" title="删除"/></a>'}f.innerHTML=b}}}})}function addAccount(){var e=document.getElementById("mid").value;var a=$.trim(document.getElementById("name").value);if(a.length<1){alert("请填写用户名");return}var c=$.trim(document.getElementById("info").value);var d=document.getElementById("role").value;var b=document.getElementById("provice").value;$.ajax({type:"post",url:getPath()+"/manage/addaccount.do",data:"name="+encodeURIComponent(a)+"&roleId="+d+"&info="+encodeURIComponent(c)+"&id="+e+"&provice="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f&&f.r=="no permission"){alert("没有权限")}else{if(f&&f.r=="timeout"){window.location=getPath()+"/html/loginwx.html"}else{if(f&&f.r=="ok"){alert("提交成功")}else{alert(f.r)}}}}})}function loadAccount(){document.getElementById("mid").value="";document.getElementById("name").value="";document.getElementById("info").value="";var b,a=location.search.substring(1,location.search.length);if(a.length>0){b=parseParam(a);var c=b.id;if(c){$.ajax({type:"post",url:getPath()+"/manage/searchaccount.do",data:"id="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){if(g&&g.r&&g.r.length>0){document.getElementById("mid").value=c;document.getElementById("name").readOnly=true;document.getElementById("name").value=g.r[0].name;document.getElementById("info").value=g.r[0].info;var h=document.getElementById("role").options;var f=document.getElementById("provice").options;for(var d=0;d<h.length;d++){if(h[d].value==g.r[0].roleId){h[d].selected=true;break}}for(var e=0;e<f.length;e++){if(f[e].value==g.r[0].province){document.getElementById("provice").style.display="none";document.getElementById("provice1").style.display="";document.getElementById("provice1").value=f[e].text;break}}}}})}}}function modifyPwd(){var c=document.getElementById("pwd").value;var b=document.getElementById("pwd2").value;var a=document.getElementById("pwd3").value;if(!c){alert("请填写原密码");return}if(!b){alert("请填写新密码");return}if(!a){alert("请重复填写新密码");return}if(b!=a){alert("两次新密码不一致");return}$.ajax({type:"post",url:getPath()+"/manage/modifypd.do",data:"pd="+c+"&pd2="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d&&d.r){if(d.r=="ok"){alert("修改成功")}else{alert(d.r)}}}})}function delAccount(b,a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/manage/delaccount.do",data:"id="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c&&c.r){if(c.r=="ok"){searchAccount(a)}else{alert(c.r)}}}})}}function delRole(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/manage/delrole.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b&&b.r){if(b.r=="ok"){searchRole()}else{alert(b.r)}}}})}}function searchAccountCallback(a){var h,c,f;var g=document.getElementById("res");while(g.rows.length>0){g.removeChild(g.firstChild)}if(a==null||!(a.r instanceof Array)||a.r.length<1){drawPages(0,"searchAccount",0);h=g.insertRow(g.rows.length);c=h.insertCell(h.cells.length);c.colSpan=5;c.innerHTML=noRecord;h.style.height="200px"}else{drawPages(a.c,"searchAccount",a.s);var e=a.r;var b=document.getElementById("provice").options;for(f=0;f<e.length;f++){if(e[f]!=null){h=g.insertRow(g.rows.length);h.className="td_int";c=h.insertCell(h.cells.length);c.innerHTML=e[f].id;c=h.insertCell(h.cells.length);c.innerHTML=e[f].name;c=h.insertCell(h.cells.length);c.innerHTML=e[f].roleName;c=h.insertCell(h.cells.length);if(e[f].info){c.innerHTML=e[f].info}c=h.insertCell(h.cells.length);for(var d=0;d<b.length;d++){if(b[d].value==e[f].province){c.innerHTML=b[d].text;break}}c=h.insertCell(h.cells.length);var k="";if(hasPermission("070102")&&e[f].id!=1){k+='<a href="addaccount.html?id='+e[f].id+'"><img src="../imgs/xiugai.png" title="修改"/></a>';k+=' <a href="javascript:delAccount('+e[f].id+","+a.s+')"><img src="../imgs/shanchu.png" title="删除"/></a>'}c.innerHTML=k}}}}function syncUser(){$.ajax({type:"post",url:getPath()+"/manage/syncuser.do",dataType:"json",success:function(a){}});alert("提交成功，同步可能需要几分钟完成。")}function userSearch(n){showRunning(13);var p=document.getElementById("userName").value;var m=document.getElementById("sex").value;var r=document.getElementById("groupChoose").value;var c=document.getElementById("mobile");var o=document.getElementById("sign_status");var e=document.getElementById("startTime");var l=document.getElementById("endTime");var g=document.getElementById("province");var s=document.getElementById("sign_flag");var q=document.getElementById("reg_status");var b=document.getElementById("flag1");var a=document.getElementById("flag2");var k="userName="+p+"&sex="+m+"&group="+r+"&startIdx="+n;var f=document.getElementById("subscribeTime");var d=false;if(document.getElementById("flg")){d=document.getElementById("flg").value}if(d&&f){k+="&subscribeTime="+f.value}else{var h=document.getElementById("status").value;k+="&status="+h}if(b&&a){k+="&flag1="+b.value+"&flag2="+a.value}if(c){k+="&mobile="+c.value}if(o){k+="&sign_status="+o.value}if(e){k+="&startTime="+e.value}if(l){k+="&endTime="+l.value}if(g){k+="&province="+g.value}if(s){k+="&sign_flag="+s.value}if(q){k+="&reg_status="+q.value}$.ajax({type:"post",url:getPath()+"/manage/searchuser.do",data:k,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(t){userSearchCallback(t,d);if(document.getElementById("gflag").value!=1){groupSearch("user")}}})}function freezeJifen(){$("#freezeBtn").attr("disabled",true);var c=$("#freezeBtn").val();var a=null;if(c=="批量冻结"){a="f"}else{a="un"}var b=prompt("请输入"+c+"原因（必填）：","");if(b==null){$("#freezeBtn").attr("disabled",false);return false}if($.trim(b)){if(confirm("确认"+c+"用户积分？")){$.ajax({type:"post",url:getPath()+"/manage/freeze.do",data:"type="+a+"&reason="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){$("#freezeBtn").attr("disabled",false);alert(c+"成功");userSearch(0)}});return false}else{$("#freezeBtn").attr("disabled",false);return false}}else{alert("原因必须输入");$("#freezeBtn").attr("disabled",false);return false}}function userSearchCallback(b,a){var k,d,f;var g=document.getElementById("res");while(g.rows.length>0){g.removeChild(g.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"userSearch",0);k=g.insertRow(g.rows.length);d=k.insertCell(k.cells.length);d.colSpan=12;d.innerHTML=noRecord;k.style.height="200px"}else{drawPages(b.c,"userSearch",b.s);var e=b.r;var h="批量冻结";if(b.f==1){h="批量解冻"}$("#freezeBtn").val(h);if(a){var c=document.getElementById("groupChoose").innerHTML.split("全部</option>")[1];$("#notconcern").css("display","");document.getElementById("group").innerHTML="<option>添加到</option>"+c}for(f=0;f<e.length;f++){if(e[f]!=null){k=g.insertRow(g.rows.length);k.className="td_int";if(a){d=k.insertCell(k.cells.length);if(e[f].status==0){d.innerHTML="<input type='checkbox' disabled='true'/>"}else{d.innerHTML="<input type='checkbox' value='"+e[f].openId+"' onclick='chooseAll(true);'/>"}}d=k.insertCell(k.cells.length);if(e[f].mobile==null){d.innerHTML=""}else{d.innerHTML=e[f].mobile}d=k.insertCell(k.cells.length);d.innerHTML=e[f].userName;d=k.insertCell(k.cells.length);d.innerHTML=e[f].openId;d=k.insertCell(k.cells.length);d.innerHTML=sex[e[f].sex];d=k.insertCell(k.cells.length);d.innerHTML=e[f].country;d=k.insertCell(k.cells.length);d.innerHTML=e[f].province;d=k.insertCell(k.cells.length);d.innerHTML=e[f].city;d=k.insertCell(k.cells.length);d.innerHTML=formatDate(e[f].subscribeTime);d=k.insertCell(k.cells.length);if(e[f].status==0){d.innerHTML="未关注"}else{d.innerHTML="已关注"}d=k.insertCell(k.cells.length);if(e[f].sign==0){d.innerHTML="未签到 "}else{d.innerHTML="已签到"}if(!a){d=k.insertCell(k.cells.length);d.innerHTML=e[f].signCount;d=k.insertCell(k.cells.length);d.innerHTML=e[f].groupName;d=k.insertCell(k.cells.length);d.innerHTML="<a href=\"javascript:userDetail('"+e[f].openId+"');\">详情</a>";k=g.insertRow(g.rows.length);k.className="td_int";k.style.display="none";k.id="detail_"+e[f].openId;d=k.insertCell(k.cells.length);d.colSpan=13;d.innerHTML="<div class='showViewStyle'></div>"}if(a){d=k.insertCell(k.cells.length);if(e[f].status==0){d.innerHTML="未关注"}else{d.innerHTML="<select onChange=\"groupSet(this[this.selectedIndex].value,this[this.selectedIndex].text,'"+e[f].openId+'\');"><option value="'+e[f].groupId+'">'+e[f].groupName+"</option>"+c+"</select>"}}}}}}function userDetail(a){$.ajax({type:"post",url:getPath()+"/manage/userdetail.do",data:"id="+a,dataType:"html",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){$("tr[id^=detail_]").children().children().html("");$("tr[id^=detail_]").hide();var b=document.getElementById("detail_"+a);b.children[0].children[0].innerHTML=c;b.style.display="";document.getElementById("openId").value=a;document.getElementById("back1").onclick=function(){b.children[0].children[0].innerHTML=""};userTrans(0,a)},error:function(c,b){}})}function userTrans(c,g){var b="id="+g;if(g==null||g==""){g=document.getElementById("openId").value;var d=document.getElementById("startTime1").value;var a=document.getElementById("endTime1").value;var e=document.getElementById("transId").value;var f=document.getElementById("transType").value;b="id="+g+"&startTime="+d+"&endTime="+a+"&transId="+e+"&transType="+f}b+="&startIdx="+c;$.ajax({type:"post",url:getPath()+"/manage/usertrans.do",data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(h){userTransCallback(h)},error:function(k,h){}})}function userTransCallback(c){var b=c.t;if(b){var a=document.getElementById("realName");var h=document.getElementById("phone");var l=document.getElementById("address");if(b.realName==null){a.innerHTML=""}else{a.innerHTML=b.realName}if(b.phone==null){h.innerHTML=""}else{h.innerHTML=b.phone}if(b.address==null){l.innerHTML=""}else{l.innerHTML=b.n_province+b.n_city+b.n_contry+b.address}document.getElementById("transAmount").innerHTML=b.transAmount.toFixed(2);document.getElementById("transAmount2").innerHTML=b.transAmount2.toFixed(2);document.getElementById("ranking").innerHTML=b.ranking;document.getElementById("allTrans").innerHTML=(b.transAmount+b.transAmount2).toFixed(2);if(b.idnum){$("#idnumSpan").show();$("#idnum").html(b.idnum)}if(b.idcard1){$("#idcard1Span").show();$("#idcard1").html("<img width='200px' src='"+b.idcard1+"'>")}if(b.idcard2){$("#idcard2Span").show();$("#idcard2").html("<img width='200px' src='"+b.idcard2+"'>")}}var k,d,g;var f=document.getElementById("transres");while(f.rows.length>0){f.removeChild(f.firstChild)}if(c.r==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"userTrans",0,"detail");k=f.insertRow(f.rows.length);d=k.insertCell(k.cells.length);d.colSpan=7;d.innerHTML=noRecord;k.style.height="200px"}else{drawPages(c.c,"userTrans",c.s,"detail");var e=c.r;for(g=0;g<e.length;g++){if(e[g]!=null){k=f.insertRow(f.rows.length);k.className="td_int";d=k.insertCell(k.cells.length);d.innerHTML=e[g].id;d=k.insertCell(k.cells.length);d.innerHTML=transType[e[g].transType];d=k.insertCell(k.cells.length);if(e[g].transAmount>=0){d.innerHTML=e[g].transAmount.toFixed(2)}else{d.innerHTML="--"}d=k.insertCell(k.cells.length);if(e[g].transAmount<=0){d.innerHTML=e[g].transAmount.toFixed(2)}else{d.innerHTML="--"}d=k.insertCell(k.cells.length);d.innerHTML=e[g].accountBalance.toFixed(2);d=k.insertCell(k.cells.length);d.innerHTML=formatDate(e[g].transTime);d=k.insertCell(k.cells.length);if(e[g].remark){d.innerHTML=e[g].remark}else{d.innerHTML="--"}}}}}function changeDiv(c,b,a){document.getElementById(c).className="on";document.getElementById(b).className="";if(document.getElementById(a)){document.getElementById(a).className=""}var c=document.getElementById(c+"_0");var b=document.getElementById(b+"_0");var a=document.getElementById(a+"_0");c.style.display="";b.style.display="none";if(a){a.style.display="none"}}function groupSearch(a){if(a==null){a=""}$.ajax({type:"post",url:getPath()+"/manage/groupsearch.do?flag="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){groupSearchCallback(b,a);if(a&&a!="msg"&&a!="user"){userSearch(0,true)}if(document.getElementById("gflag")){document.getElementById("gflag").value=1}},error:function(c,b){}})}function groupSearchCallback(e,a){if(a){var c=document.getElementById("groupChoose");if(e&&e.groups){for(var d=0;d<e.groups.length;d++){c.options[c.options.length]=new Option(e.groups[d].name,e.groups[d].id,false,false)}}return}var g,h,d;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(e==null||!(e instanceof Array)||e.length<1){g=b.insertRow(b.rows.length);h=g.insertCell(g.cells.length);h.colSpan=6;h.innerHTML=noRecord;g.style.height="200px"}else{var f=e;for(d=0;d<f.length;d++){if(f[d]!=null){g=b.insertRow(b.rows.length);g.className="td_int";h=g.insertCell(g.cells.length);h.innerHTML=f[d].groupName;h=g.insertCell(g.cells.length);if(f[d].groupId>2){h.innerHTML="自定义分组"}else{h.innerHTML="初始分组"}h=g.insertCell(g.cells.length);h.innerHTML=f[d].userCount}}}}function groupSet(e,b,l){var k,m,a=[];if(e!=null&&l!=null){k=e;m=b;a[0]=l}else{var d=document.getElementById("group");k=d[d.selectedIndex].value;m=d[d.selectedIndex].text;var f=document.getElementById("res").children;for(var c=0;c<f.length;c++){var h=f[c].children[0].children[0];if(h.checked){a[c]=h.value}}if(k==""||k=="添加到"){alert("请选择分组");return}if(a.length==0){alert("请选择用户");return}}$.ajax({type:"post",url:getPath()+"/manage/groupset.do",data:"group="+k+"&groupName="+m+"&openIds="+a.toString(),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){if(g==0){alert("修改成功")}else{alert("修改失败")}},error:function(n,g){}})}function addGroup(){var a=document.getElementById("groupName").value;if(a==null||a==undefined||a==""){alert("请填写新分组名称！");return}$.ajax({type:"post",url:getPath()+"/manage/addgroup.do",data:"newGroup="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b!=0&&b!=null){cancle()}else{alert("新建分组失败")}},error:function(c,b){}})}function msgForwardStat(){var a=document.getElementById("subscribeTime").value;$.ajax({type:"post",url:getPath()+"/manage/msgforwardstat.do",data:"subscribeTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){msgForwardStatCallback(b)},error:function(c,b){}})}function msgForwardStatCallback(a){var l=document.getElementById("statTitle");var g=a.t;var m="<td>关注者</td><td>转发消息数量</td>";for(var e=0;e<g.length;e++){m+="<td>"+g[e].title+"</td>"}l.innerHTML=m;var k,b,e;var f=document.getElementById("res");while(f.rows.length>0){f.removeChild(f.firstChild)}if(a.r==null||a.r.length<1||!(a.r instanceof Array)){k=f.insertRow(f.rows.length);b=k.insertCell(k.cells.length);b.colSpan=6;b.innerHTML=noRecord;k.style.height="200px"}else{var d=a.r;for(e=0;e<d.length;e++){if(d[e]!=null){k=f.insertRow(f.rows.length);k.className="td_int";b=k.insertCell(k.cells.length);b.innerHTML=d[e].userName;b=k.insertCell(k.cells.length);b.innerHTML=d[e].allCount;for(var c=0;c<g.length;c++){b=k.insertCell(k.cells.length);var h="msgCount"+g[c].id;if(d[e][h]!=null){b.innerHTML=d[e][h]}else{b.innerHTML=0}}}}}}function statExport(b){if(b=="sign"){var c=document.getElementById("startTime").value;var f=document.getElementById("endTime").value;if(c==""||f==""){alert("起始时间不能为空")}else{location.href=getPath()+"/manage/usersignexport.do?endTime="+f+"&startTime="+c}}else{if(b=="shareTrend"){var c=document.getElementById("startTime").value;var f=document.getElementById("endTime").value;if(c==""||f==""){alert("起始时间不能为空")}else{location.href=getPath()+"/manage/shareTrendexport.do?endTime="+f+"&startTime="+c}}else{if(b=="share"){var c=document.getElementById("startTime").value;var f=document.getElementById("endTime").value;if(c==""||f==""){alert("起始时间不能为空")}else{location.href=getPath()+"/manage/sharestatexport.do?endTime="+f+"&startTime="+c}}else{if(b=="menu"){var c=document.getElementById("startTime").value;var f=document.getElementById("endTime").value;if(c==""||f==""){alert("起始时间不能为空")}else{location.href=getPath()+"/manage/menustatexport.do?endTime="+f+"&startTime="+c}}else{if(b=="statistics"){c=document.getElementById("startTime").value;f=document.getElementById("endTime").value;startBetCount=document.getElementById("startBetCount").value;endBetCount=document.getElementById("endBetCount").value;startLoginSum=document.getElementById("startLoginSum").value;endLoginSum=document.getElementById("endLoginSum").value;startAwardSum=document.getElementById("startAwardSum").value;endAwardSum=document.getElementById("endAwardSum").value;startConsumeSum=document.getElementById("startConsumeSum").value;endConsumeSum=document.getElementById("endConsumeSum").value;telNum=document.getElementById("telNum").value;flag=document.getElementById("flag").value;if(c==""&&f!=""){alert("开始时间不能为空");return}if(c!=""&&f==""){alert("结束时间不能为空");return}location.href=getPath()+"/activity/statisticsListExport.do?startTime="+c+"&endTime="+f+"&startBetCount="+startBetCount+"&endBetCount="+endBetCount+"&startLoginSum="+startLoginSum+"&endLoginSum="+endLoginSum+"&startAwardSum="+startAwardSum+"&endAwardSum="+endAwardSum+"&startConsumeSum="+startConsumeSum+"&endConsumeSum="+endConsumeSum+"&telNum="+telNum+"&flag="+flag}else{if(b=="winStatistics"){var k=document.getElementById("raffleName").value;var e=document.getElementById("prize").value;location.href=getPath()+"/activity/winStatisticsExport.do?raffleName="+k+"&prize="+e}else{if(b=="user"){document.getElementById("userForm").action=getPath()+"/manage/userListExport.do";document.getElementById("userForm").submit()}else{if(b=="answerStatistics"){var a=document.getElementById("startAnswerCount").value;var h=document.getElementById("endAnswerCount").value;var l=document.getElementById("startTotalCount").value;var g=document.getElementById("endTotalCount").value;telNum=document.getElementById("telNum").value;location.href=getPath()+"/question/answerStatisticsListExport.do?startAnswerCount="+a+"&endAnswerCount="+h+"&startTotalCount="+l+"&endTotalCount="+g+"&telNum="+telNum}else{var d=document.getElementById("subscribeTime").value;location.href=getPath()+"/manage/msgstatexport.do?subscribeTime="+d}}}}}}}}}function shareStat(){showRunning(3);var b=document.getElementById("startTime").value;var a=document.getElementById("endTime").value;if(b==""||a==""){alert("起始时间不能为空")}else{if(b>a){document.getElementById("endTime").value=b;a=b}$.ajax({type:"post",url:getPath()+"/manage/sharestat.do",data:"startTime="+b+"&endTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){shareStatCallback(c)}})}}function shareStatCallback(e){var d,g,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(e==null||e.length<1||!(e instanceof Array)){d=a.insertRow(a.rows.length);g=d.insertCell(d.cells.length);g.colSpan=3;g.innerHTML=noRecord;d.style.height="200px"}else{var c=0;for(b=0;b<e.length;b++){if(e[b]!=null){c+=parseInt(e[b].count,10)}}for(b=0;b<e.length;b++){if(e[b]!=null){d=a.insertRow(a.rows.length);d.className="td_int";g=d.insertCell(d.cells.length);g.innerHTML=e[b].name;g=d.insertCell(d.cells.length);g.innerHTML=e[b].count;g=d.insertCell(d.cells.length);var f=0;if(e[b].count!=0&&c!=0){f=(e[b].count/c*100).toFixed(2)}g.innerHTML=f+"%"}}}}function shareTrend(){showRunning(2);var b=document.getElementById("startTime").value;var a=document.getElementById("endTime").value;if(b==""||a==""){alert("起始时间不能为空")}else{if(b>a){document.getElementById("endTime").value=b;a=b}$.ajax({type:"post",url:getPath()+"/manage/sharetrend.do",data:"startTime="+b+"&endTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){shareTrendCallback(c);drawLineWithTime2("#usertrendline","分享数",getPieJsonValueByKey(c,"statTime","count"),null,true)}})}}function shareTrendCallback(d){var c,e,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(d==null||d.length<1||!(d instanceof Array)){c=a.insertRow(a.rows.length);e=c.insertCell(c.cells.length);e.colSpan=2;e.innerHTML=noRecord;c.style.height="200px"}else{for(b=0;b<d.length;b++){if(d[b]!=null){c=a.insertRow(a.rows.length);c.className="td_int";e=c.insertCell(c.cells.length);e.innerHTML=formatDateNoTime(d[b].statTime);e=c.insertCell(c.cells.length);e.innerHTML=d[b].count}}}}function userSignStat(){showRunning(3);var b=document.getElementById("startTime").value;var a=document.getElementById("endTime").value;if(b==""||a==""){alert("起始时间不能为空")}else{if(b>a){document.getElementById("endTime").value=b;a=b}$.ajax({type:"post",url:getPath()+"/manage/usersignstat.do",data:"startTime="+b+"&endTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){userSignStatCallback(c);drawLineWithTime3("#usertrendline","签到数","成功签到积分数",getPieJsonValueByKey(c,"statTime","count"),getPieJsonValueByKey(c,"statTime","amount"))}})}}function userSignStatCallback(f){var e,g,c,d=0,b=0;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(f==null||f.length<1||!(f instanceof Array)){e=a.insertRow(a.rows.length);g=e.insertCell(e.cells.length);g.colSpan=2;g.innerHTML=noRecord;e.style.height="200px"}else{for(c=0;c<f.length;c++){if(f[c]!=null){e=a.insertRow(a.rows.length);e.className="td_int";g=e.insertCell(e.cells.length);g.innerHTML=formatDateNoTime(f[c].statTime).split(" ")[0];g=e.insertCell(e.cells.length);g.innerHTML=f[c].count;g=e.insertCell(e.cells.length);g.innerHTML=f[c].amount;d+=f[c].count;b+=f[c].amount}}e=a.insertRow(a.rows.length);e.className="td_int";g=e.insertCell(e.cells.length);g.innerHTML="合计";g=e.insertCell(e.cells.length);g.innerHTML=d;g=e.insertCell(e.cells.length);g.innerHTML=b}}function searchReply(a){$.ajax({type:"post",url:getPath()+"/replyRule/getReply.do",data:"type="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d!=null){var b=d.rep;if(b!=null){if(b.msgType=="0"){if(b.msg==null||b.msg==""){$("#showContent").html("尚未设置回复内容！")}else{$("#showContent").html(b.msg)}}if(b.msgType=="1"){if(b.mediaPath==null||b.mediaPath==""){$("#showContent").html("尚未设置回复内容！")}else{$("#showContent").css("display","none");var c=document.getElementById("showpic");c.innerHTML="<img src='"+downloadPath+b.mediaPath+"'>"}}if(b.msgType=="5"){if(b.msg==null||b.msg==""){$("#showContent").html("尚未设置回复内容！")}else{$("#showContent").html("图文消息：["+b.msg+"]")}}}}}})}function turnToReply(a){$("#updateReply").css("display","");$("#showReply").css("display","none");$.ajax({type:"post",url:getPath()+"/replyRule/getReply.do",data:"type="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c!=null&&c.rep!=null){if(c.rep.msgType=="0"){$("#txtReply").html(c.rep.msg)}}var d=c.msg;if(d!=null&&d.length>0){for(var b=0;b<d.length;b++){$("#msgChoose").append("<option value='"+d[b]+"'>"+d[b]+"</option>")}}},error:function(c,b){}})}function updateReply(d,a){var c=" ";if(a=="0"){c=$("#txtReply").val()}if(a=="1"){var b=$("#picview img:first-child");if(!b.length){alert("请上传图片");return}var c=getMediaPath(b.attr("src"))}if(a=="5"){var c=$("#msgChoose").val();if(c==""){alert("请选择图文消息！");return}}$.ajax({type:"post",url:getPath()+"/replyRule/updateReply.do",data:"msgType="+a+"&value="+c+"&type="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e=="success"){window.location.reload()}else{alert("保存失败！")}},error:function(f,e){}})}function turnToAddKeyword(){$("#addKeyword").css("display","");$("#showKeyword").css("display","none");$.ajax({type:"get",url:getPath()+"/replyRule/searchMsgId.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a!=null&&a.length>0){for(i=0;i<a.length;i++){$("#msgChoose").append("<option value='"+a[i]+"'>"+a[i]+"</option>")}}},error:function(b,a){}})}function addKeyword(a){var g=document.getElementById("ruleName").value;if(g==""){alert("请输入规则名称！");return}var c=document.getElementById("keyword").value;if(c==""){alert("请输入关键词！");return}var b="";var f=document.getElementById("keywordId").value;if(a=="0"){var b=document.getElementById("replycontent").value}if(a=="1"){var e=$("#picview img:first-child");if(!e.length){alert("请上传图片");return}var b=getMediaPath(e.attr("src"))}if(a=="5"){var b=$("#msgChoose").val();if(b==""){alert("请选择图文消息！");return}}var d="";var h="";if(f==""){d=getPath()+"/replyRule/addKeyword.do";h="ruleName="+g+"&keyword="+c+"&replycontent="+b+"&msgType="+a}else{d=getPath()+"/replyRule/updateKeyword.do?";h="id="+f+"&ruleName="+g+"&keyword="+c+"&replycontent="+b+"&msgType="+a}$.ajax({type:"post",url:d,data:h,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(k){if(k=="success"){window.location.reload()}else{alert("保存失败！")}},error:function(l,k){}})}function searchKeyword(a){showRunning(4);$.ajax({type:"post",url:getPath()+"/replyRule/searchKeyword.do",data:"startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchKeywordCallback(b)},error:function(c,b){}})}function searchKeywordCallback(c){var e,g,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchKeyword",0);e=a.insertRow(a.rows.length);g=e.insertCell(e.cells.length);g.colSpan=4;g.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchKeyword",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";e.id="keyword"+d[b].id;g=e.insertCell(e.cells.length);g.innerHTML=c.s+b+1;g=e.insertCell(e.cells.length);g.innerHTML=d[b].name;g=e.insertCell(e.cells.length);g.innerHTML=formatDate(d[b].createTime);g=e.insertCell(e.cells.length);g.innerHTML="<a href= 'javascript:showKeyword("+d[b].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:updateKeyword("+d[b].id+")'>修改</a>&nbsp;&nbsp;<a href= 'javascript:deleteKeyword("+d[b].id+")'>删除</a>";e=a.insertRow(a.rows.length);e.className="td_int";e.style.display="none";e.id="keyword_"+d[b].id;g=e.insertCell(e.cells.length);g.colSpan=4;var f="";if(d[b].msgType=="0"){if(d[b].msg==null||d[b].msg==""){f="<input type='text' disabled='disabled' value=''>"}else{f="<input type='text' disabled='disabled' value='"+d[b].msg+"'>"}}if(d[b].msgType=="1"){f="<img src='"+downloadPath+d[b].mediaPath+"'>"}if(d[b].msgType=="5"){f="<input type='text' disabled='disabled' value='图文消息：["+d[b].msg+"]'>"}g.innerHTML="<div class='right_em_con'><div class='frame_basic' id='tours_0'><ul><li class='list_tit ww_10'>关键词：</li><li class='list_con ww_20'><input type='text' disabled='disabled' value='"+d[b].keyword+"'></li><li class='list_tit ww_10'>回复：</li><li class='list_con ww_20'>"+f+"</li></ul></div><div class='main_jg'></div><div class='goto_back'><a href= 'javascript:hideKeyword("+d[b].id+")'>收回</a></div></div>"}}}}function showKeyword(b){$("tr[id^=keyword_]").hide();var a=document.getElementById("keyword_"+b);a.style.display=""}function hideKeyword(b){var a=document.getElementById("keyword_"+b);a.style.display="none"}function updateKeyword(a){$.ajax({type:"post",url:getPath()+"/replyRule/getKeyword.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b!=null&&b.rep!=null){$("#addKeyword").css("display","");$("#showKeyword").css("display","none");$("#ruleName").val(b.rep.name);$("#keyword").val(b.rep.keyword);$("#keywordId").val(b.rep.id);if(b.rep.msgType=="0"){$("#replycontent").val(b.rep.msg)}if(b.msg.length>0){for(i=0;i<b.msg.length;i++){$("#msgChoose").append("<option value='"+b.msg[i]+"'>"+b.msg[i]+"</option>")}}}},error:function(c,b){}})}function deleteKeyword(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/replyRule/deleteKeyword.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){searchKeyword(0)}else{alert("删除失败！")}},error:function(c,b){}})}}function cancle(){window.location.reload()}function newGame(){var a="<div class='team_title'></div><div class='frame_basic'><input type='text'  style='display: none;' name='matchIndex' value='"+topicNum+"'/><ul><li class='list_tit ww_30'>赛事日期：</li><li class='list_con ww_40'><input type='text' size='20' name='gameTime"+topicNum+"' class='Wdate' onclick='WdatePicker({dateFmt:\"yyyy-MM-dd HH:mm:ss\"})'/></li><li class='list_tit ww_30'>赛事编号：</li><li class='list_con ww_40'><input type='text' name='matchNum"+topicNum+"'/></li><li class='list_tit ww_30'>联赛名称：</li><li class='list_con ww_40'><input type='text' name='league"+topicNum+"'/></li><li class='list_tit ww_30'>主队：</li><li class='list_con ww_40'><input type='text' name='homeTeam"+topicNum+"'/></li><li class='list_tit ww_30'>客队：</li><li class='list_con ww_40'><input type='text' name='guestTeam"+topicNum+"'/></li><li class='list_tit ww_30'>让球数：</li><li class='list_con ww_40'><input type='text' name='letCount"+topicNum+"'/></li><li class='list_tit ww_30'>开赛时间：</li><li class='list_con ww_40'><input type='text' size='20' name='soldEndTime"+topicNum+"' class='Wdate' onclick='WdatePicker({dateFmt:\"yyyy-MM-dd HH:mm:ss\"})'/></li><li class='list_tit ww_30'>单固标示：</li><li class='list_con ww_40'><select name='matchFlag"+topicNum+"'><option value='0'>否</option><option value='1'>是</option></select></li></ul></div><br>";$("#handImport").append(a);topicNum=topicNum+1}function handImport(){$("#excelImport").css("display","none");$("#handImportBtn").css("display","none");$("#handImport").css("display","");$("#excelImportBtn").css("display","");$("#newGameBtn").css("display","");$("#matchSaveBtn").css("display","")}function excelImport(){$("#excelImport").css("display","");$("#handImportBtn").css("display","");$("#handImport").css("display","none");$("#excelImportBtn").css("display","none");$("#newGameBtn").css("display","none");$("#matchSaveBtn").css("display","none")}function addMatch(a){var b=$("#matchAddFrom").serialize();$.ajax({type:"post",url:getPath()+"/match/addMatch.do?matchType="+a,data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="success"){alert("发布成功！");window.location.reload()}else{if(c.r=="duplicateMatchNum"){alert("赛事编号已存在！")}else{if(c.r=="haveNullPoint"){alert("有字段为空！（赛事日期、赛事编号、联赛全称、主队、客队、开赛时间为必填字段）")}else{alert("发布失败！")}}}}})}function turnToAddMatch(a){$("#matchAdd").css("display","");$("#matchSearch").css("display","none");$("#handImportBtn").css("display","none")}function searchMatch(d){var e=document.getElementById("mType").value;var a=document.getElementById("beginTime").value;var c=document.getElementById("endTime").value;var b=document.getElementById("matchStatus").value;if(a==""&&c!=""){alert("请选择开始时间！");return}if(a!=""&&c==""){alert("请选择结束时间！");return}if(c!=""&&a>c){alert("开始时间必须小于结束时间！");return}showRunning(8);$.ajax({type:"post",url:getPath()+"/match/searchMatch.do",data:"beginTime="+a+"&endTime="+c+"&status="+b+"&matchType="+e+"&startIdx="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){searchMatchCallback(f,e)},error:function(g,f){}})}function searchMatchCallback(o,g){var b,k,s;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(o==null||!(o.r instanceof Array)||o.r.length<1){drawPages(0,"searchMatch",0);b=a.insertRow(a.rows.length);k=b.insertCell(b.cells.length);k.colSpan=8;k.innerHTML=noRecord;b.style.height="200px"}else{drawPages(o.c,"searchMatch",o.s);var v=o.r;for(s=0;s<v.length;s++){if(v[s]!=null){b=a.insertRow(a.rows.length);b.className="td_int";k=b.insertCell(b.cells.length);k.innerHTML="<input type='checkbox' value='"+v[s].id+"'/>";k=b.insertCell(b.cells.length);k.innerHTML=formatDate(v[s].matchTime);k=b.insertCell(b.cells.length);k.innerHTML=v[s].matchNum;k=b.insertCell(b.cells.length);if(v[s].leagueSubName==null||v[s].leagueSubName==""){k.innerHTML=""}else{k.innerHTML=v[s].leagueSubName}k=b.insertCell(b.cells.length);k.innerHTML=v[s].leagueName;k=b.insertCell(b.cells.length);k.innerHTML=v[s].homeTeamName;k=b.insertCell(b.cells.length);k.innerHTML=v[s].guestTeamName;k=b.insertCell(b.cells.length);if(v[s].letCount==null||v[s].letCount==""){k.innerHTML=""}else{if(v[s].letCount>0){k.innerHTML="+"+v[s].letCount/10}else{k.innerHTML=v[s].letCount/10}}k=b.insertCell(b.cells.length);k.innerHTML=formatDate(v[s].stopTime);if(g!="1"){k=b.insertCell(b.cells.length);if(v[s].flag!=null&&v[s].flag!=""){k.innerHTML=matchFlag[v[s].flag]}else{k.innerHTML=""}}k=b.insertCell(b.cells.length);var e=Date.parse(new Date());if(e>v[s].stopTime){k.innerHTML="已截止"}else{k.innerHTML="已发布"}k=b.insertCell(b.cells.length);k.innerHTML="<a href= 'javascript:showMatch("+v[s].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:updateMatch("+v[s].id+","+g+")'>修改</a>&nbsp;&nbsp;<a href= 'javascript:deleteMatch("+v[s].id+","+g+")'>删除</a>";b=a.insertRow(a.rows.length);b.className="td_int";b.style.display="none";b.id="match_"+v[s].id;k=b.insertCell(b.cells.length);if(g=="1"){k.colSpan=11}else{k.colSpan=12}if(g=="3"){if(v[s].odd1!=null&&v[s].odd1!=""){var u=$.parseJSON(v[s].odd1);odd1show="主负("+(u.odd0/1000).toFixed(2)+") 主胜("+(u.odd3/1000).toFixed(2)+")"}else{odd1show="主负(--) 主胜(--)"}if(v[s].odd2!=null&&v[s].odd2!=""){var t=$.parseJSON(v[s].odd2);odd2show="主负("+(t.odd0/1000).toFixed(2)+") 主胜("+(t.odd3/1000).toFixed(2)+")"}else{odd2show="主负(--) 主胜(--)"}}else{if(v[s].odd1!=null&&v[s].odd1!=""){var u=$.parseJSON(v[s].odd1);odd1show="胜("+(u.odd3/1000).toFixed(2)+") 平("+(u.odd1/1000).toFixed(2)+") 负("+(u.odd0/1000).toFixed(2)+")"}else{odd1show="胜(--) 平(--) 负(--)"}if(v[s].odd2!=null&&v[s].odd2!=""){var t=$.parseJSON(v[s].odd2);odd2show="胜("+(t.odd3/1000).toFixed(2)+") 平("+(t.odd1/1000).toFixed(2)+") 负("+(t.odd0/1000).toFixed(2)+")"}else{odd2show="胜(--) 平(--) 负(--)"}}if(g=="2"){k.innerHTML='<div class="right_em_con"><div class="frame_basic"><ul><li class="list_tit ww_20">参考固定奖金：</li><li class="list_con ww_30"><p>胜平负：'+odd1show+"</p><p>让球："+odd2show+'</p><br /></li></ul></div><div class="goto_back"><a href= \'javascript:hideMatch('+v[s].id+")'>收回</a></div></div> "}else{if(g=="3"){k.innerHTML='<div class="right_em_con"><div class="frame_basic"><ul><li class="list_tit ww_20">参考固定奖金：</li><li class="list_con ww_30"><p>胜负： '+odd1show+"</p><p>让分： "+odd2show+'</p><br /></li></ul></div><div class="goto_back"><a href= \'javascript:hideMatch('+v[s].id+")'>收回</a></div></div> "}else{var n=v[s].recommend.split("|")[0];var m=v[s].recommend.split("|")[1];var l=v[s].recommend.split("|")[2];var r=v[s].history.split(",")[0];var q=v[s].history.split(",")[1];var p=v[s].history.split(",")[2];var h=v[s].record.split("|")[0];var f=v[s].record.split("|")[1];var d=v[s].record.split("|")[2];var c=v[s].record.split("|")[3];k.innerHTML='<div class="right_em_con"><div class="frame_basic"><ul><li class="list_tit ww_20">投注推荐：</li><li class="list_con ww_20"><p>胜平负：'+n+"</p><p>总进球："+m+"</p><p>比分："+l+'</p></li><li class="list_tit ww_20">参考固定奖金：</li><li class="list_con ww_30"><p>胜平负：'+odd1show+"</p><p>让球："+odd2show+'</p><br /></li><li class="list_tit ww_20">交锋历史：</li><li class="list_con ww_20">主队 '+r+"胜"+q+"平"+p+'负</li><li class="list_tit ww_20">近期战绩：</li><li class="list_con ww_20"><p>主队近期战绩：'+h+"</p><p>主队主场战绩："+f+"</p><p>客队近期战绩："+d+"</p><p>客队客场战绩："+c+'</p></li></ul></div><div class="goto_back"><a href= \'javascript:hideMatch('+v[s].id+")'>收回</a></div></div> "}}}}}}function updateMatch(b,a){$.ajax({type:"post",url:getPath()+"/match/getMatch.do",data:"id="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c!=null){$("#matchUpdate").css("display","");$("#matchSearch").css("display","none");if(a!="1"){$("#matchFlag").val(c.flag)}else{$("#winFail").val(c.recommend.split("|")[0]);$("#goals").val(c.recommend.split("|")[1]);$("#scores").val(c.recommend.split("|")[2]);$("#win").val(c.history.split(",")[0]);$("#draw").val(c.history.split(",")[1]);$("#fail").val(c.history.split(",")[2]);$("#hTeamRec").val(c.record.split("|")[0]);$("#hHomeRec").val(c.record.split("|")[1]);$("#gTeamRec").val(c.record.split("|")[2]);$("#gGuestRec").val(c.record.split("|")[3])}$("#gameTime").val(formatDate(c.matchTime));$("#matchNum").val(c.matchNum);$("#league").val(c.leagueName);$("#homeTeam").val(c.homeTeamName);$("#guestTeam").val(c.guestTeamName);if(c.letCount!=null){$("#letCount").val(c.letCount/10)}$("#soldEndTime").val(formatDate(c.stopTime));$("#gameId").val(c.id)}}})}function saveUpdateMatch(a){var b=$("#matchUpdateFrom").serialize();$.ajax({type:"post",url:getPath()+"/match/updateMatch.do?matchType="+a,data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c=="success"){window.location.reload()}else{if(c=="duplicateMatchNum"){alert("有重复赛事编号！")}else{alert("更新失败！")}}}})}function deleteMatch(b,a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/match/deleteMatch.do",data:"matchIds="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c=="success"){searchMatch(0)}else{alert("删除失败！")}},error:function(d,c){}})}}function batchDelMatch(c){var d=[],a=document.getElementById("res").children;for(var b=0;b<a.length;b+=2){var e=a[b].children[0].children[0];if(e&&e.checked){d.push(e.value)}}if(d.length==0){alert("请选择刪除內容");return}deleteMatch(d,c)}function checkedAll(){var c=document.getElementById("selectAll");var a=document.getElementById("res").children;if(c.checked){for(var b=0;b<a.length;b+=2){var d=a[b].children[0].children[0];d.checked=true}}else{for(var b=0;b<a.length;b+=2){var d=a[b].children[0].children[0];d.checked=false}}}function uploadExcel(fileElementId,type){var exl=document.getElementById("exlFile").value;if(exl==""){alert("请上传文件");return}$.ajaxFileUpload({url:getPath()+"/match/excelImport.do?filename="+fileElementId+"&type="+type,secureuri:false,fileElementId:fileElementId,dataType:"txt",async:false,success:function(data,status){if(data.split(">").length>1){data=data.substring(data.indexOf(">")+1,data.length-6)}eval("data = "+data);if(data.r=="errorFile"){alert("上传的文件格式错误！");return}if(data.r=="noMatchNum"){alert("赛事编号不能为空！");return}if(data.r=="duplicateMatchNum"){alert("有重复赛事编号！");return}if(data.r=="matchTypeError"){alert("赛事类型错误！");return}if(data.r=="fail"){alert("上传失败！");return}if(data.r=="ok"){alert("上传成功！");window.location.reload()}}})}function searchForwardManange(b){var a=document.getElementById("manageTime").value;if(a==""){alert("请选择查询时间");return}showRunning(3);$.ajax({type:"POST",url:getPath()+"/forward/searchForwardManage.do",data:"stateTime="+a,dataType:"json",cache:false,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="timeout"){window.location=getPath()+"/html/loginwx.html";return}searchForwarCallback(c)},})}function searchForwarCallback(c){var d,e,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(!(c instanceof Array)||c.length<1){d=a.insertRow(a.rows.length);e=d.insertCell(d.cells.length);e.colSpan=3;e.innerHTML=noRecord;d.style.height="200px"}else{for(b=0;b<c.length;b++){if(c[b]!=null){d=a.insertRow(a.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML=c[b].provinName;e=d.insertCell(d.cells.length);e.innerHTML=returnForwardResult(c[b]);e=d.insertCell(d.cells.length);e.innerHTML="<input id="+c[b].provinNum+"info type=\"text\" disabled='true' value="+c[b].info+">"}}d=a.insertRow(a.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML="";e=d.insertCell(d.cells.length);e.innerHTML='<input class="search_but" id="modify" type="button" value="修改" onclick="modify()">';e=d.insertCell(d.cells.length);e.innerHTML='<input class="search_but"id="delete" type="button" value="删除" onclick="deleteForwardManageSearch()">'}}function modify(){$("#res [type=checkbox]").attr("disabled",false);$("#res [type=text]").attr("disabled",false);$("#modify").val("提交修改");$("#delete").val("返回");$("#modify").attr("onclick","submitmodifyForwardManageSearch()");$("#delete").attr("onclick","searchForwardManange(0)")}function returnForwardResult(b){var a="";if(b.count0==1){a+='<input type="checkbox" id='+b.provinNum+0+" checked='true' disabled='true'>每日重点"}else{a+='<input type="checkbox" id='+b.provinNum+0+" disabled='true'>每日重点"}if(b.count1==1){a+=' <input type="checkbox" id='+b.provinNum+1+" checked='true' disabled='true'>其他"}else{a+=' <input type="checkbox" id='+b.provinNum+1+"  disabled='true'>其他"}if(b.count2==1){a+='<input type="checkbox" id='+b.provinNum+2+" checked='true' disabled='true'>未转发"}else{a+='<input type="checkbox" id='+b.provinNum+2+"  disabled='true'>未转发"}return a}function newForwardManageSearch(a){document.getElementById("res").innerHTML="";$("#creat").show();$("#search").hide();showRunning(3);$.ajax({type:"POST",url:getPath()+"/forward/getProv.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="timeout"){window.location=getPath()+"/html/loginwx.html";return}newForwardCallback(b)},})}function newForwardCallback(c){var d,e,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(!(c instanceof Array)||c.length<1){d=a.insertRow(a.rows.length);e=d.insertCell(d.cells.length);e.colSpan=3;e.innerHTML=noRecord;d.style.height="200px"}else{for(b=0;b<c.length;b++){if(c[b]!=null){d=a.insertRow(a.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML=c[b].provName;e=d.insertCell(d.cells.length);e.innerHTML='<input type="checkbox" id='+c[b].provNum+0+'>每日重点 <input type="checkbox" id='+c[b].provNum+1+'>其他<input type="checkbox" id='+c[b].provNum+2+">未转发";e=d.insertCell(d.cells.length);e.innerHTML="<input id="+c[b].provNum+'info type="text">'}}d=a.insertRow(a.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML="";e=d.insertCell(d.cells.length);e.innerHTML='<input class="search_but" type="button" value="提交"  onclick="submitForwardManange(0)">';e=d.insertCell(d.cells.length);e.innerHTML='<input class="search_but" type="button" value="返回"  onclick="backForwardManange(0)">'}}function setParameter(b){var c=$("#sign_in").val(),a=$("#succes_hint").val(),d=$("#repeat_hint").val();if(c==""||a==""||d==""){showError();return}$.ajax({type:"post",url:getPath()+"/manage/setparam.do",data:"value1="+c+"&value3="+a+"&value4="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e&&e.r){if(e.r=="ok"){showConfirm()}else{showError()}}}})}function searchParam(){$.ajax({type:"post",url:getPath()+"/manage/searchparam.do",dataType:"json",success:function(b){if(b){for(var a=0;a<b.length;a++){if(b[a].name=="sign_in"){$("#sign_in").val(b[a].value)}else{if(b[a].name=="sign_time"){$("#sign_time").val(b[a].value)}else{if(b[a].name=="succes_hint"){$("#succes_hint").val(b[a].value)}else{if(b[a].name=="repeat_hint"){$("#repeat_hint").val(b[a].value)}}}}}}}})}function showMatch(b){$("tr[id^=match_]").hide();var a=document.getElementById("match_"+b);a.style.display=""}function hideMatch(b){var a=document.getElementById("match_"+b);a.style.display="none"}function submitForwardManange(a){stateTime=document.getElementById("createTime").value;if(stateTime==""){alert("创建时间不能为空!")}else{$.ajax({type:"POST",url:getPath()+"/forward/searchForwardManage.do",data:"stateTime="+stateTime,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.length!=0){alert("当日已有数据,不能重复添加!")}else{$.ajax({type:"POST",url:getPath()+"/forward/getProv.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(h){var d=1;for(var g=0;g<h.length;g++){var c=0;for(var e=0;e<3;e++){var f=h[g].provNum+""+e;if(document.getElementById(f).checked){c=c+1}}d=d*c}if(d==0){alert("转发情况为必选!")}else{for(var g=0;g<h.length;g++){var l=h[g].provNum;if(document.getElementById(h[g].provNum+""+0).checked){count0=1}else{count0=0}if(document.getElementById(h[g].provNum+""+1).checked){count1=1}else{count1=0}if(document.getElementById(h[g].provNum+""+2).checked){count2=1}else{count2=0}var k=document.getElementById(h[g].provNum+"info").value;$.ajax({type:"POST",async:false,url:getPath()+"/forward/createForwardManage.do",data:"stateTime="+stateTime+"&provNum="+l+"&info="+k+"&count0="+count0+"&count1="+count1+"&count2="+count2,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){},})}alert("记录新建成功");window.location.reload()}},})}},})}}function deleteForwardManageSearch(){if(confirm("确认删除当日信息吗?")){stateTime=document.getElementById("manageTime").value;$.ajax({type:"POST",url:getPath()+"/forward/delForwardManage.do",data:"stateTime="+stateTime,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a.r=="success"){alert("信息删除成功");window.location.reload()}},})}}function modifyForwardManageSearch(a){document.getElementById("res").innerHTML="";stateTime=document.getElementById("manageTime").value;$.ajax({type:"POST",url:getPath()+"/forward/searchForwardManage.do",data:"stateTime="+stateTime,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d.length==0){alert("当日无数据!")}else{for(var c=0;c<d.length;c++){var e="info";document.getElementById("res").innerHTML+="<td>"+d[c].provinName+'</td><td><input type="checkbox" id='+d[c].provinNum+0+' >每日重点 <input type="checkbox" id='+d[c].provinNum+1+' >其他<input type="checkbox" id='+d[c].provinNum+2+" >未转发</td><td><input id="+d[c].provinNum+e+' type="text"  value='+d[c].info+"></td>"}document.getElementById("res").innerHTML+='<td></td><td><input class="search_but" type="button" value="提交修改" onclick="submitmodifyForwardManageSearch(0)"></td><td><input class="search_but" type="button" value="返回" onclick="searchForwardManange(0)"></td>';for(var b=0;b<d.length;b++){if(d[b].count0==1){document.getElementById(d[b].provinNum+"0").checked=true}if(d[b].count1==1){document.getElementById(d[b].provinNum+"1").checked=true}if(d[b].count2==1){document.getElementById(d[b].provinNum+"2").checked=true}}}},})}function submitmodifyForwardManageSearch(){stateTime=document.getElementById("manageTime").value;$.ajax({type:"POST",url:getPath()+"/forward/getProv.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){var b=1;for(var e=0;e<f.length;e++){var a=0;for(var c=0;c<3;c++){var d=f[e].provNum+""+c;if(document.getElementById(d).checked){a=a+1}}b=b*a}if(b==0){alert("转发情况为必选!");return}for(var e=0;e<f.length;e++){var h=f[e].provNum;if(document.getElementById(f[e].provNum+""+0).checked){count0=1}else{count0=0}if(document.getElementById(f[e].provNum+""+1).checked){count1=1}else{count1=0}if(document.getElementById(f[e].provNum+""+2).checked){count2=1}else{count2=0}var g=document.getElementById(f[e].provNum+"info").value;$.ajax({type:"POST",async:false,url:getPath()+"/forward/updateForwardManage.do",data:"stateTime="+stateTime+"&provNum="+h+"&info="+g+"&count0="+count0+"&count1="+count1+"&count2="+count2,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){},})}alert("信息修改完成");searchForwardManange(0)}})}function backForwardManange(a){window.location.reload()}function searchForwardData(a){document.getElementById("sum").innerHTML="";startTime=document.getElementById("starttime").value;endTime=document.getElementById("endtime").value;if(startTime==""){alert("起始时间不能为空");return}else{if(endTime==""){alert("结束时间不能为空");return}}document.getElementById("res").innerHTML="";showRunning(3);$.ajax({type:"POST",async:false,url:getPath()+"/forward/getProv.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){document.getElementById("res").innerHTML="";for(var b=0;b<c.length;b++){provNum=c[b].provNum;$.ajax({type:"POST",async:false,url:getPath()+"/forward/searchForwarddata.do",data:"startTime="+startTime+"&endTime="+endTime+"&provNum="+provNum,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){document.getElementById("res").innerHTML+="<td>"+d.provinName+"</td><td>"+d.count0+"</td><td>"+d.count1+"</td><td>"+d.count2+"</td>"},})}}});$.ajax({type:"POST",async:false,url:getPath()+"/forward/searchForwarddataSum.do",data:"startTime="+startTime+"&endTime="+endTime,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){document.getElementById("sum").innerHTML+="<td>总计</td><td>"+b.count0+"</td><td>"+b.count1+"</td><td>"+b.count2+"</td>"},})}function ForwardDataExport(a){startTime=document.getElementById("starttime").value;endTime=document.getElementById("endtime").value;location.href=getPath()+"/forward/forwardDataexport.do?startTime="+startTime+"&endTime="+endTime}function searchEventList(c){showRunning(11);startTime=document.getElementById("startTime").value;endTime=document.getElementById("endTime").value;state=document.getElementById("state").value;telNum=document.getElementById("telNum").value;var b=document.getElementById("prov").value;var a=document.getElementById("issue").value;if(startTime==""&&endTime!=""){alert("开始时间不能为空");return}if(startTime!=""&&endTime==""){alert("结束时间不能为空");return}$.ajax({type:"POST",url:getPath()+"/activity/searchOrderList.do",data:"startTime="+startTime+"&endTime="+endTime+"&startIdx="+c+"&state="+state+"&telNum="+telNum+"&flag=1&prov="+b+"&issue="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){searchListCallback(d)},})}function searchListCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchEventList",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=11;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchEventList",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=d[b].id;f=e.insertCell(e.cells.length);f.innerHTML=d[b].telNum;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].betTime);f=e.insertCell(e.cells.length);f.innerHTML=d[b].matchNum;f=e.insertCell(e.cells.length);f.innerHTML=d[b].homeName+"vs"+d[b].awayName;f=e.insertCell(e.cells.length);f.innerHTML=d[b].concedeNum;f=e.insertCell(e.cells.length);f.innerHTML=formatResult[d[b].betContent];f=e.insertCell(e.cells.length);if(d[b].betResult){f.innerHTML=formatResult[d[b].betResult]}else{f.innerHTML="--"}f=e.insertCell(e.cells.length);if(d[b].betSp){f.innerHTML=d[b].betSp}else{f.innerHTML="--"}f=e.insertCell(e.cells.length);if(d[b].state==2){f.innerHTML="1"}else{f.innerHTML="--"}f=e.insertCell(e.cells.length);f.innerHTML=formatStatus[d[b].state]}}}}function addEventMatch(){$("#main").hide();$("#add").show()}function addMatchMonth(){$("#main").hide();$("#add").show()}function showLoading(){$("body").append("<div class='loading_wrap'><span class='loading_ico'></span></div>")}function hideLoading(){$(".loading_wrap").remove()}function takeEventMatch(a){showLoading();$.ajax({type:"post",url:getPath()+"/web/bet/guess/match.do",data:"matchNum="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){console.info(b);hideLoading();if(b.s==200){$("#matchTime").val(b.r.matchTime);$("#league").val(b.r.league);$("#homeName").val(b.r.home);$("#awayName").val(b.r.guest);$("#concedeNum").val(b.r.bet[0].let);$("#salestartTime").val(b.r.start);$("#saleendTime").val(b.r.stop)}},error:function(b,d,c){hideLoading();console.log(b.responseText);console.log(b.status);console.log(b.readyState);console.log(b.statusText);console.log(d);console.log(c)}})}function submitEventMatch(){startTime=document.getElementById("salestartTime").value;endTime=document.getElementById("saleendTime").value;leagueName=document.getElementById("league").value;homeName=document.getElementById("homeName").value;awayName=document.getElementById("awayName").value;matchTime=document.getElementById("matchTime").value;matchNum=document.getElementById("matchNum").value;concedeNum=document.getElementById("concedeNum").value;var a=document.getElementById("prov").value;if(startTime==""||endTime==""||league==""||homeName==""||awayName==""||matchTime==""||matchNum==""||concedeNum==""){alert("比赛信息不得为空.")}else{$.ajax({type:"POST",url:getPath()+"/activity/addMatch.do",data:"startTime="+startTime+"&endTime="+endTime+"&league="+league+"&homeName="+homeName+"&awayName="+awayName+"&leagueName="+leagueName+"&matchTime="+matchTime+"&matchNum="+matchNum+"&concedeNum="+concedeNum+"&prov="+a,dataType:"text",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){alert("赛事添加成功");window.location.reload()},})}}function searchMatchList(b){b=b/8;document.getElementById("res").innerHTML="";startTime=document.getElementById("startTime").value;endTime=document.getElementById("endTime").value;state=document.getElementById("status").value;var a=document.getElementById("prov").value;if(startTime==""&&endTime!=""){alert("开始时间不能为空");return}if(startTime!=""&&endTime==""){alert("结束时间不能为空");return}$.ajax({type:"POST",url:getPath()+"/activity/searchMatchList.do?",data:"startTime="+startTime+"&endTime="+endTime+"&status="+state+"&page="+b+"&flag=0&prov="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){state=document.getElementById("status").value;if(e.r.length>0){drawPages(e.c,"searchMatchList",b*8);for(var d=0;d<e.r.length;d++){if(e.r[d].odds!=""){odds=$.parseJSON(e.r[d].odds);oddsdisplay="胜("+odds.odd3/1000+")  负("+odds.odd0/1000+")"}else{oddsdisplay="暂无"}if(e.r[d].result!=null){if(e.r[d].result=="1"){result="平局"}else{if(e.r[d].result=="0"){result="主负"}else{if(e.r[d].result=="3"){result="主胜"}}}}else{result="暂无"}if(state!="1"&&state!="2"){var c=Date.parse(new Date());if(state!="1"&&state!="2"){if(e.r[d].status==0){if(c<e.r[d].startTime){document.getElementById("res").innerHTML+="<tr><td>"+formatDate(e.r[d].matchTime)+"</td><td>"+e.r[d].matchNum+"</td><td>"+e.r[d].leagueName+"</td><td>"+e.r[d].awayName+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].concedeNum1+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>待销售</td><td><a href= 'javascript:showEventMatch("+e.r[d].id+")'>详情</a>&nbsp&nbsp<a href= 'javascript:modifyEventMatch("+e.r[d].id+",1)'>修改</a></td><tr>";document.getElementById("res").innerHTML+='<tr  style="display:none" id="match'+e.r[d].id+'"><td>赔率<td>'+oddsdisplay+"<td>赛果</td><td>"+result+"</td><td></td><td></td><td></td><td></td><td></td><td><a href= 'javascript:hideEventMatch("+e.r[d].id+")'>收起</a></td></tr>"}else{if(c<=e.r[d].endTime&&c>=e.r[d].startTime){document.getElementById("res").innerHTML+="<tr><td>"+formatDate(e.r[d].matchTime)+"</td><td>"+e.r[d].matchNum+"</td><td>"+e.r[d].leagueName+"</td><td>"+e.r[d].awayName+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].concedeNum1+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>销售中</td><td><a href= 'javascript:showEventMatch("+e.r[d].id+")'>详情</a>&nbsp&nbsp<a href= 'javascript:modifyEventMatch("+e.r[d].id+",1)'>修改</a></td><tr>";document.getElementById("res").innerHTML+='<tr  style="display:none" id="match'+e.r[d].id+'"><td>赔率<td>'+oddsdisplay+"<td>赛果</td><td>"+result+"</td><td></td><td></td><td></td><td></td><td></td><td><a href= 'javascript:hideEventMatch("+e.r[d].id+")'>收起</a></td></tr>"}else{if(c>e.r[d].endTime){document.getElementById("res").innerHTML+="<tr><td>"+formatDate(e.r[d].matchTime)+"</td><td>"+e.r[d].matchNum+"</td><td>"+e.r[d].leagueName+"</td><td>"+e.r[d].awayName+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].concedeNum1+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已截止</td><td><a href= 'javascript:showEventMatch("+e.r[d].id+")'>详情</a></td><tr>";document.getElementById("res").innerHTML+='<tr  style="display:none" id="match'+e.r[d].id+'"><td>赔率<td>'+oddsdisplay+"<td>赛果</td><td>"+result+"</td><td></td><td></td><td></td><td></td><td></td><td><a href= 'javascript:hideEventMatch("+e.r[d].id+")'>收起</a></td></tr>"}}}}else{if(e.r[d].status==1){document.getElementById("res").innerHTML+="<tr><td>"+formatDate(e.r[d].matchTime)+"</td><td>"+e.r[d].matchNum+"</td><td>"+e.r[d].leagueName+"</td><td>"+e.r[d].awayName+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].concedeNum1+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已返奖</td><td><a href= 'javascript:showEventMatch("+e.r[d].id+")'>详情</a>&nbsp&nbsp</td><tr>";document.getElementById("res").innerHTML+='<tr  style="display:none" id="match'+e.r[d].id+'"><td>赔率</td><td>'+oddsdisplay+"</td><td>赛果</td><td>"+result+"</td><td></td><td></td><td></td><td></td><td></td><td><a href= 'javascript:hideEventMatch("+e.r[d].id+")'>收起</a></td></tr>"}}}}else{if(state==1){document.getElementById("res").innerHTML+="<tr><td>"+formatDate(e.r[d].matchTime)+"</td><td>"+e.r[d].aliasNum+"</td><td>"+e.r[d].leagueName+"</td><td>"+e.r[d].awayName+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].concedeNum+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已返奖</td><td><a href= 'javascript:showEventMatch("+e.r[d].id+")'>详情</a>&nbsp&nbsp</td><tr>";document.getElementById("res").innerHTML+='<tr  style="display:none" id="match'+e.r[d].id+'"><td>赔率</td><td>'+oddsdisplay+"</td><td>赛果</td><td>"+result+"</td><td></td><td></td><td></td><td></td><td></td><td><a href= 'javascript:hideEventMatch("+e.r[d].id+")'>收起</a></td></tr>"}else{if(state==2){document.getElementById("res").innerHTML+="<tr><td>"+formatDate(e.r[d].matchTime)+"</td><td>"+e.r[d].aliasNum+"</td><td>"+e.r[d].leagueName+"</td><td>"+e.r[d].awayName+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].concedeNum+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已开奖</td><td><a href= 'javascript:showEventMatch("+e.r[d].id+")'>详情</a>&nbsp&nbsp</td><tr>";document.getElementById("res").innerHTML+='<tr  style="display:none" id="match'+e.r[d].id+'"><td>赔率</td>'+oddsdisplay+"<td>赛果</td><td>"+result+"</td><td></td><td></td><td></td><td></td><td></td><td><a href= 'javascript:hideEventMatch("+e.r[d].id+")'>收起</a></td></tr>"}}}}}else{document.getElementById("res").innerHTML+="<td></td><td></td><td></td><td></td><td>无数据!</td>";drawPages(e.c,"searchMatchList",b*8)}},})}function showEventMatch(b){var a=document.getElementById("match"+b);a.style.display=""}function hideEventMatch(b){var a=document.getElementById("match"+b);a.style.display="none"}function modifyEventMatch(b,a){$("#main").hide();$("#modify").show();$.ajax({type:"POST",url:getPath()+"/activity/searchIdMatch.do",data:"id="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){$("#MsalestartTime").val(formatDate(c.r[0].startTime));$("#MsaleendTime").val(formatDate(c.r[0].endTime));if(a==1){$("#MmatchTime").val(formatDate(c.r[0].matchTime));$("#MmatchNum").val(c.r[0].matchNum.substring(0,8)+c.r[0].matchNum.substring(9,12));$("#Mleague").val(c.r[0].leagueName);$("#MhomeName").val(c.r[0].homeName);$("#MawayName").val(c.r[0].awayName);concedeNum=c.r[0].concedeNum1;$("#MconcedeNum").val(concedeNum);document.getElementById("modifyMatch").innerHTML+='<td><input class="search_but" type="button" value="提交" onclick="submitModifyEventMatch('+b+')"></td>'}else{if(a==2){$("#mname").val(c.r[0].homeName);$("#mposition").val(c.r[0].awayName);$("#mtype").val(c.r[0].type);$("#mremark").val(c.r[0].remark);$("#moption1").val(c.r[0].option1);$("#moption2").val(c.r[0].option2);$("#moption3").val(c.r[0].option3);$("#picturePath").val(c.r[0].picture);$("#memberPicview1").html('<img src="'+c.r[0].picture+'" width="78px" height="78px">');document.getElementById("modifyMatch").innerHTML+='<td><input class="search_but" type="button" value="提交" onclick="submitModifyGuessing('+b+')"></td>'}}}})}function submitModifyEventMatch(b){startTime=document.getElementById("MsalestartTime").value;endTime=document.getElementById("MsaleendTime").value;leagueName=document.getElementById("Mleague").value;homeName=document.getElementById("MhomeName").value;awayName=document.getElementById("MawayName").value;matchTime=document.getElementById("MmatchTime").value;matchNum=document.getElementById("MmatchNum").value;concedeNum=document.getElementById("MconcedeNum").value;var a=document.getElementById("prov").value;$.ajax({type:"POST",url:getPath()+"/activity/ModifyIdMatch.do",data:"id="+b+"&startTime="+startTime+"&endTime="+endTime+"&league="+league+"&homeName="+homeName+"&awayName="+awayName+"&leagueName="+leagueName+"&matchTime="+matchTime+"&matchNum="+matchNum+"&concedeNum="+concedeNum+"&prov="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){}});alert("赛事修改成功");window.location.reload()}function orderByWinIntegral(){var a=$("#flag").val();$(".table_title img").remove();if(a==0){$(".table_title a").append(" <img src='../images/arrow.png'>");$("#flag").val(1);searchEventStatistics(0)}else{if(a==1){$(".table_title a").append(" <img src='../images/arrow2.png'>");$("#flag").val(2);searchEventStatistics(0)}else{$("#flag").val(0);searchEventStatistics(0)}}}function searchEventStatistics(l){showRunning(7);var c=document.getElementById("startTime").value;var f=document.getElementById("endTime").value;var n=document.getElementById("startBetCount").value;var o=document.getElementById("endBetCount").value;var e=document.getElementById("startLoginSum").value;var a=document.getElementById("endLoginSum").value;var g=document.getElementById("startAwardSum").value;var d=document.getElementById("endAwardSum").value;var m=document.getElementById("startConsumeSum").value;var k=document.getElementById("endConsumeSum").value;var b=document.getElementById("telNum").value;var h=document.getElementById("flag").value;if(c==""&&f!=""){alert("开始时间不能为空");return}if(c!=""&&f==""){alert("结束时间不能为空");return}if(h==0){$(".table_title img").remove()}$.ajax({type:"POST",url:getPath()+"/activity/searchStatisticsList.do",data:"startTime="+c+"&endTime="+f+"&startBetCount="+n+"&endBetCount="+o+"&startLoginSum="+e+"&endLoginSum="+a+"&startAwardSum="+g+"&endAwardSum="+d+"&startConsumeSum="+m+"&endConsumeSum="+k+"&startIdx="+l+"&telNum="+b+"&flag="+h,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(p){searchStatisticsCallback(p)},})}function searchStatisticsCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchEventStatistics",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=7;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchEventStatistics",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=d[b].mobile;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].firstLoginTime);f=e.insertCell(e.cells.length);f.innerHTML=d[b].loginSum;f=e.insertCell(e.cells.length);f.innerHTML=d[b].awardCount;f=e.insertCell(e.cells.length);f.innerHTML=d[b].awardSum.toFixed(2);f=e.insertCell(e.cells.length);f.innerHTML=d[b].betCount;f=e.insertCell(e.cells.length);f.innerHTML=d[b].betSum}}}}function getProvince(){$.ajax({type:"post",url:getPath()+"/lotterySite/getProvince.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c!=null&&c.length>0){var b=document.getElementById("proSelect");for(var a=0;a<c.length;a++){b.options[b.options.length]=new Option(c[a].provName,c[a].provNum+","+c[a].provName,false,false)}}}})}function getCity(a){var b=document.getElementById("citySelect");b.innerHTML="";$.ajax({type:"post",url:getPath()+"/lotterySite/getCity.do",data:"provinceNum="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d!=null&&d.length>0){for(var c=0;c<d.length;c++){b.options[b.options.length]=new Option(d[c].cityName,d[c].cityName,false,false)}}}})}function addLotterySite(){var a=document.getElementById("lid").value;if(a){var m=document.getElementById("siteId").value;var c=document.getElementById("lotProv").value;var p=document.getElementById("lotCity").value;var g=$("#siteType").find("option:selected").text();var h=$("#siteStan").find("option:selected").text()}else{var m=document.getElementById("storeNum").value;var c=$("#proSelect").find("option:selected").text();var p=$("#citySelect").find("option:selected").text();var g=$("#storeType").find("option:selected").text();var h=$("#storeStan").find("option:selected").text()}var f=document.getElementById("storeAddr").value;var d=document.getElementById("lolatitude").value;var e=document.getElementById("fisPhone").value;var q=document.getElementById("secPhone").value;var o=document.getElementById("openTime").value;if(m==null||m==""){alert("请填写网店编号！");return}if(c==null||c==""){alert("请选择省份！");return}if(p==null||p==""){alert("请选择城市！");return}if(f==null||f==""){alert("请填写详细地址！");return}if(d==null||d==""){alert("请填写经纬度！");return}if(e==null||e==""){alert("请填写区号！");return}if(q==null||q==""){alert("请填写电话号码！");return}if(o==null||o==""){alert("请选择开通时间！");return}if(g==null||g==""){alert("请选择类型！");return}if(h==null||h==""){alert("请选择标准！");return}var b=d.split(",");if(b.length!=2){alert("经纬度格式错误！");return}if(isNaN(b[0])||b[0].indexOf(".")<=0){alert("经度格式错误！");return}if(isNaN(b[1])||b[1].indexOf(".")<=0){alert("纬度格式错误！");return}var n="";$("#picview img").each(function(){n+=getMediaPath($(this).attr("src"))+";"});if(n!=""){n=n.substring(0,n.length-1)}var l=document.getElementById("remark").value;if(l.length>512){alert("备注过长！");return}var k="&storeNum="+m+"&proSelect="+c+"&citySelect="+p+"&storeAddr="+f+"&lolatitude="+d+"&phone="+e+"-"+q+"&openTime="+o+"&storeType="+g+"&storeStan="+h+"&picPath="+n+"&remark="+l+"&id="+a;$.ajax({type:"post",url:getPath()+"/lotterySite/addLotterySite.do",data:k,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(r){if(r.r=="success"){alert("保存成功！");window.location=getPath()+"/html/searchLotterySite.html"}else{if(r.r=="duplicateStoreNum"){alert("网店编号已存在！")}else{alert("发布失败！")}}}})}function searchLotterySite(c){showRunning(12);var f=$("#proSelect").find("option:selected").text();var g=$("#citySelect").find("option:selected").text();var e=$("#storeType").find("option:selected").text();var a=$("#storeStan").find("option:selected").text();var d=document.getElementById("storeNum").value;var b=document.getElementById("status").value;$.ajax({type:"post",url:getPath()+"/lotterySite/searchLotterySite.do",data:"proSelect="+f+"&citySelect="+g+"&status="+b+"&storeType="+e+"&storeStan="+a+"&storeNum="+d+"&startIdx="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(h){searchLotterySiteCallback(h)}})}function searchLotterySiteCallback(a){var h,b,e;var f=document.getElementById("res");while(f.rows.length>0){f.removeChild(f.firstChild)}if(a==null||!(a.r instanceof Array)||a.r.length<1){drawPages(0,"searchLotterySite",0);h=f.insertRow(f.rows.length);b=h.insertCell(h.cells.length);b.colSpan=12;b.innerHTML=noRecord;h.style.height="200px"}else{drawPages(a.c,"searchLotterySite",a.s);var d=a.r;for(e=0;e<d.length;e++){if(d[e]!=null){h=f.insertRow(f.rows.length);h.className="td_int";b=h.insertCell(h.cells.length);b.innerHTML=d[e].siteId;b=h.insertCell(h.cells.length);b.innerHTML=d[e].province;b=h.insertCell(h.cells.length);b.innerHTML=d[e].city;b=h.insertCell(h.cells.length);b.innerHTML=d[e].address;b=h.insertCell(h.cells.length);if(d[e].mediaPath!=null&&d[e].mediaPath!=""){var g=d[e].mediaPath.split(";");var k="";for(var c=1;c<=g.length;c++){if(c>1){k+=","}k+="<a href=\"javascript:previewMsg('x"+c+"-"+e+"')\">图片"+c+'</a><span id="x'+c+"-"+e+'" style="display:none"><img src=\''+downloadPath+g[c-1]+"'></span>"}b.innerHTML=k}else{b.innerHTML=""}b=h.insertCell(h.cells.length);b.innerHTML=d[e].x+","+d[e].y;b=h.insertCell(h.cells.length);b.innerHTML=d[e].phone;b=h.insertCell(h.cells.length);b.innerHTML=formatDateNoTime(d[e].openTime);b=h.insertCell(h.cells.length);b.innerHTML=d[e].type1;b=h.insertCell(h.cells.length);b.innerHTML=d[e].type2;b=h.insertCell(h.cells.length);if(d[e].remark){if(d[e].remark.length>5){b.innerHTML=d[e].remark.substring(0,5)+"..."}else{b.innerHTML=d[e].remark}}else{b.innerHTML=""}b=h.insertCell(h.cells.length);if(d[e].status==0){b.innerHTML="未同步"}else{b.innerHTML="已同步"}}}}}function uploadSite(fileElementId){var exl=document.getElementById("exlFile").value;if(exl==""){alert("请上传文件");return}$.ajaxFileUpload({url:getPath()+"/lotterySite/excelImport.do?filename="+fileElementId,secureuri:false,fileElementId:fileElementId,dataType:"txt",async:false,success:function(data,status){if(data.split(">").length>1){data=data.substring(data.indexOf(">")+1,data.length-6)}eval("data = "+data);if(data.r=="errorFile"){alert("上传的文件格式错误！");return}if(data.r=="duplicateStoreNum"){alert("有重复网店编号！");return}if(data.r=="fail"){alert("上传失败！");return}if(data.r=="ok"){alert("上传成功！");window.location=getPath()+"/html/searchLotterySite.html"}}})}function exportLotterySite(){document.getElementById("lotteryForm").action=getPath()+"/lotterySite/lotterySiteExport.do";document.getElementById("lotteryForm").submit()}function synLotterySite(){$.ajax({type:"post",url:getPath()+"/lotterySite/synLotterySite.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a.r=="success"){alert("同步成功！")}else{alert("同步失败！")}}})}function userListOrder(){var a=$("#flag1").val();$(".pay img").remove();$(".sign img").remove();$("#flag2").val(0);if(a==1){$(".pay a").append(" <img src='../images/arrow2.png'>");$("#flag1").val(2)}else{$(".pay a").append(" <img src='../images/arrow.png'>");$("#flag1").val(1)}userSearch(0)}function userListOrderBaySign(){var a=$("#flag2").val();$(".pay img").remove();$(".sign img").remove();$("#flag1").val(1);if(a==0){$(".sign a").append(" <img src='../images/arrow.png'>");$("#flag2").val(1)}else{if(a==1){$(".sign a").append(" <img src='../images/arrow2.png'>");$("#flag2").val(2)}else{$(".pay a").append(" <img src='../images/arrow.png'>");$("#flag2").val(0)}}userSearch(0)}function initProvince(){$.ajax({type:"get",url:getPath()+"/web/getProvince.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c){var a=document.getElementById("province");for(var b=0;b<c.length;b++){a.options[a.options.length]=new Option(c[b].name,c[b].name,false,false)}a.options[a.options.length]=new Option("其它","其它",false,false)}},error:function(b,a){}})}function menuStat(){var b=document.getElementById("startTime").value;var a=document.getElementById("endTime").value;if(b==""||a==""){alert("起始时间不能为空")}else{if(b>a){document.getElementById("endTime").value=b;a=b}$.ajax({type:"post",url:getPath()+"/manage/menuStat.do",data:"startTime="+b+"&endTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){menuStatCallback(c)}})}}function menuStatCallback(e){var d,g,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(e==null||e.length<1||!(e instanceof Array)){d=a.insertRow(a.rows.length);g=d.insertCell(d.cells.length);g.colSpan=3;g.innerHTML=noRecord;d.style.height="200px"}else{var c=0;for(b=0;b<e.length;b++){if(e[b]!=null){c+=parseInt(e[b].count,10)}}for(b=0;b<=e.length;b++){if(e[b]!=null){d=a.insertRow(a.rows.length);d.className="td_int";g=d.insertCell(d.cells.length);g.innerHTML=e[b].name;g=d.insertCell(d.cells.length);g.innerHTML=e[b].count;g=d.insertCell(d.cells.length);var f=0;if(e[b].count!=0&&c!=0){f=(e[b].count/c*100).toFixed(2)}g.innerHTML=f+"%"}}d=a.insertRow(a.rows.length);d.className="td_int";g=d.insertCell(d.cells.length);g.innerHTML="合计";g=d.insertCell(d.cells.length);g.innerHTML=c;g=d.insertCell(d.cells.length);g.innerHTML=100+"%"}}function deleteLotterySite(b,a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/lotterySite/deleteLotterySite.do",data:"id="+b+"&siteId="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="success"){alert("删除成功！");window.location.reload()}if(c.r=="fail"){alert("删除失败！")}}})}}function adjustmentAmount(){var c=$("#openId").val(),a=$("#amount").val(),b=$("#reason").val();if(a==""){alert("调账额度不能为空");return}$.ajax({type:"POST",url:getPath()+"/manage/adjustmentAmount.do",data:"&openId="+c+"&amount="+a+"&reason="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){closeWindow();if(d.r=="ok"){alert("调账成功");userTrans(0,c)}else{alert(d.message)}},error:function(e,d){}})}function loadIntegration(){$.ajax({type:"post",url:getPath()+"/integrationRank/loadIntegration.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a.c>0){$("#pInteg").css("display","");searchIntegration(0)}else{$("#rankTime1").val(a.d);$("#rankStatus1").val("未发布");$("#cInteg").css("display","")}}})}function countIntegration(){$.ajax({type:"post",url:getPath()+"/integrationRank/countIntegration.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a.r=="success"){$("#pInteg").css("display","");$("#cInteg").css("display","none");searchIntegration(0)}else{alert("统计失败！")}}})}function searchIntegration(c){var d=document.getElementById("mType").value;var a="";var b="";if(d!="0"){a=document.getElementById("issue").value;b=document.getElementById("day").value}$.ajax({type:"post",url:getPath()+"/integrationRank/getIntegrationRank.do",data:"issue="+a+"&day="+b+"&startIdx="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(d=="0"){if(f.r.length>0){var e=f.r[0];$("#rankTime").val(formatDateNoTime(e.statTime)+" 第"+e.issue+"期第"+e.day+"天");if(e.status=="1"){document.getElementById("rankStatus").value="已发布"}else{document.getElementById("rankStatus").value="未发布"}}}else{if(f.r.length>0){var e=f.r[0];$("#rankTime").val(formatDateNoTime(e.statTime))}}searchIntegrationCallback(f,d,c)}})}function searchIntegrationCallback(e,d,c){var g,h,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(e==null||!(e.r instanceof Array)||e.r.length<1){drawPages(0,"searchIntegration",0);g=a.insertRow(a.rows.length);h=g.insertCell(g.cells.length);h.colSpan=6;h.innerHTML=noRecord;g.style.height="200px"}else{drawPages(e.c,"searchIntegration",e.s);var f=e.r;for(b=0;b<f.length;b++){if(f[b]!=null){g=a.insertRow(a.rows.length);g.className="td_int";h=g.insertCell(g.cells.length);h.innerHTML=b+1+c;h=g.insertCell(g.cells.length);h.innerHTML=f[b].mobile;h=g.insertCell(g.cells.length);h.innerHTML=f[b].integration;h=g.insertCell(g.cells.length);h.innerHTML=formatDate(f[b].lastBetTime);h=g.insertCell(g.cells.length);if(f[b].flag==1){h.innerHTML="马甲"}if(d=="0"){h=g.insertCell(g.cells.length);if(f[b].flag==1&&f[b].status==0){h.innerHTML="<a href= 'javascript:deleteIntegration("+f[b].id+")'>删除</a>"}}}}}}function addIntegration(){var a=document.getElementById("rankStatus").value;if(a=="已发布"){alert("排名已发布！");return}$("#rankAdd").css("display","");$("#rankSearch").css("display","none")}function saveIntegration(){var a=document.getElementById("phoneNum").value;var b=document.getElementById("integral").value;var c=document.getElementById("rankTime").value;if(a==null||a==""){alert("请填写手机号！");return}if(b==null||b==""){alert("请填写累计中奖积分！");return}$.ajax({type:"post",url:getPath()+"/integrationRank/addIntegrationRank.do",data:"phoneNum="+a+"&integral="+b+"&issue="+c.slice(-5,-4)+"&day="+c.slice(-2,-1),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d.r=="success"){alert("添加成功！");window.location.reload()}else{alert("添加失败！")}}})}function publishIntegration(){var a=document.getElementById("rankStatus").value;if(a=="已发布"){alert("排名已发布！");return}if(confirm("确认发布？")){$.ajax({type:"post",url:getPath()+"/integrationRank/publishIntegrationRank.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="success"){alert("发布成功！");window.location.reload()}else{if(b.r=="noIntegration"){alert("没有数据！")}else{alert("发布失败！")}}}})}}function deleteIntegration(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/integrationRank/deleteIntegrationRank.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="success"){alert("删除成功！");window.location.reload()}else{alert("删除失败！")}}})}}function exportIntegration(){var a=document.getElementById("issue").value;var b=document.getElementById("day").value;location.href=getPath()+"/integrationRank/exportIntegrationRank.do?issue="+a+"&day="+b}function getPubStatus(){$.ajax({type:"post",url:getPath()+"/integrationRank/getPubStatus.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a!=null&&a!=""){if(a.value=="0"){document.getElementById("autoPub").checked="checked"}if(a.value=="1"){document.getElementById("handPub").checked="checked"}}}})}function setIntegeration(){var a;if(document.getElementById("autoPub").checked==true){a="0"}if(document.getElementById("handPub").checked==true){a="1"}$.ajax({type:"post",url:getPath()+"/integrationRank/updatePubStatus.do",data:"publishParam="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="success"){alert("设置成功！");window.location.reload()}else{alert("设置失败！")}}})}function moduleSearch(a){$.ajax({type:"post",url:getPath()+"/learn/getLearnList.do?",data:"startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchModuleCallback(b)}})}function searchModuleCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"moduleSearch",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=5;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"moduleSearch",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML="<input type='checkbox' value='"+d[b].id+"'/>";f=e.insertCell(e.cells.length);f.innerHTML=d[b].sequence;f=e.insertCell(e.cells.length);f.innerHTML=d[b].name;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].publishTime);f=e.insertCell(e.cells.length);f.innerHTML="<a href= 'javascript:updateModule("+d[b].id+")'>修改</a>&nbsp;&nbsp;&nbsp;<a href= 'javascript:delModule("+d[b].id+")'>删除</a>"}}}}function submitModule(){var b=document.getElementById("moduleName").value;var f=document.getElementById("sequence").value;var a=document.getElementById("url").value;var e=document.getElementById("moduleId").value;var d=$("#picview img").attr("src");var c=$("#picview1 img").attr("src");if(!b||!f||!a||!d||!c){alert("请输入完整的信息");return}if(e==0){$.ajax({type:"post",url:getPath()+"/learn/addModule.do?",data:"name="+b+"&sequence="+f+"&url="+a+"&logoUrl="+d+"&logoUrl2="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){if(g.r=="ok"){window.location=getPath()+"/html/focusImgManage.html";alert("添加成功")}else{alert(g.message)}}})}else{$.ajax({type:"post",url:getPath()+"/learn/updateModule.do?",data:"name="+b+"&sequence="+f+"&url="+a+"&id="+e+"&logoUrl="+d+"&logoUrl2="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){if(g.r=="ok"){alert("修改成功")}else{alert(g.message)}}})}}function toFocusImg(){window.location=getPath()+"/html/focusImgManage.html"}function delModule(a){if(confirm("确认删除吗？")){$.ajax({type:"post",url:getPath()+"/learn/delModule.do?",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="ok"){alert("删除成功");moduleSearch(0)}}})}}function updateModule(a){window.location=getPath()+"/html/focusImgManage.html?id="+a}function loadModuleInfo(){var b,a=location.search.substring(1,location.search.length),c=0;if(a.length>0){b=parseParam(a);c=b.id}$("#moduleId").val(c);if(c!=0){$.ajax({type:"post",url:getPath()+"/learn/getLearnList.do?",data:"startIdx=0&id="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){dt=f.r[0];$("#moduleName").val(dt.name);$("#sequence").val(dt.sequence);$("#url").val(dt.url);var e=document.getElementById("picview");e.innerHTML="<img src='"+dt.logoUrl+"'>";var d=document.getElementById("picview1");d.innerHTML="<img src='"+dt.logoUrl2+"'>";$("#handle").val("修改")}})}}function selectAll(){var c=document.getElementById("selectAll");var a=document.getElementById("res").children;if(c.checked){for(var b=0;b<a.length;b++){var d=a[b].children[0].children[0];d.checked=true}}else{for(var b=0;b<a.length;b++){var d=a[b].children[0].children[0];d.checked=false}}}function batchDelModule(){var b=[],a=document.getElementById("res").children;var d=document.getElementById("selectAll");for(var c=0;c<a.length;c++){var e=a[c].children[0].children[0];if(e&&e.checked){b.push(e.value)}}if(b.length==0){alert("请选择刪除內容");return}if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/learn/batchDeletModule.do",data:"moduleIds="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f.r=="ok"){d.checked=false;moduleSearch(0)}else{alert("删除失败！")}},error:function(g,f){}})}}function cancel(){window.location=getPath()+"/html/moduleManage.html"}function lotteryCancel(){window.location=getPath()+"/html/searchLotterySite.html"}function switchNotice(){$("#noticeSearch").hide();$("#notice").show()}function modifyNotice(){var c=document.getElementById("title").value;var d=document.getElementById("noticeId").value;var a=UE.getEditor("container");if(c==""){alert("请填写标题");return}if(!a.hasContents()){alert("请填写正文");return}var b=a.getContent();$.ajax({type:"post",url:getPath()+"/notice/modifyNotice.do?",data:"id="+d+"&title="+encodeURIComponent(c)+"&txt="+encodeURIComponent(b),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e.r=="success"){window.location.reload();if(d){alert("修改成功")}else{alert("添加成功")}}else{alert(e.r)}}})}function noticeSearch(b){var c=document.getElementById("beginTime").value;var a=document.getElementById("endTime").value;if(c==""&&a!=""){alert("开始时间不能为空");return}if(c!=""&&a==""){alert("结束时间不能为空");return}showRunning(4);$.ajax({type:"post",url:getPath()+"/notice/noticeSearch.do?",data:"startIdx="+b+"&startTime="+c+"&endTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){searchNoticeCallback(d)}})}function searchNoticeCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"noticeSearch",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=4;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"noticeSearch",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML="<input type='checkbox' value='"+d[b].id+"'/>";f=e.insertCell(e.cells.length);f.className="td_left";f.innerHTML="<a href=\"javascript:previewMsg('x"+b+"')\">"+d[b].title+'</a><span id="x'+b+'" style="display:none">'+d[b].txt+"</span>";f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].createTime);f=e.insertCell(e.cells.length);f.innerHTML="<a href= 'javascript:updateNotice("+d[b].id+")'>修改</a>&nbsp;&nbsp;&nbsp;<a href= 'javascript:delNotice("+d[b].id+")'>删除</a>"}}}}function delNotice(a){if(confirm("确认删除吗？")){$.ajax({type:"post",url:getPath()+"/notice/deleteNotice.do?",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="success"){alert("删除成功");noticeSearch(0)}}})}}function updateNotice(b){switchNotice();var a=document.getElementById("addButten");a.innerHTML="修改";document.getElementById("noticeId").value=b;$.ajax({type:"post",url:getPath()+"/notice/noticeSearch.do?",data:"id="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e){var d=e.r;document.getElementById("title").value=d[0].title;var c=UE.getEditor("container");c.ready(function(){c.setContent(d[0].txt)})}}})}function batchDelInfo(){var c=[],a=document.getElementById("res").children;var d=document.getElementById("selectAll");for(var b=0;b<a.length;b++){var e=a[b].children[0].children[0];if(e&&e.checked){c.push(e.value)}}if(c.length==0){alert("请选择刪除內容");return}if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/notice/batchDeletInfo.do",data:"InfoIds="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f.r=="ok"){d.checked=false;noticeSearch(0)}else{alert("删除失败！")}},error:function(g,f){}})}}function getTradMatchNum(){var a=document.getElementById("gameNum").value;$.ajax({type:"post",url:getPath()+"/tradMatch/getTradMatchNum.do?gameNum="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d!=null&&d.length>0){var c=document.getElementById("tradMatchNumSelect");for(var b=0;b<d.length;b++){c.options[c.options.length]=new Option(d[b],d[b],false,false)}}}})}function searchTradMatch(b){var c=document.getElementById("gameNum").value;var a=document.getElementById("tradMatchNumSelect").value;showRunning(5);$.ajax({type:"post",url:getPath()+"/tradMatch/searchTradMatch.do",data:"gameNum="+c+"&issue="+a+"&startIdx="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){searchTradMatchCallback(d)},error:function(d,f,e){console.log(d.responseText);console.log(d.status);console.log(d.readyState);console.log(d.statusText);console.log(f);console.log(e)}})}function searchTradMatchCallback(d){var f,g,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchTradMatch",0);f=a.insertRow(a.rows.length);g=f.insertCell(f.cells.length);g.colSpan=5;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchTradMatch",d.s);var e=d.r;for(b=0;b<e.length;b++){if(e[b]!=null){f=a.insertRow(a.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML="<input type='checkbox' value='"+e[b].id+"'/>";g=f.insertCell(f.cells.length);g.innerHTML=e[b].issue;g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[b].startTime);g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[b].stopTime);g=f.insertCell(f.cells.length);g.innerHTML="<a href= 'javascript:showTradMatch("+e[b].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:updateTradMatch("+e[b].id+")'>修改</a>&nbsp;&nbsp;<a href= 'javascript:inputLotteryResult("+e[b].id+")'>彩果录入</a>&nbsp;&nbsp;<a href= 'javascript:deleteTradMatch("+e[b].id+")'>删除</a>";f=a.insertRow(a.rows.length);f.className="td_int";f.style.display="none";f.id="tradMatch_"+e[b].id;g=f.insertCell(f.cells.length);g.colSpan=5;var c=getDetailMatch(e[b]);g.innerHTML=c}}}}function getDetailMatch(c){var a=c.matchs;var b=c.awardDeclares;var h="<div class='showViewStyle'><div class='right_em_con'>";if(a!=null&&a.length>0){h="<table cellpadding='0px' cellspacing='0px' class='main_table ww_100'><tr class='table_title'><td>序号</td><td>联赛</td><td>比赛日期</td><td>主队</td><td>客队</td><td>赛果</td><td>彩果</td></tr>";for(var d=0;d<a.length;d++){var e=d+1;if(e<10){e="0"+e}var g="",f="";if(a[d].result!=null){g=a[d].result}if(a[d].ext01!=null){f=a[d].ext01}h+="<tr class='td_int'><td>"+e+"</td><td>"+a[d].leagueName+"</td><td>"+formatDateNoTime(a[d].matchTime)+"</td><td>"+a[d].homeTeamName+"</td><td>"+a[d].guestTeamName+"</td><td>"+g+"</td><td>"+f+"</td></tr>"}h+="</table>"}if(b!=null&&b.length>0){var m,l,k;h+="<table cellpadding='0px' cellspacing='0px' class='main_table ww_100'>";for(d=0;d<b.length;d++){if(b[d].prizelevel=="一等奖"){h+="<tr class='td_int'><td>一等奖</td><td>"+b[d].prizeamount+"元</td><td>"+b[d].prizecount+"注</td></tr>"}if(b[d].prizelevel=="二等奖"){h+="<tr class='td_int'><td>二等奖</td><td>"+b[d].prizeamount+"元</td><td>"+b[d].prizecount+"注</td></tr>"}if(b[d].prizelevel=="任选九"){h+="<tr class='td_int'><td>任选九</td><td>"+b[d].prizeamount+"元</td><td>"+b[d].prizecount+"注</td></tr>"}}h+="</table><div class='goto_back'><a href= 'javascript:hideTradMatch("+c.id+")'>收回</a></div></div></div>"}else{h+="没有数据！<div class='goto_back'><a href= 'javascript:hideTradMatch("+c.id+")'>收回</a></div></div></div>"}return h}function showTradMatch(b){$("tr[id^=tradMatch_]").hide();var a=document.getElementById("tradMatch_"+b);a.style.display=""}function hideTradMatch(b){var a=document.getElementById("tradMatch_"+b);a.style.display="none"}function publishTradMatch(){showFetch();$("#tradMatchAdd").css("display","");$("#tradMatchSearch").css("display","none")}function showFetch(){$("#fetchT").css("display","");$("#fetchS").css("display","");fetchTerm()}function fetchTerm(){$("#fetchErr").empty();var a=document.getElementById("gameNum").value;showLoading();$.ajax({type:"post",url:getPath()+"/manage/fetch/term.do",data:{ltype:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){hideLoading();$("#termSelect").empty();if(c.s==200){$("#termSelect").append("<option value=''></option>");for(var b in c.r.tremList){$("#termSelect").append("<option value='"+c.r.tremList[b]+"'>"+c.r.tremList[b]+"</option>")}}else{$("#fetchErr").html(c.r)}}})}function showFetchButton(){$("#fetchButton").show()}function fetchMatch(){$("#fetchErr").empty();var b=document.getElementById("gameNum").value;var a=$("#termSelect").val();if(!a){$("#tradMatchForm")[0].reset();return}showLoading();$.ajax({type:"post",url:getPath()+"/manage/fetch/match.do",data:{ltype:b,term:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){hideLoading();if(e.s==200){$("#tradMatchNum").val(e.t.term);$("#startTime").val(e.t.startTime);$("#stopTime").val(e.t.endTime);for(var d in e.m){var c=parseInt(d)+1;$("#league"+c).val(e.m[d].matchName);$("#gameTime"+c).val(e.m[d].matchTime);$("#homeTeam"+c).val(e.m[d].hostTeam);$("#guestTeam"+c).val(e.m[d].guestTeam)}}else{$("#fetchErr").html(e.r)}}})}function fetchResults(){var b=document.getElementById("gameNum").value;var a=$("#lottrryResultTitle").html();showLoading();$.ajax({type:"post",url:getPath()+"/manage/fetch/match.do",data:{ltype:b,term:a,rst:1},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){hideLoading();if(f.s==200){var e=false;for(var d in f.m){var c=parseInt(d)+1;if(b==1014){if(f.m[d].result){$("#gameRes"+c).val(f.m[d].result);e=true}if(f.m[d].hostScore){$("#lotteryRes"+c).val(f.m[d].hostScore);e=true}}else{if(b==1004){if(f.m[d].hostScore&&f.m[d].result){$("#gameRes"+c).val(f.m[d].hostScore);$("#lotteryRes"+c).val(f.m[d].result);e=true}else{if(f.m[d].hostScore){$("#lotteryRes"+c).val(f.m[d].hostScore);e=true}}if(f.m[d].guestScore&&f.m[d].result2){$("#gameRes2"+c).val(f.m[d].guestScore);$("#lotteryRes2"+c).val(f.m[d].result2);e=true}else{if(f.m[d].guestScore){$("#lotteryRes"+c).val(f.m[d].guestScore);e=true}}}else{if(b==1006){if(f.m[d].hostScore){$("#lotteryRes"+c).val(f.m[d].hostScore);e=true}if(f.m[d].result){$("#gameRes2"+c).val(f.m[d].result);e=true}if(f.m[d].guestScore){$("#lotteryRes2"+c).val(f.m[d].guestScore);e=true}}}}}if(!e){$("#fetchRErr").html("暂无赛果彩果数据")}}else{$("#fetchRErr").html(f.r)}}})}function fetchMatchReward(){var b=document.getElementById("gameNum").value;var a=$("#lottrryResultTitle").html();showLoading();$.ajax({type:"post",url:getPath()+"/manage/fetch/reward.do",data:{ltype:b,term:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){hideLoading();if(e.s==200){var d=false;for(var c in e.r){if("一等奖"==e.r[c].level){if(e.r[c].money){$("#awardAmount1").val(e.r[c].money);d=true}if(e.r[c].piece){$("#awardCount1").val(e.r[c].piece);d=true}}else{if("二等奖"==e.r[c].level){if(e.r[c].money){$("#awardAmount2").val(e.r[c].money);d=true}if(e.r[c].piece){$("#awardCount2").val(e.r[c].piece);d=true}}else{if("任九"==e.r[c].level){if(e.r[c].money){$("#awardAmount3").val(e.r[c].money);d=true}if(e.r[c].piece){$("#awardCount3").val(e.r[c].piece);d=true}}}}}if(!d){$("#fetchRErr").html("暂无奖金数据")}}else{$("#fetchRErr").html(e.r)}}})}function saveTradMatch(){var a=document.getElementById("gameNum").value;var b=$("#tradMatchForm").serialize();$.ajax({type:"post",url:getPath()+"/tradMatch/saveTradMatch.do?gameNum="+a,data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="duplicateMatchNum"){alert("期号重复！")}if(c.r=="haveNullPoint"){alert("不可有字段为空！")}if(c.r=="success"){alert("发布成功！");window.location.reload()}if(c.r=="fail"){alert("发布失败！")}}})}function updateTradMatch(d){var c=document.getElementById("gameNum").value;var b,a;$.ajax({type:"post",url:getPath()+"/tradMatch/getTradMatchById.do",data:"id="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f!=null&&f!=""){$("#tradMatchAdd").css("display","");$("#tradMatchSearch").css("display","none");$("#tradMatchId").val(f.id);$("#tradMatchNum").val(f.issue);b=formatDate(f.startTime);a=formatDate(f.stopTime);$("#startTime").val(b.substring(0,b.length-3));$("#stopTime").val(a.substring(0,a.length-3));var e=0;if(c=="1014"){e=14}if(c=="1006"){e=6}if(c=="1004"){e=4}for(i=1;i<=e;i++){$("#matchId"+i).val(f.matchs[i-1].id);$("#league"+i).val(f.matchs[i-1].leagueName);$("#gameTime"+i).val(formatDateNoTime(f.matchs[i-1].matchTime));$("#homeTeam"+i).val(f.matchs[i-1].homeTeamName);$("#guestTeam"+i).val(f.matchs[i-1].guestTeamName)}}}})}function inputLotteryResult(b){var a=document.getElementById("gameNum").value;$.ajax({type:"post",url:getPath()+"/tradMatch/getTradMatchById.do",data:"id="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c!=null&&c!=""){showLotteryResult(c.matchs);showAwardResult(c.awardDeclares);document.getElementById("lottrryResultTitle").innerHTML=c.issue;$("#lottrryResult").css("display","");$("#tradMatchSearch").css("display","none")}}})}function showLotteryResult(b){var l,c,d;var e=document.getElementById("res1");var f,k;if(b!=null&&b.length>0){while(e.rows.length>0){e.removeChild(e.firstChild)}for(d=0;d<b.length;d++){l=e.insertRow(e.rows.length);l.className="td_int";c=l.insertCell(l.cells.length);f=d+1;k=f;if(f<10){k="0"+f}c.innerHTML=k+"<input type='text' id='lotteryId"+f+"' name='lotteryId"+f+"' style='display: none;' value='"+b[d].id+"'/>";c=l.insertCell(l.cells.length);c.innerHTML=b[d].leagueName;c=l.insertCell(l.cells.length);c.innerHTML=formatDateNoTime(b[d].matchTime);c=l.insertCell(l.cells.length);c.innerHTML=b[d].homeTeamName;c=l.insertCell(l.cells.length);c.innerHTML=b[d].guestTeamName;if(b[d].gameNum==1014){c=l.insertCell(l.cells.length);if(b[d].result!=null){c.innerHTML="<input type='text' id='gameRes"+f+"' name='gameRes"+f+"' value='"+b[d].result+"'/>"}else{c.innerHTML="<input type='text' id='gameRes"+f+"' name='gameRes"+f+"' value=''/>"}c=l.insertCell(l.cells.length);if(b[d].ext01!=null){c.innerHTML="<input type='text' id='lotteryRes"+f+"' name='lotteryRes"+f+"' value='"+b[d].ext01+"'/>"}else{c.innerHTML="<input type='text' id='lotteryRes"+f+"' name='lotteryRes"+f+"' value=''/>"}}else{var p,o,m,h;if(b[d].result){var q=b[d].result.split(",");if(q.length>0){p=q[0]}if(q.length>1){o=q[1]}}if(b[d].ext01){var n=b[d].ext01.split(",");if(n.length>0){m=n[0]}if(n.length>1){h=n[1]}}c=l.insertCell(l.cells.length);var a="<input type='text' id='gameRes"+f+"' name='gameRes"+f+"' value='";if(p){a+=p}a+="'/>&nbsp;&nbsp;";a+="<input type='text' id='lotteryRes"+f+"' name='lotteryRes"+f+"' value='";if(m){a+=m}a+="'/>";c.innerHTML=a;c=l.insertCell(l.cells.length);var g="<input type='text' id='gameRes2"+f+"' name='gameRes2"+f+"' value='";if(o){g+=o}g+="'/>&nbsp;&nbsp;";g+="<input type='text' id='lotteryRes2"+f+"' name='lotteryRes2"+f+"' value='";if(h){g+=h}g+="'/>";c.innerHTML=g}}}}function showAwardResult(a){var d,e,c;var b=document.getElementById("res2");if(a!=null&&a.length>0){while(b.rows.length>0){b.removeChild(b.firstChild)}for(c=0;c<a.length;c++){if(a[c].prizelevel=="一等奖"){d=b.insertRow(b.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML="一等奖<input type='text' id='awardId1' name='awardId1' style='display: none;' value='"+a[c].id+"'/>";e=d.insertCell(d.cells.length);e.innerHTML="<input type='text' id='awardAmount1' name='awardAmount1' value='"+a[c].prizeamount+"'/> 元";e=d.insertCell(d.cells.length);e.innerHTML="<input type='text' id='awardCount1' name='awardCount1' value='"+a[c].prizecount+"'/> 注"}if(a[c].prizelevel=="二等奖"){d=b.insertRow(b.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML="二等奖<input type='text' id='awardId2' name='awardId2' style='display: none;' value='"+a[c].id+"'/>";e=d.insertCell(d.cells.length);e.innerHTML="<input type='text' id='awardAmount2' name='awardAmount2' value='"+a[c].prizeamount+"'/> 元";e=d.insertCell(d.cells.length);e.innerHTML="<input type='text' id='awardCount2' name='awardCount2' value='"+a[c].prizecount+"'/> 注"}if(a[c].prizelevel=="任选九"){d=b.insertRow(b.rows.length);d.className="td_int";e=d.insertCell(d.cells.length);e.innerHTML="任选九<input type='text' id='awardId3' name='awardId3' style='display: none;' value='"+a[c].id+"'/>";e=d.insertCell(d.cells.length);e.innerHTML="<input type='text' id='awardAmount3' name='awardAmount3' value='"+a[c].prizeamount+"'/> 元";e=d.insertCell(d.cells.length);e.innerHTML="<input type='text' id='awardCount3' name='awardCount3' value='"+a[c].prizecount+"'/> 注"}}}}function savelottrryResult(){var a=document.getElementById("gameNum").value;var b=$("#lottrryResultForm").serialize();$.ajax({type:"post",url:getPath()+"/tradMatch/savelottrryResult.do?gameNum="+a,data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="success"){alert("发布成功！");window.location.reload()}if(c.r=="fail"){alert("发布失败！")}}})}function deleteTradMatch(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/tradMatch/deleteTradMatch.do",data:"matchIds="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("删除成功！");window.location.reload()}else{alert("删除失败！")}}})}}function batchDelTradMatch(){var c=[],a=document.getElementById("res").children;for(var b=0;b<a.length;b+=2){var d=a[b].children[0].children[0];if(d&&d.checked){c.push(d.value)}}if(c.length==0){alert("请选择刪除內容");return}deleteTradMatch(c)}function switchAward(){$("#rankSearch").hide();$("#rankAdd").show()}function importAwards(fileId){var exl=document.getElementById("exlFile").value;var title=document.getElementById("title").value;if(exl==""){alert("请上传文件");return}if(title==""){alert("请输入标题");return}$.ajaxFileUpload({url:getPath()+"/web/excelImport.do?filename="+fileId+"&title="+title,secureuri:false,fileElementId:fileId,dataType:"txt",async:false,success:function(data,status){if(data.split(">").length>1){data=data.substring(data.indexOf(">")+1,data.length-6)}eval("data = "+data);if(data.r=="errorFile"){alert("上传的文件格式错误！");return}if(data.r=="fail"){alert("上传失败！");return}if(data.r=="ok"){alert("上传成功！");window.location.reload()}}})}function awardSearch(a){var b=document.getElementById("issueRank").value;showRunning(5);$.ajax({type:"post",url:getPath()+"/web/awardSearch.do?",data:"title="+b+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){searchAwardCallback(c)}})}function searchAwardCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"awardSearch",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=5;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"awardSearch",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=d[b].rank;f=e.insertCell(e.cells.length);f.innerHTML=d[b].mobile;f=e.insertCell(e.cells.length);f.innerHTML=d[b].integration;f=e.insertCell(e.cells.length);f.innerHTML=d[b].ext01;f=e.insertCell(e.cells.length);f.innerHTML=d[b].award;f=e.insertCell(e.cells.length);if(d[b].code){f.innerHTML="******"}else{f.innerHTML=""}}}}}function issueLoad(){$.ajax({type:"post",url:getPath()+"/web/selectActiveIssue.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){var b=document.getElementById("issueRank");if(c&&c.r){for(var a=0;a<c.r.length;a++){b.options[b.options.length]=new Option(c.r[a].ext02,c.r[a].ext02,false,false)}awardSearch(0)}}})}function searchQuestion(b){var a=document.getElementById("queStatus").value;showRunning(6);$.ajax({type:"post",url:getPath()+"/question/searchQuestion.do",data:"status="+a+"&startIdx="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){searchQuestionCallback(c)}})}function searchQuestionCallback(d){var f,g,c;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchQuestion",0);f=b.insertRow(b.rows.length);g=f.insertCell(f.cells.length);g.colSpan=6;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchQuestion",d.s);var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=b.insertRow(b.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=e[c].title;g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].startTime);g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].stopTime);g=f.insertCell(f.cells.length);g.innerHTML=e[c].attendTimes;g=f.insertCell(f.cells.length);g.innerHTML=e[c].ext01+"题，  "+e[c].points+"积分";g=f.insertCell(f.cells.length);var a=Date.parse(new Date());if(e[c].startTime>a){g.innerHTML="未开始";g=f.insertCell(f.cells.length);g.innerHTML=e[c].ansTimes;g=f.insertCell(f.cells.length);g.innerHTML="<a href= 'javascript:showQuestion("+e[c].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:deleteQuestion("+e[c].id+")'>删除</a>"}else{if(e[c].startTime<=a&&e[c].stopTime>=a){g.innerHTML="进行中";g=f.insertCell(f.cells.length);g.innerHTML=e[c].ansTimes;g=f.insertCell(f.cells.length);g.innerHTML="<a href= 'javascript:showQuestion("+e[c].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:deleteQuestion("+e[c].id+")'>删除</a>"}else{if(e[c].stopTime<a){g.innerHTML="已结束";g=f.insertCell(f.cells.length);g.innerHTML=e[c].ansTimes;g=f.insertCell(f.cells.length);g.innerHTML="<a href= 'javascript:showQuestion("+e[c].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:deleteQuestion("+e[c].id+")'>删除</a>"}}}}}}}function nextStepOfQue(){$("#queDetail").css("display","");$("#queAdd").css("display","none")}function nextStepOfQue2(){var a=$(".frame_basic li .input").length;$(".frame_basic li .input").each(function(b){var c=$(this);if($(c).val()==""){$(c).focus();return false}else{if((b+1)==a){$("#queDetail").css("display","");$("#queAdd").css("display","none")}}})}function addDraw(){var b=$("#qnum").val();var c=parseInt(b)+1;var a='<div class="frame_center ww_60" id="integralTopic'+c+'"><div class="frame_basic"><ul><li class="list_tit ww_30">'+awardLevel[c]+'等奖:</li><li class="list_con ww_60"><p>奖品名称：<input type="text" class="inputTxt" id="prize'+c+'" name="prize'+c+'" size="15"></p><p>奖品数量：<input type="text" class="inputTxt" name="prizeNum'+c+'" id="prizeNum'+c+'" size="5"></p><p>奖品价值：<input type="text" class="inputTxt" id="prizeValue'+c+'" name="prizeValue'+c+'" size="5"> 元</p><p>中奖概率：<input type="text" class="inputTxt" name="rate'+c+'" id="rate'+c+'" size="5"> %</p><p>最大中奖数量：<input type="text" class="inputTxt" name="maxCount'+c+'" id="maxCount'+c+'" size="5" /></p><p>奖品属性：<input type="radio" name="prizePorp'+c+'" value="0" checked> 虚拟奖品<input type="radio" name="prizePorp'+c+'" value="1"> 实物奖品</p></li><li class="list_tit ww_30"></li></ul></div></div><br>';$("#integralDetail").append(a);$("#qnum").val(c)}function lastStepOfQue(){$("#queDetail").css("display","none");$("#queAdd").css("display","")}function newQueTopic(){var a="<ul><li class='list_tit ww_30'>序号：</li><li class='list_con ww_40'><input type='text' name='topicNum' value='"+topicNum+"' readOnly='true' size='2'/></li><li class='list_tit ww_30'>题目：</li><li class='list_con ww_40'><input type='text' size='40' name='topicTitle"+topicNum+"'/></li><li class='list_tit ww_30'>选项：</li><li class='list_con ww_40'>A <input type='text' size='35' name='answerA"+topicNum+"'/> <input type='radio' name = 'right"+topicNum+"' value='A'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B <input type='text' size='35' name='answerB"+topicNum+"'/> <input type='radio' name = 'right"+topicNum+"' value='B'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C <input type='text' size='35' name='answerC"+topicNum+"'/> <input type='radio' name = 'right"+topicNum+"' value='C'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D <input type='text' size='35' name='answerD"+topicNum+"'/> <input type='radio' name = 'right"+topicNum+"' value='D'/>正确答案</li></ul>";$("#handImport").append(a);topicNum=topicNum+1}function addQuestion(){var a=$("#questionAddForm").serialize();$.ajax({type:"post",url:getPath()+"/question/addQuestion.do",data:a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="success"){alert("发布成功！");window.location=getPath()+"/html/searchQue.html"}if(b.r=="duplicateTime"){alert("活动时间与当前进行中的活动时间有重复！")}if(b.r=="haveNullPoint"){alert("有字段为空！")}if(b.r=="fail"){alert("发布失败！")}}})}function updateQuestion(a){$.ajax({type:"post",url:getPath()+"/question/getQuestionById.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f!=null&&f!=""){$("#questionId").val(f.id);$("#title").val(f.title);$("#beginTime").val(formatDate(f.startTime));$("#endTime").val(formatDate(f.stopTime));$("#attendTime").val(f.attendTimes);$("#point").val(f.points);$("#queNum").val(f.ext01);var e=f.questionItems;if(e!=null&&e.length>0){for(var d=0;d<e.length;d++){var c=d+1;var b="<ul><input type='text' style='display: none;' name='itemId' value='"+e[d].id+"'/><li class='list_tit ww_30'>序号：</li><li class='list_con ww_40'><input type='text' name='topicNum' value='"+c+"' readOnly='true' size='2'/></li><li class='list_tit ww_30'>题目：</li><li class='list_con ww_40'><input type='text' size='40' name='topicTitle"+e[d].id+"' value='"+e[d].text+"'/></li><li class='list_tit ww_30'>选项：</li><li class='list_con ww_40'>A <input type='text' size='35' name='answerA"+e[d].id+"' value='"+e[d].options.split(";")[0]+"'/>";if(e[d].answer=="A"){b+=" <input type='radio' checked = 'true' name = 'right"+e[d].id+"' value='A'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B <input type='text' size='35' name='answerB"+e[d].id+"' value='"+e[d].options.split(";")[1]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='B'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C <input type='text' size='35' name='answerC"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='C'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D <input type='text' size='35' name='answerD"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='D'/>正确答案</li></ul>"}if(e[d].answer=="B"){b+=" <input type='radio' name = 'right"+e[d].id+"' value='A'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B <input type='text' size='35' name='answerB"+e[d].id+"' value='"+e[d].options.split(";")[1]+"'/> <input type='radio' checked = 'true' name = 'right"+e[d].id+"' value='B'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C <input type='text' size='35' name='answerC"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='C'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D <input type='text' size='35' name='answerD"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='D'/>正确答案</li></ul>"}if(e[d].answer=="C"){b+=" <input type='radio' name = 'right"+e[d].id+"' value='A'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B <input type='text' size='35' name='answerB"+e[d].id+"' value='"+e[d].options.split(";")[1]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='B'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C <input type='text' size='35' name='answerC"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' checked = 'true' name = 'right"+e[d].id+"' value='C'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D <input type='text' size='35' name='answerD"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='D'/>正确答案</li></ul>"}if(e[d].answer=="D"){b+=" <input type='radio' name = 'right"+e[d].id+"' value='A'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B <input type='text' size='35' name='answerB"+e[d].id+"' value='"+e[d].options.split(";")[1]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='B'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C <input type='text' size='35' name='answerC"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' name = 'right"+e[d].id+"' value='C'/>正确答案</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D <input type='text' size='35' name='answerD"+e[d].id+"' value='"+e[d].options.split(";")[2]+"'/> <input type='radio' checked = 'true' name = 'right"+e[d].id+"' value='D'/>正确答案</li></ul>"}$("#questionItem").append(b)}}$("#queUpdate").css("display","");$("#queSearch").css("display","none")}}})}function saveUpdateQue(){var a=$("#questionUpdateForm").serialize();$.ajax({type:"post",url:getPath()+"/question/saveUpdateQuestion.do",data:a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r=="success"){alert("更新成功！");window.location.reload()}if(b.r=="fail"){alert("更新失败！")}}})}function showQuestion(a){$.ajax({type:"post",url:getPath()+"/question/getQuestionById.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f!=null&&f!=""){$("#showTopics").empty();var e=f.questionItems;if(e!=null&&e.length>0){for(var d=0;d<e.length;d++){var c=d+1;var b="<ul><li class='list_tit ww_30'>序号：</li><li class='list_con ww_40'>"+c+"</li><li class='list_tit ww_30'>题目：</li><li class='list_con ww_40'>"+e[d].text+"</li><li class='list_tit ww_30'>选项：</li><li class='list_con ww_40'>A "+e[d].options.split(";")[0];if(e[d].answer=="A"){b+=" (正确答案)</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B "+e[d].options.split(";")[1]+"</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C "+e[d].options.split(";")[2]+"</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D "+e[d].options.split(";")[3]+"</li></ul>"}if(e[d].answer=="B"){b+="</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B "+e[d].options.split(";")[1]+"(正确答案)</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C "+e[d].options.split(";")[2]+"</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D "+e[d].options.split(";")[3]+"</li></ul>"}if(e[d].answer=="C"){b+="</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B "+e[d].options.split(";")[1]+"</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C "+e[d].options.split(";")[2]+"(正确答案)</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D "+e[d].options.split(";")[3]+"</li></ul>"}if(e[d].answer=="D"){b+="</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>B "+e[d].options.split(";")[1]+"</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>C "+e[d].options.split(";")[2]+"</li><li class='list_tit ww_30'></li><li class='list_con ww_40'>D "+e[d].options.split(";")[3]+"(正确答案)</li></ul>"}$("#showTopics").append(b)}}showTipsWindown("","pop_window",950,600)}}})}function deleteQuestion(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/question/deleteQuestion.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("删除成功！");window.location.reload()}else{alert("删除失败！")}}})}}function uploadLotteryPic(fileElementId,picId){if(!$("#"+fileElementId).val()){alert("请选择上传文件");return}if($("#"+fileElementId).get(0).files[0].size>150*1024){alert("图片大小超出限制！");return}var pics=document.getElementsByName("lotteryPic");if(pics.length>=3){alert("最多只能上传3张图片！");return}var action="uploadimage";if(arguments.length>2&&arguments[2]==2){action="uploadmntpic"}$.ajaxFileUpload({url:getPath()+"/controller.jsp?action="+action,secureuri:false,fileElementId:fileElementId,dataType:"txt",success:function(data,status){eval("data = "+data);if(data.url){var t="<div name='lotteryPic' id='a"+topicNum+"'><img src='"+data.url+"' width='78px' height='78px'><br><a href='javascript:delArticle("+topicNum+")'>删除</a></div>";topicNum=topicNum+1;$("#picview").append(t)}else{if(data.state){alert(data.state)}}}})}function updateLotterySite(a){$.ajax({type:"post",url:getPath()+"/lotterySite/getLotterySite.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){if(g){$("#updateLottery").css("display","");$("#addLottery").css("display","none");document.getElementById("lid").value=a;document.getElementById("siteId").value=g.siteId;document.getElementById("lotProv").value=g.province;document.getElementById("lotCity").value=g.city;document.getElementById("storeAddr").value=g.address;document.getElementById("lolatitude").value=g.x+","+g.y;document.getElementById("fisPhone").value=g.phone.split("-")[0];document.getElementById("secPhone").value=g.phone.split("-")[1];document.getElementById("openTime").value=formatDateNoTime(g.openTime);var f=document.getElementById("siteType");var b=document.getElementById("siteStan");for(var e=0;e<f.options.length;e++){if(f.options[e].innerHTML==g.type1){f.options[e].selected=true;break}}for(var e=0;e<b.options.length;e++){if(b.options[e].innerHTML==g.type2){b.options[e].selected=true;break}}if(g.remark){document.getElementById("remark").value=g.remark}if(g.mediaPath){var h=g.mediaPath.split(";");var d="";for(var c=0;c<h.length;c++){d+="<div name='lotteryPic' id='a"+topicNum+"'><img src='"+downloadPath+h[c]+"' width='78px' height='78px'><br><a href='javascript:delArticle("+topicNum+")'>删除</a></div>";topicNum=topicNum+1}$("#picview").append(d)}}}})}function saveLottery(){var k=document.getElementById("title").value;var c=document.getElementById("beginTime").value;var g=document.getElementById("endTime").value;if(k==""){alert("请输入抽奖名称！");return}if(c==""){alert("请选择开始时间！");return}if(g==""){alert("请选择结束时间！");return}var e="title="+k+"&beginTime="+c+"&endTime="+g;var a=0;for(i=1;i<=5;i++){var f=document.getElementById("prize"+i).value;var b=document.getElementById("prizeValue"+i).value;var h=document.getElementById("prizeNum"+i).value;if(f==""){a=i;break}if(b==""){a=i;break}if(h==""){a=i;break}e+="&prize"+i+"="+f+"&prizeValue"+i+"="+b+"&prizeNum"+i+"="+h}if(a!=0){if(a==1){alert("请填写1等奖奖品信息");return}var d=a;a+=1;for(;a<=5;++a){var f=document.getElementById("prize"+a).value;var b=document.getElementById("prizeValue"+a).value;var h=document.getElementById("prizeNum"+a).value;if(f!=""||b!=""||h!=""){alert("请填写"+d+"等奖奖品信息");return}}}$.ajax({type:"post",url:getPath()+"/activity/saveLottery.do",data:e,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(l){if(l){if(l.r=="duplicateTime"){alert("抽奖时间重复！");return}if(l.r=="ok"){alert("操作成功！");window.location=getPath()+"/html/searchLottery.html"}}}})}function cancelLott(){window.location=getPath()+"/html/searchLottery.html"}function cancelTopic(){window.location=getPath()+"/html/topic.html"}function deleteLottery(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/activity/deleteLottery.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("删除成功！");window.location.reload()}else{alert("删除失败！")}}})}}function searchPrize(a){showRunning(6);var b=document.getElementById("raffleName").value;var c=document.getElementById("prize").value;$.ajax({type:"POST",url:getPath()+"/activity/searchPrize.do",data:"raffleName="+b+"&prize="+c+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){searchPrizeCallback(d)},})}function searchPrizeCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchPrize",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=6;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchPrize",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=c.s+b+1;f=e.insertCell(e.cells.length);f.innerHTML=d[b].mobile;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].raffleTime);f=e.insertCell(e.cells.length);if(d[b].level){f.innerHTML=prizeLevel[d[b].level]}else{f.innerHTML="六等奖"}f=e.insertCell(e.cells.length);if(d[b].name&&d[b].worth){f.innerHTML=d[b].worth+"元"+d[b].name}else{f.innerHTML="50积分"}f=e.insertCell(e.cells.length);if(d[b].code){f.innerHTML="******"}else{f.innerHTML=""}}}}}function raffleNameLoad(){$.ajax({type:"POST",async:false,url:getPath()+"/activity/initRaffleName.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){var b=d.r;if(b){var c=document.getElementById("raffleName");if(c){for(var a=0;a<b.length;a++){c.options[c.options.length]=new Option(b[a].name,b[a].id,false,false)}}}},})}function searchProvice(){$.ajax({type:"get",url:getPath()+"/web/getProvince.do",dataType:"json",async:false,success:function(c){if(c&&c.r=="no permission"){alert("没有权限");return}else{if(c&&c.r=="timeout"){window.location=getPath()+"/html/loginwx.html";return}}if(c){var b=document.getElementById("provice");if(b){for(var a=0;a<c.length;a++){b.options[b.options.length]=new Option(c[a].name,c[a].num,false,false)}}}}})}function addBlackList(){var a=document.getElementById("phone").value;if(a.trim()==""){alert("手机号不能为空");return}$.ajax({type:"post",url:getPath()+"/manage/insertBlackList.do",data:"mobile="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("保存成功！");window.location=getPath()+"/html/blacklistSearch.html"}else{if(b=="duplicateStoreNum"){alert("手机号已存在！")}else{alert("保存失败！")}}}})}function blackCancel(){window.location=getPath()+"/html/blacklistSearch.html"}function uploadBlackList(fileElementId){var exl=document.getElementById("exlFile").value;if(exl==""){alert("请上传文件");return}$.ajaxFileUpload({url:getPath()+"/manage/excelImport.do?filename="+fileElementId,secureuri:false,fileElementId:fileElementId,dataType:"txt",async:false,success:function(data,status){if(data.split(">").length>1){data=data.substring(data.indexOf(">")+1,data.length-6)}eval("data = "+data);if(data.r=="errorFile"){alert("上传的文件格式错误！");return}if(data.r=="duplicateStoreNum"){alert("有重复手机号！");return}if(data.r=="fail"){alert("上传失败！");return}if(data.r=="ok"){alert("上传成功！")}}})}function searchLottery(a){showRunning(6);$.ajax({type:"post",url:getPath()+"/activity/searchActivity.do",data:"startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchLotteryCallback(b)}})}function searchActivity(d){var e=document.getElementById("type").value;var a=document.getElementById("status").value;var c=document.getElementById("prov");var b="JX";if(c!=null){b=c.value}$.ajax({type:"post",url:getPath()+"/integral/searchIntegral.do",data:"startIdx="+d+"&type="+e+"&status="+a+"&prov="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){if(e==10){var h=g.r;var f="";for(i=0;i<h.length;i++){if(h[i]!=null){f+="<option s='"+formatDateNoTime(h[i].startTime)+"' e='"+formatDateNoTime(h[i].endTime)+"' value="+h[i].id+">";f+=h[i].name;f+="</option>"}if(i==0){$("#startTime").val(formatDateNoTime(h[i].startTime));$("#endTime").val(formatDateNoTime(h[i].endTime))}}$("#alist").html(f)}}})}function exportRaffle(){var c=$("#alist").val();var b=$("#startTime").val();var a=$("#endTime").val();location.href=getPath()+"/raffle/download.do?aid="+c+"&startTime="+b+"&endTime="+a}function searchRaffle(){var c=$("#alist").val();var b=$("#startTime").val();var a=$("#endTime").val();$.ajax({type:"post",url:getPath()+"/raffle/search.do",data:"aid="+c+"&startTime="+b+"&endTime="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f.s==200){var g=f.list;if(g.length==0){$("#res").html("<tr><td colspan=7></td></tr>");return}var e="";for(i=0;i<g.length;i++){var h=g[i];e+="<tr>";e+="<td>";if(h.date){e+=formatDateNoTime(h.date)}else{e+="总量"}e+="</td>";e+="<td>";e+=h.u;e+="</td>";e+="<td>";e+=h.t;e+="</td>";e+="<td>";e+=h.r;e+="</td>";e+="<td>";e+=h.z;e+="</td>";e+="<td>";e+=h.l1;e+="</td>";e+="<td>";e+=h.l2;e+="</td>";e+="<td>";e+=h.l3;e+="</td>";e+="<td>";e+=h.l4;e+="</td>";e+="<td>";e+=h.l5;e+="</td>";e+="</tr>"}$("#res").html(e)}else{alert(f.r)}}})}function searchLotteryCallback(d){var f,g,c;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchLottery",0);f=b.insertRow(b.rows.length);g=f.insertCell(f.cells.length);g.colSpan=6;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchLottery",d.s);var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=b.insertRow(b.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=e[c].id;g=f.insertCell(f.cells.length);g.innerHTML=e[c].name;g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].startTime);g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].endTime);g=f.insertCell(f.cells.length);var a=Date.parse(new Date());if(e[c].startTime>a){g.innerHTML="未开始";g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:showLottery('+e[c].id+',0)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteLottery('+e[c].id+')">删除</a>'}else{if(e[c].startTime<=a&&e[c].endTime>=a){g.innerHTML="进行中";g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:showLottery('+e[c].id+',1)">详情</a>'}else{if(e[c].endTime<a){g.innerHTML="已结束";g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:showLottery('+e[c].id+',2)">详情</a>'}}}f=b.insertRow(b.rows.length);f.className="td_int";f.style.display="none";f.id="lottery_"+e[c].id;g=f.insertCell(f.cells.length);g.colSpan=6;g.innerHTML='<div class="right_em_con"><div class="main_tab"><a class="on" href="#" onclick="JavaScript:prizeChange0(1,'+e[c].id+')" id="'+e[c].id+'_con_1">一等奖</a><a href="#" onclick="JavaScript:prizeChange0(2,'+e[c].id+')" id="'+e[c].id+'_con_2">二等奖</a><a href="#" onclick="JavaScript:prizeChange0(3,'+e[c].id+')" id="'+e[c].id+'_con_3">三等奖</a><a href="#" onclick="JavaScript:prizeChange0(4,'+e[c].id+')" id="'+e[c].id+'_con_4">四等奖</a><a href="#" onclick="JavaScript:prizeChange0(5,'+e[c].id+')" id="'+e[c].id+'_con_5">五等奖</a></div><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>序号</td><td>奖品名称</td><td>奖品价值</td><td>获奖手机号</td><td>openID</td><td>状态</td></tr><tbody id="res_'+e[c].id+'"></tbody></table><div class="main_page" id="pri_'+e[c].id+'">&nbsp;</div><div class="goto_back"><a href= "javascript:hideLottery0('+e[c].id+')">收回</a></div></div>'}}}}function showLottery(c,a){$("#integralLotteryId").val(c);$("#gameStatus").val(a);$("tr[id^=lottery_]").hide();var b=document.getElementById("lottery_"+c);b.style.display="";searchLotteryPrize(0)}function hideLottery0(b){var a=document.getElementById("lottery_"+b);a.style.display="none"}function prizeChange0(a,b){$("#integralLotteryId").val(b);$("#"+b+"_con_"+a).addClass("on").siblings().removeClass();$("#level").val(a);searchLotteryPrize(0)}function searchLotteryPrize(b){var a=document.getElementById("integralLotteryId").value;var c=document.getElementById("level").value;$.ajax({type:"post",url:getPath()+"/activity/searchLotteryPrize.do",data:"lotteryId="+a+"&level="+c+"&startIdx="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){searchLotteryPrizeCallback(d,a)}})}function searchLotteryPrizeCallback(d,h){var f,g,c;var a=document.getElementById("res_"+h);while(a.rows.length>0){a.removeChild(a.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchLotteryPrize",0,"prize");f=a.insertRow(a.rows.length);g=f.insertCell(f.cells.length);g.colSpan=6;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchLotteryPrize",d.s,"prize");var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=a.insertRow(a.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=d.s+c+1;g=f.insertCell(f.cells.length);g.innerHTML=e[c].name;g=f.insertCell(f.cells.length);g.innerHTML=e[c].worth+"元";g=f.insertCell(f.cells.length);g.innerHTML=e[c].mobile!=null?e[c].mobile:"--";g=f.insertCell(f.cells.length);g.innerHTML=e[c].openid!=null?e[c].openid:"--";g=f.insertCell(f.cells.length);if(e[c].status==0){if(b==2){g.innerHTML="待回收"}else{g.innerHTML="未派发"}}if(e[c].status==1){g.innerHTML="已派发"}var b=$("#gameStatus").val()}}}}function searchBlackList(a){showRunning(2);telNum=document.getElementById("telNum").value;$.ajax({type:"POST",url:getPath()+"/manage/searchBalckList.do",data:"telNum="+telNum+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchBlackListCallback(b)},})}function searchBlackListCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchBlackList",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=2;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchBlackList",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=d[b].mobile;f=e.insertCell(e.cells.length);f.innerHTML="<a href= 'javascript:deleteBlackList("+d[b].mobile+")'>删除</a>"}}}}function deleteBlackList(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/manage/deleteBlackList.do",data:"mobile="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){searchBlackList(0)}else{alert("删除失败！")}},error:function(c,b){}})}}function searchAnswerStatistics(d){showRunning(4);var c=document.getElementById("startTotalCount").value;var f=document.getElementById("endTotalCount").value;var b=document.getElementById("startAnswerCount").value;var e=document.getElementById("endAnswerCount").value;var a=document.getElementById("telNum").value;$.ajax({type:"POST",url:getPath()+"/question/searchAnswerSticsList.do",data:"startTotalCount="+c+"&endTotalCount="+f+"&startAnswerCount="+b+"&endAnswerCount="+e+"&telNum="+a+"&startIdx="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){searchAnswerStatisticsCallback(g)},})}function searchAnswerStatisticsCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchAnswerStatistics",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=4;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchAnswerStatistics",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=c.s+b+1;f=e.insertCell(e.cells.length);if(d[b].mobile){f.innerHTML=d[b].mobile}else{f.innerHTML=""}f=e.insertCell(e.cells.length);f.innerHTML=d[b].question_count2;f=e.insertCell(e.cells.length);f.innerHTML=d[b].question_count2+d[b].question_count}}}}function addIntegral(){var b=$("#qnum").val();var c=parseInt(b)+1;var a='<div class="frame_center ww_60" id="integralTopic'+c+'"><div class="frame_basic"><ul><li class="list_tit ww_30">'+awardLevel[c]+'等奖:</li><li class="list_con ww_60"><select id="pStatus'+c+'" name="pStatus'+c+'" onchange="setIntegral('+c+',this.value)"><option value="0">虚拟奖品</option><option value="1">实物奖品</option></select>&nbsp;&nbsp;&nbsp;奖品数量：<input type="text" class="inputTxt" name="prizeNum'+c+'" id="prizeNum'+c+'" readOnly="true" size="5"><input id="filename'+c+'" name="filename'+c+'" value="" type="hidden"></li><li class="list_tit ww_30" id="cardF'+c+'">选择卡密文件:</li><li class="list_con ww_60" id="cardFile'+c+'"><input type="file" name="prizeFile'+c+'" id="prizeFile'+c+'"><input type="button" onclick=uploadIntegral('+c+') value="上传..." /></li><li class="list_tit ww_30"></li></ul></div></div><br>';$("#integralDetail").append(a);$("#qnum").val(c)}function addIntegral2(){var b=$("#qnum").val();var c=parseInt(b)+1;var a='<div class="frame_center ww_60" id="integralTopic'+c+'"><div class="frame_basic"><ul><li class="list_tit ww_30">'+awardLevel[c]+'等奖:</li><li class="list_con ww_60"><p>奖品名称：<input type="text" class="inputTxt" id="prize'+c+'" name="prize'+c+'" size="15"></p><p>奖品数量：<input type="text" class="inputTxt" name="prizeNum'+c+'" id="prizeNum'+c+'" size="5"></p><p>奖品价值：<input type="text" class="inputTxt" id="prizeValue'+c+'" name="prizeValue'+c+'" size="5">元</p><p>中奖概率：<input type="text" class="inputTxt" name="rate'+c+'" id="rate'+c+'" size="5">%</p><p>奖品图片：<input type="file" name="upfile" title="图片上传" id="uppic'+c+'"><input type="button" onclick="uploadIntegralPic(\'uppic'+c+"','pic"+c+'\',2)" value="上传..." /><br><br><div class="pictures" id="pic'+c+'"></div></p><p><span style="color:#ea4545">领奖是否需上传身份证：</span><input type="checkbox" name="idCard'+c+'" value="1" /></p></li><li class="list_tit ww_30"></li></ul></div></div><br>';$("#integralDetail").append(a);$("#qnum").val(c)}function delIntegral(){var a=parseInt($("#qnum").val());if(a<=2){alert("不能少于1个！");return}$("#integralDetail br:last").remove();$("#integralTopic"+a).remove();$("#qnum").val(a-1)}function setIntegral(b,a){if(a==0){$("#cardF"+b).css("display","");$("#cardFile"+b).css("display","");$("#prizeNum"+b).attr("readonly",true)}else{$("#cardF"+b).css("display","none");$("#cardFile"+b).css("display","none");$("#prizeNum"+b).attr("readonly",false)}}function getIntegralNum(a){$.ajax({type:"post",url:getPath()+"/integral/getIntegralNum.do",data:"type="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.r!=null){$("#num").val(b.r)}}})}function uploadIntegral(type){var fileElementId="prizeFile"+type;var prizeFile=document.getElementById(fileElementId).value;if(prizeFile==""){alert("请上传文件");return}$.ajaxFileUpload({url:getPath()+"/integral/uploadIntegral.do?filename="+fileElementId,secureuri:false,fileElementId:fileElementId,dataType:"txt",async:false,success:function(data,status){if(data.split(">").length>1){data=data.substring(data.indexOf(">")+1,data.length-6)}eval("data = "+data);if(data.r=="errorFile"){alert("上传的文件格式错误！");return}else{$("#prizeNum"+type).val(data.r);$("#filename"+type).val(data.f)}}})}function saveIntegral(b,a){var c=$("#queDetail .inputTxt").length;$("#queDetail .inputTxt").each(function(f){var g=$(this);var e=$(this).val();var h=$(this).closest(".list_con").find(".pictures").html();if(e.trim()==""){$(g).focus();return false}else{if((f+1)==c){var k=$("#integralAddForm").serialize();var d=getPath()+"/integral/saveIntegral.do?type="+b+"&flag="+a;if(b==2){d=getPath()+"/integral/saveIntegral/draw.do?type="+b+"&flag="+a}else{if(b==10){d=getPath()+"/integral/saveIntegral/draw2.do?type="+b+"&flag="+a}}$.ajax({type:"post",url:d,data:k,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(l){if(l.r=="ok"){alert("发布成功！");if(b==0){if(a==1){window.location=getPath()+"/html/virtualActivitySearch.html"}else{window.location=getPath()+"/html/searchVirtual.html"}}if(b==1){if(a==1){window.location=getPath()+"/html/entityActivitySearch.html"}else{window.location=getPath()+"/html/searchPhysical.html"}}if(b==2){window.location=getPath()+"/html/searchIntegral.html"}if(b==10){window.location=getPath()+"/html/drawHDSearch.html"}}if(l.r=="haveNullPoint"){alert("有字段为空！")}if(l.r=="fail"){alert("发布失败！")}if(l.r=="errorData"){alert("数据有误！")}}})}}})}function saveIntegralBack(b,a){var c=$("#integralAddForm").serialize();$.ajax({type:"post",url:getPath()+"/integral/saveIntegral.do?type="+b+"&flag="+a,data:c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d.r=="ok"){alert("发布成功！");if(b==0){if(a==1){window.location=getPath()+"/html/virtualActivitySearch.html"}else{window.location=getPath()+"/html/searchVirtual.html"}}if(b==1){if(a==1){window.location=getPath()+"/html/entityActivitySearch.html"}else{window.location=getPath()+"/html/searchPhysical.html"}}if(b==2){window.location=getPath()+"/html/searchIntegral.html"}}if(d.r=="haveNullPoint"){alert("有字段为空！")}if(d.r=="fail"){alert("发布失败！")}if(d.r=="errorData"){alert("数据有误！")}}})}function saveIntegral2(b,a){var c=$("#queDetail .inputTxt").length;$("#queDetail .inputTxt").each(function(f){var g=$(this);var e=$(this).val();var h=$(this).closest(".list_con").find(".pictures").html();if(e.trim()==""){$(g).focus();return false}else{if((f+1)==c){var k=$("#integralAddForm").serialize();var d=getPath()+"/integral/saveIntegral.do?type="+b+"&flag="+a;if(b==2){d=getPath()+"/integral/saveIntegral/draw.do?type="+b+"&flag="+a}else{if(b==ActivityType.QUIZ.type){d=getPath()+"/integral/saveIntegral/draw2.do?type="+b+"&flag="+a}}$.ajax({type:"post",url:d,data:k,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(l){if(l.r=="ok"){if(b!=ActivityType.QUIZ.type){alert("发布成功！")}if(b==0){if(a==1){window.location=getPath()+"/html/virtualActivitySearch.html"}else{window.location=getPath()+"/html/searchVirtual.html"}}if(b==1){if(a==1){window.location=getPath()+"/html/entityActivitySearch.html"}else{window.location=getPath()+"/html/searchPhysical.html"}}if(b==2){window.location=getPath()+"/html/searchIntegral.html"}if(b==ActivityType.QUIZ.type){alert("发布成功！请添加题目！");window.location=getPath()+"/html/drawQuestion.html?id="+l.id}}if(l.r=="haveNullPoint"){alert("有字段为空！")}if(l.r=="fail"){alert("发布失败！")}if(l.r=="errorData"){alert("数据有误！")}}})}}})}function searchIntegral(d){var e=document.getElementById("type").value;var a=document.getElementById("status").value;var c=document.getElementById("prov");var b="JX";if(c!=null){b=c.value}if(e=="3"){showRunning(9)}else{showRunning(7)}$.ajax({type:"post",url:getPath()+"/integral/searchIntegral.do",data:"startIdx="+d+"&type="+e+"&status="+a+"&prov="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(e==2){searchIntegralLotteryCallback(f)}else{if(e==3){searchCDkeyCallback(f)}else{if(e==ActivityType.CODE_DRAW.type){searchIntegralLotteryCallback10(f)}else{if(e==ActivityType.QUIZ.type){searchIntegralLotteryCallbackQuiz(f)}else{searchIntegralExchangeCallback(f)}}}}}})}function searchIntegralLotteryCallbackQuiz(c){var h,d,f;var g=document.getElementById("res");while(g.rows.length>0){g.removeChild(g.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchIntegral",0);h=g.insertRow(g.rows.length);d=h.insertCell(h.cells.length);d.colSpan=7;d.innerHTML=noRecord;h.style.height="200px"}else{drawPages(c.c,"searchIntegral",c.s);var e=c.r;for(f=0;f<e.length;f++){if(e[f]!=null){h=g.insertRow(g.rows.length);h.className="td_int";d=h.insertCell(h.cells.length);d.innerHTML=c.s+f+1;d=h.insertCell(h.cells.length);d.innerHTML=e[f].name;d=h.insertCell(h.cells.length);d.innerHTML=e[f].param1;d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].startTime);d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].endTime);d=h.insertCell(h.cells.length);var b=Date.parse(new Date());if(e[f].startTime>b){d.innerHTML="未开始";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showQuiz('+e[f].id+')">查看题目</a>&nbsp;&nbsp;<a href= "javascript:showIntegralLottery('+e[f].id+',0)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteIntegralLottery('+e[f].id+')">删除</a>&nbsp;&nbsp;<a href= "javascript:showQuiz('+e[f].id+')">查看题目</a>'}else{if(e[f].startTime<=b&&e[f].endTime>=b){d.innerHTML="进行中";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showQuiz('+e[f].id+')">查看题目</a>&nbsp;&nbsp;<a href= "javascript:showIntegralLottery('+e[f].id+',1)">详情</a>&nbsp;&nbsp;<a href= "javascript:stopIntegralLottery('+e[f].id+')">结束</a>&nbsp;&nbsp;<a target="_blank" href="'+getPath()+"/export/download.do?aid="+e[f].id+'">导出中奖名单</a> <a href="#" onclick="importTip('+e[f].id+')">批量派奖</a>'}else{if(e[f].endTime<b){d.innerHTML="已结束";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showQuiz('+e[f].id+')">查看题目</a>&nbsp;&nbsp;<a href= "javascript:showIntegralLottery('+e[f].id+',2)">详情</a>&nbsp;&nbsp;<a target="_blank" href="'+getPath()+"/export/download.do?aid="+e[f].id+'">导出中奖名单</a> <a href="#" onclick="importTip('+e[f].id+')">批量派奖</a>'}}}h=g.insertRow(g.rows.length);h.className="td_int";h.style.display="none";h.id="integral_"+e[f].id;d=h.insertCell(h.cells.length);d.colSpan=7;var a=e[f].level;var k='<div class="right_em_con"><div class="main_tab">';for(j=1;j<=a;j++){k+='<a href="#" onclick="JavaScript:prizeChange('+e[f].id+","+j+')" id="'+e[f].id+"_con_"+j+'">'+awardLevel[j]+"等奖</a>"}k+="</div>";for(j=1;j<=a;j++){k+='<table id="'+e[f].id+"_tb_"+j+'" cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title">';k+="<td>中奖概率</td>";k+="<td>最大中奖数量</td>";k+="<td>操作</td>";k+="</tr>";k+="<tr>";k+="<td>";k+=e[f].rate[j]+"%";k+="</td>";k+="<td>";k+=e[f].count[j];k+="</td>";k+="<td>";k+='<a href="#" onclick="changeRate('+e[f].id+","+j+","+e[f].rate[j]+')">修改中奖概率</a> &nbsp;&nbsp;&nbsp;&nbsp;';k+='<a href="#" onclick="changeMaxCount('+e[f].id+","+j+","+e[f].count[j]+')">修改最大中奖数量</a> ';k+="</td>";k+="</tr>";k+="</table>"}k+='<table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>序号</td><td>奖品名称</td><td>奖品价值</td><td>获奖时间</td><td>姓名</td><td style="width:200px">地址</td><td>联系电话</td><td>身份证</td><td>状态</td><td>操作</td></tr><tbody id="res_'+e[f].id+'"></tbody></table><div class="main_page" id="pri_'+e[f].id+'">&nbsp;</div><div class="goto_back"><a href= "javascript:hideLottery('+e[f].id+')">收回</a></div></div>';d.innerHTML=k}}}}function searchIntegralLotteryCallback10(c){var h,d,f;var g=document.getElementById("res");while(g.rows.length>0){g.removeChild(g.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchIntegral",0);h=g.insertRow(g.rows.length);d=h.insertCell(h.cells.length);d.colSpan=7;d.innerHTML=noRecord;h.style.height="200px"}else{drawPages(c.c,"searchIntegral",c.s);var e=c.r;for(f=0;f<e.length;f++){if(e[f]!=null){h=g.insertRow(g.rows.length);h.className="td_int";d=h.insertCell(h.cells.length);d.innerHTML=c.s+f+1;d=h.insertCell(h.cells.length);d.innerHTML=e[f].name;d=h.insertCell(h.cells.length);d.innerHTML=e[f].param1;d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].startTime);d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].endTime);d=h.insertCell(h.cells.length);var b=Date.parse(new Date());if(e[f].startTime>b){d.innerHTML="未开始";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',0)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteIntegralLottery('+e[f].id+')">删除</a>'}else{if(e[f].startTime<=b&&e[f].endTime>=b){d.innerHTML="进行中";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',1)">详情</a>&nbsp;&nbsp;<a href= "javascript:stopIntegralLottery('+e[f].id+')">结束</a>&nbsp;&nbsp;<a target="_blank" href="'+getPath()+"/export/download.do?aid="+e[f].id+'">导出中奖名单</a> <a href="#" onclick="importTip('+e[f].id+')">批量派奖</a>'}else{if(e[f].endTime<b){d.innerHTML="已结束";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',2)">详情</a>&nbsp;&nbsp;<a target="_blank" href="'+getPath()+"/export/download.do?aid="+e[f].id+'">导出中奖名单</a> <a href="#" onclick="importTip('+e[f].id+')">批量派奖</a>'}}}h=g.insertRow(g.rows.length);h.className="td_int";h.style.display="none";h.id="integral_"+e[f].id;d=h.insertCell(h.cells.length);d.colSpan=7;var a=e[f].level;var k='<div class="right_em_con"><div class="main_tab">';for(j=1;j<=a;j++){k+='<a href="#" onclick="JavaScript:prizeChange('+e[f].id+","+j+')" id="'+e[f].id+"_con_"+j+'">'+awardLevel[j]+"等奖</a>"}k+="</div>";for(j=1;j<=a;j++){k+='<table id="'+e[f].id+"_tb_"+j+'" cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title">';k+="<td>中奖概率</td>";k+="<td>最大中奖数量</td>";k+="<td>操作</td>";k+="</tr>";k+="<tr>";k+="<td>";k+=e[f].rate[j]+"%";k+="</td>";k+="<td>";k+=e[f].count[j];k+="</td>";k+="<td>";k+='<a href="#" onclick="changeRate('+e[f].id+","+j+","+e[f].rate[j]+')">修改中奖概率</a> &nbsp;&nbsp;&nbsp;&nbsp;';k+='<a href="#" onclick="changeMaxCount('+e[f].id+","+j+","+e[f].count[j]+')">修改最大中奖数量</a> ';k+="</td>";k+="</tr>";k+="</table>"}k+='<table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>序号</td><td>奖品名称</td><td>奖品价值</td><td>获奖时间</td><td>姓名</td><td style="width:200px">地址</td><td>联系电话</td><td>身份证</td><td>状态</td><td>操作</td></tr><tbody id="res_'+e[f].id+'"></tbody></table><div class="main_page" id="pri_'+e[f].id+'">&nbsp;</div><div class="goto_back"><a href= "javascript:hideLottery('+e[f].id+')">收回</a></div></div>';d.innerHTML=k}}}}function uploadJD(){var a=document.getElementById("jdFile").value;if(a==""){alert("请上传文件");return}$.ajaxFileUpload({url:getPath()+"/raffle/sendout.do?filename=jdFile",secureuri:false,fileElementId:"jdFile",dataType:"json",async:false,success:function(c,b){if(c.s==200){alert(c.r)}else{alert(c.r)}closeWindow()},error:function(b,d,c){console.log(b.responseText);console.log(b.status);console.log(b.readyState);console.log(b.statusText);console.log(d);console.log(c)}})}function changeMaxCount(c,b,a){changeMaxCountBox(c,b,a)}function submitMaxCount(d,c,b){var a=$("#maxCountResult").val();$.ajax({type:"post",url:getPath()+"/integral/saveIntegral/mxcount.do",data:{id:d,level:c,oc:b,nc:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e.s==200){closeWindow();alert("修改成功");searchIntegral(0)}else{alert(e.r)}}})}function changeRate(c,b,a){changeRateBox(c,b,a)}function submitRate(d,c,b){var a=$("#rateResult").val();$.ajax({type:"post",url:getPath()+"/integral/saveIntegral/rate.do",data:{id:d,level:c,or:b,nr:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e.s==200){closeWindow();alert("修改成功");searchIntegral(0)}else{alert(e.r)}}})}function searchIntegralLotteryCallback(c){var h,d,f;var g=document.getElementById("res");while(g.rows.length>0){g.removeChild(g.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchIntegral",0);h=g.insertRow(g.rows.length);d=h.insertCell(h.cells.length);d.colSpan=7;d.innerHTML=noRecord;h.style.height="200px"}else{drawPages(c.c,"searchIntegral",c.s);var e=c.r;for(f=0;f<e.length;f++){if(e[f]!=null){h=g.insertRow(g.rows.length);h.className="td_int";d=h.insertCell(h.cells.length);d.innerHTML=e[f].activityNum;d=h.insertCell(h.cells.length);d.innerHTML=e[f].name;d=h.insertCell(h.cells.length);d.innerHTML=e[f].param1;d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].startTime);d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].endTime);d=h.insertCell(h.cells.length);var b=Date.parse(new Date());if(e[f].startTime>b){d.innerHTML="未开始";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',0)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteIntegralLottery('+e[f].id+')">删除</a>'}else{if(e[f].startTime<=b&&e[f].endTime>=b){d.innerHTML="进行中";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',1)">详情</a>&nbsp;&nbsp;<a href= "javascript:stopIntegralLottery('+e[f].id+')">结束</a>'}else{if(e[f].endTime<b){d.innerHTML="已结束";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',2)">详情</a>'}}}h=g.insertRow(g.rows.length);h.className="td_int";h.style.display="none";h.id="integral_"+e[f].id;d=h.insertCell(h.cells.length);d.colSpan=7;var a=e[f].level;var k='<div class="right_em_con"><div class="main_tab">';for(j=1;j<=a;j++){k+='<a href="#" onclick="JavaScript:prizeChange('+e[f].id+","+j+')" id="'+e[f].id+"_con_"+j+'">'+awardLevel[j]+"等奖</a>"}k+='</div><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>奖品序号</td><td>兑换人</td><td>兑换时间</td><td>奖品状态</td><td id="td_'+e[f].id+'">密码</td></tr><tbody id="res_'+e[f].id+'"></tbody></table><div class="main_page" id="pri_'+e[f].id+'">&nbsp;</div><div class="goto_back"><a href= "javascript:hideLottery('+e[f].id+')">收回</a></div></div>';d.innerHTML=k}}}}function searchIntegralLotteryCallback2(c){var h,d,f;var g=document.getElementById("res");while(g.rows.length>0){g.removeChild(g.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchIntegral",0);h=g.insertRow(g.rows.length);d=h.insertCell(h.cells.length);d.colSpan=7;d.innerHTML=noRecord;h.style.height="200px"}else{drawPages(c.c,"searchIntegral",c.s);var e=c.r;for(f=0;f<e.length;f++){if(e[f]!=null){h=g.insertRow(g.rows.length);h.className="td_int";d=h.insertCell(h.cells.length);d.innerHTML=e[f].activityNum;d=h.insertCell(h.cells.length);d.innerHTML=e[f].name;d=h.insertCell(h.cells.length);d.innerHTML=e[f].param1;d=h.insertCell(h.cells.length);d.innerHTML=e[f].param2;d=h.insertCell(h.cells.length);d.innerHTML=e[f].param3;d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].startTime);d=h.insertCell(h.cells.length);d.innerHTML=formatDate(e[f].endTime);d=h.insertCell(h.cells.length);var b=Date.parse(new Date());if(e[f].startTime>b){d.innerHTML="未开始";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',0)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteIntegralLottery('+e[f].id+')">删除</a>'}else{if(e[f].startTime<=b&&e[f].endTime>=b){d.innerHTML="进行中";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',1)">详情</a>&nbsp;&nbsp;<a href= "javascript:stopIntegralLottery('+e[f].id+')">结束</a>'}else{if(e[f].endTime<b){d.innerHTML="已结束";d=h.insertCell(h.cells.length);d.innerHTML='<a href= "javascript:showIntegralLottery('+e[f].id+',2)">详情</a>&nbsp;&nbsp;<a target="_blank" href="'+getPath()+"/export/download.do?aid="+e[f].id+'">导出中奖名单</a>'}}}h=g.insertRow(g.rows.length);h.className="td_int";h.style.display="none";h.id="integral_"+e[f].id;d=h.insertCell(h.cells.length);d.colSpan=7;var a=e[f].level;var k='<div class="right_em_con"><div class="main_tab">';for(j=1;j<=a;j++){k+='<a href="#" onclick="JavaScript:prizeChange('+e[f].id+","+j+')" id="'+e[f].id+"_con_"+j+'">'+awardLevel[j]+"等奖(中奖概率:"+e[f].rate[j]+"%)</a>"}k+='</div><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>序号</td><td>奖品名称</td><td>奖品价值</td><td>获奖手机</td><td>获奖时间</td><td>姓名</td><td style="width:200px">地址</td><td>联系电话</td><td>身份证</td><td>状态</td><td>操作</td></tr><tbody id="res_'+e[f].id+'"></tbody></table><div class="main_page" id="pri_'+e[f].id+'">&nbsp;</div><div class="goto_back"><a href= "javascript:hideLottery('+e[f].id+')">收回</a></div></div>';d.innerHTML=k}}}}function searchCDkeyCallback(e){var g,h,c;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(e==null||!(e.r instanceof Array)||e.r.length<1){drawPages(0,"searchIntegral",0);g=b.insertRow(b.rows.length);h=g.insertCell(g.cells.length);h.colSpan=9;h.innerHTML=noRecord;g.style.height="200px"}else{drawPages(e.c,"searchIntegral",e.s);var f=e.r;for(c=0;c<f.length;c++){if(f[c]!=null){g=b.insertRow(b.rows.length);g.className="td_int";h=g.insertCell(g.cells.length);h.innerHTML=f[c].name;h=g.insertCell(g.cells.length);if(document.getElementById("prov").value==="ZQ"){h.innerHTML="中秋活动"}else{h.innerHTML=activityType[f[c].type]}h=g.insertCell(g.cells.length);h.innerHTML=f[c].totalNum;h=g.insertCell(g.cells.length);h.innerHTML=f[c].totalNum-f[c].raffleNum1;h=g.insertCell(g.cells.length);h.innerHTML=formatDate(f[c].startTime);h=g.insertCell(g.cells.length);h.innerHTML=formatDate(f[c].endTime);h=g.insertCell(g.cells.length);h.innerHTML=formatDate(f[c].expires);h=g.insertCell(g.cells.length);var a=Date.parse(new Date());if(f[c].startTime>a){h.innerHTML="未开始";h=g.insertCell(g.cells.length);h.innerHTML='<a href= "javascript:showCDkey('+f[c].id+',1)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteIntegralLottery('+f[c].id+')">删除</a>'}else{if(f[c].startTime<=a&&f[c].endTime>=a){h.innerHTML="进行中";h=g.insertCell(g.cells.length);h.innerHTML='<a href= "javascript:showCDkey('+f[c].id+',2)">详情</a>&nbsp;&nbsp;<a href= "javascript:stopIntegralLottery('+f[c].id+')">结束</a>'}else{if(f[c].endTime<a){h.innerHTML="已结束";h=g.insertCell(g.cells.length);h.innerHTML='<a href= "javascript:showCDkey('+f[c].id+',3)">详情</a>'}}}g=b.insertRow(b.rows.length);g.className="td_int";g.style.display="none";g.id="integral_"+f[c].id;h=g.insertCell(g.cells.length);h.colSpan=9;var d="";d='<div class="right_em_con"><div class="main_tab"><a class="on" href="#" >奖品详情</a></div><div id="award_detail'+f[c].id+'"><div class="main_search">奖品状态：<select id="status_'+f[c].id+'" name="status"><option value="-1">全部</option><option value="0">未兑换</option><option value="2">已发奖</option><option value="4">待回收</option></select>&nbsp;&nbsp;&nbsp;兑换人手机：<input type="text" id="raName_'+f[c].id+'" name="raName">&nbsp;&nbsp;&nbsp;兑换时间：<input type="text" size="10" id="startTime_'+f[c].id+'" name="startTime" class="Wdate" onclick="WdatePicker();" readonly="readonly" style="width: 100px;" onFocus="WdatePicker({dateFmt:\'yyyy-MM-dd\',maxDate:\'#F{$dp.$D("endTime")}\'})"/> --<input type="text" size="10" id="endTime_'+f[c].id+'" name="endTime" class="Wdate" onclick="WdatePicker();" readonly="readonly" style="width: 100px;" onFocus="WdatePicker({dateFmt:\'yyyy-MM-dd\',minDate:\'#F{$dp.$D("startTime")}\'})"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input class="search_but" type="button" value="搜索" onclick="searchCDkeyPrize(0)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="main_jg"></div><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td><input type="checkBox" id="check_'+f[c].id+'" value="10" onclick="allChecked1(this)"/>全选</td><td>兑换券号码</td><td>兑换人手机</td><td>openid</td><td>兑换时间</td>';d+="<td>密码</td>";d+='<td>奖品状态</td><td id="td_'+f[c].id+'">URL</td></tr><tbody id="res_'+f[c].id+'"></tbody></table><div class="main_page" id="pri_'+f[c].id+'">&nbsp;</div></div><div class="goto_back"><a href= "javascript:hideLottery('+f[c].id+')">收回</a></div></div>';h.innerHTML=d}}}}function showCDkey(c,a){$("#integralLotteryId").val(c);$("#gameStatus").val(a);$("tr[id^=integral_]").hide();var b=document.getElementById("integral_"+c);b.style.display="";searchCDkeyPrize(0)}function searchCDkeyPrize(d){var f=document.getElementById("integralLotteryId").value;showRunning(8,f);var a=document.getElementById("status_"+f).value;var g=document.getElementById("raName_"+f).value;var e=document.getElementById("startTime_"+f).value;var c=document.getElementById("endTime_"+f).value;var b=$("#gameStatus").val();if(a==4&&b==3){a=0}else{if(a==0&&b==3){a=4}}$.ajax({type:"post",url:getPath()+"/activity/searchCDkeyPrize.do",data:"integralLotteryId="+f+"&startIdx="+d+"&status="+a+"&raName="+g+"&startTime="+e+"&endTime="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(h){searchCDkeyPrizeCallback(h,f)}})}function searchCDkeyPrizeCallback(d,h){var f,g,c;var a=document.getElementById("res_"+h);while(a.rows.length>0){a.removeChild(a.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchCDkeyPrize",0,"prize");f=a.insertRow(a.rows.length);g=f.insertCell(f.cells.length);g.colSpan=8;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchCDkeyPrize",d.s,"prize");var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=a.insertRow(a.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);if(e[c].status==2){var h=document.getElementById("integralLotteryId").value;if(document.getElementById("check_"+h).checked){g.innerHTML="<input type='checkBox' checked='checked' value='"+e[c].id+"'/>"}else{g.innerHTML="<input type='checkBox'value='"+e[c].id+"'/>"}}else{g.innerHTML=""}g=f.insertCell(f.cells.length);g.innerHTML=e[c].name;g=f.insertCell(f.cells.length);g.innerHTML=(e[c].mobile)?e[c].mobile:"";g=f.insertCell(f.cells.length);g.innerHTML=(e[c].openid)?e[c].openid:"";g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].raffleTime);g=f.insertCell(f.cells.length);g.innerHTML="******";g=f.insertCell(f.cells.length);if(e[c].status==0){var b=$("#gameStatus").val();if(b==3){g.innerHTML="待回收"}else{g.innerHTML="未兑换"}}else{if(e[c].status==2){g.innerHTML="已发奖"}}var h=document.getElementById("integralLotteryId").value;g=f.insertCell(f.cells.length);g.innerHTML="<a href=\"javascript:previewMsg('x"+h+"-"+c+'\')">详情</a><span id="x'+h+"-"+c+'" style="display:none"><img src= "/ilsp-wechat/web/barcode.do?t=2&c='+e[c].name+e[c].code+'"></span>'}}}}function getBarcode(a,b){$.ajax({type:"get",url:getPath()+"/web/barcode.do",data:"c="+(a+b),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){}})}function showIntegralLottery(c,a){$("#integralLotteryId").val(c);$("#gameStatus").val(a);$("tr[id^=integral_]").hide();var b=document.getElementById("integral_"+c);b.style.display="";prizeChange(c,1)}function hideLottery(b){var a=document.getElementById("integral_"+b);a.style.display="none"}function prizeChange(b,a){$("a[id*=_con_]").removeClass("on");$("#"+b+"_con_"+a).addClass("on");$("table[id*=_tb_]").hide();$("#"+b+"_tb_"+a).show();$("#level").val(a);searchIntegralPrize(0)}var pandStartIdx=0;function searchIntegralPrize(h){pandStartIdx=h;var e=document.getElementById("integralLotteryId").value;var a=document.getElementById("level").value;var c="";if(document.getElementById("status_"+e)){c=document.getElementById("status_"+e).value}var k="";if(document.getElementById("raName_"+e)){k=document.getElementById("raName_"+e).value}var b="";if(document.getElementById("startTime_"+e)){b=document.getElementById("startTime_"+e).value}var d="";if(document.getElementById("endTime_"+e)){d=document.getElementById("endTime_"+e).value}var g=$("#gameStatus").val();if(c==4&&g==3){c=0}else{if(c==0&&g==3){c=4}}var f="";if(document.getElementById("flag")){f=document.getElementById("flag").value}showRunning(3,e);$.ajax({type:"post",url:getPath()+"/integral/searchIntegralPrize.do",data:"integralLotteryId="+e+"&level="+a+"&startIdx="+h+"&status="+c+"&raName="+k+"&startTime="+b+"&endTime="+d+"&matchStatus="+g,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(l){if(f==1){searchIntegralPrize1Callback(l,e)}else{if(f=="3"){searchIntegralPrizeCallback3(l,e)}else{searchIntegralPrizeCallback(l,e)}}}})}function sendCard(b){var a=$("#result").val();if(a.length==0){alert("卡号不能为空");return}$.ajax({type:"POST",url:getPath()+"/activity/updateCode.do",async:false,data:"id="+b+"&result="+a+"&status=2",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){}});closeWindow();alert("录入成功");searchIntegralPrize(pandStartIdx)}function searchIntegralPrizeCallback3(b,a){var l,c,f;var g=document.getElementById("res_"+a);while(g.rows.length>0){g.removeChild(g.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"searchIntegralPrize",0,"prize");l=g.insertRow(g.rows.length);c=l.insertCell(l.cells.length);c.colSpan=3;c.innerHTML=noRecord;l.style.height="200px"}else{drawPages(b.c,"searchIntegralPrize",b.s,"prize");var e=b.r;var k=e[0].type;for(f=0;f<e.length;f++){if(e[f]!=null){l=g.insertRow(g.rows.length);l.className="td_int";c=l.insertCell(l.cells.length);c.innerHTML=b.s+f+1;c=l.insertCell(l.cells.length);c.innerHTML=e[f].name;c=l.insertCell(l.cells.length);if(e[f].code){c.innerHTML=e[f].worth+"<br>"+e[f].code}else{c.innerHTML=e[f].worth}c=l.insertCell(l.cells.length);c.innerHTML=formatDate(e[f].raffleTime);c=l.insertCell(l.cells.length);c.innerHTML=(e[f].realName)?e[f].realName:"";c=l.insertCell(l.cells.length);var m="";if(e[f].postAddress){m=e[f].postAddress}c.innerHTML=m;c=l.insertCell(l.cells.length);c.innerHTML=(e[f].phone)?e[f].phone:"";c=l.insertCell(l.cells.length);var h="";if(e[f].idnum){h+=e[f].idnum;if(e[f].idcard1){h+="&nbsp;<a target='_blank' href='"+e[f].idcard1+"'>正面</a>"}if(e[f].idcard2){h+="&nbsp;<a target='_blank' href='"+e[f].idcard2+"'>反面</a>"}}c.innerHTML=h;c=l.insertCell(l.cells.length);if(e[f].status==0){var d=$("#gameStatus").val();if(d==2){c.innerHTML="待回收"}else{c.innerHTML="未中奖"}}if(e[f].status==1){c.innerHTML="已中奖"}else{if(k==1&&e[f].status==2){c.innerHTML="已发货"}else{if(k!=1&&e[f].status==2){c.innerHTML="已派奖"}}}c=l.insertCell(l.cells.length);if(k==1){if(e[f].status==2){c.innerHTML="--"}else{if(e[f].status==1){c.innerHTML='<a href= "javascript:sendOut('+e[f].id+',2)">发货</a>'}else{c.innerHTML="-"}}}else{if(e[f].status==2){c.innerHTML="--"}else{if(e[f].status==1){c.innerHTML="<a href= 'javascript:writeCardBox("+e[f].id+")'>派奖</a>"}else{c.innerHTML="-"}}}}}}}function searchIntegralPrizeCallback(b,a){var l,c,f;var g=document.getElementById("res_"+a);while(g.rows.length>0){g.removeChild(g.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"searchIntegralPrize",0,"prize");l=g.insertRow(g.rows.length);c=l.insertCell(l.cells.length);c.colSpan=3;c.innerHTML=noRecord;l.style.height="200px"}else{drawPages(b.c,"searchIntegralPrize",b.s,"prize");var e=b.r;var k=e[0].type;for(f=0;f<e.length;f++){if(e[f]!=null){l=g.insertRow(g.rows.length);l.className="td_int";c=l.insertCell(l.cells.length);c.innerHTML=b.s+f+1;c=l.insertCell(l.cells.length);c.innerHTML=e[f].name;c=l.insertCell(l.cells.length);if(e[f].code){c.innerHTML=e[f].worth+"<br>"+e[f].code}else{c.innerHTML=e[f].worth}c=l.insertCell(l.cells.length);c.innerHTML=formatDate(e[f].raffleTime);c=l.insertCell(l.cells.length);c.innerHTML=(e[f].realName)?e[f].realName:"";c=l.insertCell(l.cells.length);var m="";if(e[f].address){if(e[f].userProvince){m+=e[f].userProvince}if(e[f].userCity){m+=e[f].userCity}if(e[f].userCounty){m+=e[f].userCounty}if(e[f].address){m+=e[f].address}}c.innerHTML=m;c=l.insertCell(l.cells.length);c.innerHTML=(e[f].phone)?e[f].phone:"";c=l.insertCell(l.cells.length);var h="";if(e[f].idnum){h+=e[f].idnum}c.innerHTML=h;c=l.insertCell(l.cells.length);if(e[f].status==0){var d=$("#gameStatus").val();if(d==2){c.innerHTML="待回收"}else{c.innerHTML="未中奖"}}if(e[f].status==1){c.innerHTML="已中奖"}else{if(k==1&&e[f].status==2){c.innerHTML="已发货"}else{if(k!=1&&e[f].status==2){c.innerHTML="已派奖"}}}c=l.insertCell(l.cells.length);if(k==1){if(e[f].status==2){c.innerHTML="--"}else{if(e[f].status==1){c.innerHTML='<a href= "javascript:sendOut('+e[f].id+',2)">发货</a>'}else{c.innerHTML="-"}}}else{if(e[f].status==2){c.innerHTML="--"}else{if(e[f].status==1){c.innerHTML="<a href= 'javascript:writeCardBox("+e[f].id+")'>派奖</a>"}else{c.innerHTML="-"}}}}}}}function searchIntegralPrizeCallback2(b,a){var l,c,f;var g=document.getElementById("res_"+a);while(g.rows.length>0){g.removeChild(g.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"searchIntegralPrize",0,"prize");l=g.insertRow(g.rows.length);c=l.insertCell(l.cells.length);c.colSpan=3;c.innerHTML=noRecord;l.style.height="200px"}else{drawPages(b.c,"searchIntegralPrize",b.s,"prize");var e=b.r;var k=e[0].type;for(f=0;f<e.length;f++){if(e[f]!=null){l=g.insertRow(g.rows.length);l.className="td_int";c=l.insertCell(l.cells.length);c.innerHTML=b.s+f+1;c=l.insertCell(l.cells.length);c.innerHTML=e[f].name;c=l.insertCell(l.cells.length);c.innerHTML=e[f].worth;c=l.insertCell(l.cells.length);c.innerHTML=(e[f].mobile)?e[f].mobile:"";c=l.insertCell(l.cells.length);c.innerHTML=formatDate(e[f].raffleTime);c=l.insertCell(l.cells.length);c.innerHTML=(e[f].realName)?e[f].realName:"";c=l.insertCell(l.cells.length);var m="";if(e[f].address){m+=e[f].userProvince+e[f].userCity+e[f].userCounty+e[f].address+"["+e[f].postCode+"]"}c.innerHTML=m;c=l.insertCell(l.cells.length);c.innerHTML=(e[f].phone)?e[f].phone:"";c=l.insertCell(l.cells.length);var h="";if(e[f].idnum){h+=e[f].idnum}h+=(e[f].idcard1)?"<br><a href='"+e[f].idcard1+"'>正面</a>&nbsp;&nbsp;":"";if(e[f].idcard2){h+="<a href='"+e[f].idcard2+"'>反面</a>"}c.innerHTML=h;c=l.insertCell(l.cells.length);if(e[f].status==0){var d=$("#gameStatus").val();if(d==2){c.innerHTML="待回收"}else{c.innerHTML="未派发"}}if(e[f].status==1){c.innerHTML="已派发"}else{if(k==1&&e[f].status==2){c.innerHTML="已发货"}}c=l.insertCell(l.cells.length);if(k==1){if(e[f].status==2){c.innerHTML="--"}else{if(e[f].status==1){c.innerHTML='<a href= "javascript:sendOut('+e[f].id+',2)">发货</a>'}else{c.innerHTML="-"}}}else{c.innerHTML="******"}}}}}function searchIntegralPrize1Callback(b,a){var k,c,g;var h=document.getElementById("res_"+a);var d=document.getElementById("mm").value;while(h.rows.length>0){h.removeChild(h.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"searchIntegralPrize",0,"prize");k=h.insertRow(h.rows.length);c=k.insertCell(k.cells.length);c.colSpan=3;c.innerHTML=noRecord;k.style.height="200px"}else{drawPages(b.c,"searchIntegralPrize",b.s,"prize");var f=b.r;for(g=0;g<f.length;g++){if(f[g]!=null){k=h.insertRow(h.rows.length);k.className="td_int";c=k.insertCell(k.cells.length);if(f[g].status==1){var a=document.getElementById("integralLotteryId").value;if(document.getElementById("check_"+a).checked){c.innerHTML="<input type='checkBox' checked='checked' value='"+f[g].id+"'/>"}else{c.innerHTML="<input type='checkBox'value='"+f[g].id+"'/>"}}else{c.innerHTML=""}c=k.insertCell(k.cells.length);c.innerHTML=f[g].num;c=k.insertCell(k.cells.length);c.innerHTML=(f[g].mobile)?f[g].mobile:"";c=k.insertCell(k.cells.length);c.innerHTML=formatDate(f[g].raffleTime);if(d==1){c=k.insertCell(k.cells.length);c.innerHTML="******"}c=k.insertCell(k.cells.length);if(f[g].status==0){var e=$("#gameStatus").val();if(e==3){c.innerHTML="待回收"}else{c.innerHTML="未兑换"}}else{if(f[g].status==1){c.innerHTML="已兑换"}else{if(f[g].status==2){c.innerHTML="已发货"}else{if(f[g].status==3){c.innerHTML="已拒绝"}}}}c=k.insertCell(k.cells.length);if(f[g].status==1){c.innerHTML='<a href= "javascript:sendOut('+f[g].id+",2,'')\">发货</a>&nbsp;&nbsp;&nbsp;<a href= \"javascript:sendOut("+f[g].id+",3,'')\">拒绝</a>"}else{c.innerHTML=""}}}}}function deleteIntegralLottery(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/integral/deleteIntegralLottery.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("删除成功！");window.location.reload()}else{alert("删除失败！")}}})}}function stopIntegralLottery(a){if(confirm("确认结束？")){$.ajax({type:"post",url:getPath()+"/integral/stopIntegralLottery.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("结束成功！");window.location.reload()}else{alert("结束失败！")}}})}}function sendOut(c,a,b){if(b!=""){if(confirm(b)){$.ajax({type:"post",url:getPath()+"/integral/sendOut.do",data:"id="+c+"&status="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d=="success"){alert("操作成功！");searchIntegralPrize(0)}else{alert("操作失败！")}}})}}else{$.ajax({type:"post",url:getPath()+"/integral/sendOut.do",data:"id="+c+"&status="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d=="success"){alert("操作成功！");searchIntegralPrize(0)}else{alert("操作失败！")}}})}}function uploadIntegralPic(fileElementId,picId){if(!$("#"+fileElementId).val()){alert("请选择上传文件");return}var action="uploadmntpic";if(arguments.length>2){if(arguments[2]==2){action="uploadimage"}}showLoading();$.ajaxFileUpload({url:getPath()+"/controller.jsp?action="+action,secureuri:false,timeout:600000,fileElementId:fileElementId,dataType:"txt",success:function(data,status){hideLoading();eval("data = "+data);if(data.url&&picId){var picview=document.getElementById(picId);if(picId=="logoPicview"){picview.innerHTML='<img src="'+data.url+'" width="78px" height="78px"><input type="hidden" id="logoPath"  name="logoPath" value="'+getMediaPath(data.url)+'"/>'}else{if(picId=="memberPicview"||picId=="memberPicview1"){picview.innerHTML='<img src="'+data.url+'" width="150px" >';$("#picturePath").val(data.url)}else{picview.innerHTML='<img src="'+data.url+'" width="78px" height="78px"><input type="hidden" id="picturePath" name="picturePath" value="'+getMediaPath(data.url)+'"/>'}}}else{if(data.state){alert(data.state)}}}})}function searchIntegralExchangeCallback(b){var l,c,f;var g=document.getElementById("res");var k=document.getElementById("flag").value;var d=document.getElementById("mm").value;while(g.rows.length>0){g.removeChild(g.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"searchIntegral",0);l=g.insertRow(g.rows.length);c=l.insertCell(l.cells.length);c.colSpan=11;c.innerHTML=noRecord;l.style.height="200px"}else{drawPages(b.c,"searchIntegral",b.s);var e=b.r;for(f=0;f<e.length;f++){if(e[f]!=null){l=g.insertRow(g.rows.length);l.className="td_int";c=l.insertCell(l.cells.length);c.innerHTML=e[f].activityNum;c=l.insertCell(l.cells.length);c.innerHTML=e[f].name;c=l.insertCell(l.cells.length);c.innerHTML=e[f].totalNum;c=l.insertCell(l.cells.length);c.innerHTML=e[f].totalNum-e[f].raffleNum;c=l.insertCell(l.cells.length);c.innerHTML=e[f].param1;c=l.insertCell(l.cells.length);c.innerHTML="<a href=\"javascript:previewMsg('integralLogo_"+f+'\')">图片</a><span id="integralLogo_'+f+'" style="display:none"><img src=\''+downloadPath+e[f].logo+"'></span>";if(k!=1){c=l.insertCell(l.cells.length);c.innerHTML="<a href=\"javascript:previewMsg('integralPic_"+f+'\')">图片</a><span id="integralPic_'+f+'" style="display:none"><img src=\''+downloadPath+e[f].picture+"'></span>"}c=l.insertCell(l.cells.length);c.innerHTML=formatDate(e[f].startTime);c=l.insertCell(l.cells.length);c.innerHTML=formatDate(e[f].endTime);c=l.insertCell(l.cells.length);var a=Date.parse(new Date());if(e[f].startTime>a){c.innerHTML="未开始";c=l.insertCell(l.cells.length);c.innerHTML='<a href= "javascript:showIntegralExchange('+e[f].id+',1)">详情</a>&nbsp;&nbsp;<a href= "javascript:deleteIntegralLottery('+e[f].id+')">删除</a>'}else{if(e[f].startTime<=a&&e[f].endTime>=a){c.innerHTML="进行中";c=l.insertCell(l.cells.length);c.innerHTML='<a href= "javascript:showIntegralExchange('+e[f].id+',2)">详情</a>&nbsp;&nbsp;<a href= "javascript:stopIntegralLottery('+e[f].id+')">结束</a>'}else{if(e[f].endTime<a){c.innerHTML="已截止";c=l.insertCell(l.cells.length);c.innerHTML='<a href= "javascript:showIntegralExchange('+e[f].id+',3)">详情</a>'}}}l=g.insertRow(g.rows.length);l.className="td_int";l.style.display="none";l.id="integral_"+e[f].id;c=l.insertCell(l.cells.length);c.colSpan=11;if(k!=1){c.innerHTML='<div class="right_em_con"><div class="main_tab"><a class="on" href="#" onclick="JavaScript:integralChange(1,2)" id="'+e[f].id+'_con_1">奖品详情</a><a href="#" onclick="JavaScript:integralChange(2,1)" id="'+e[f].id+'_con_2">兑换说明</a></div><div id="award_detail'+e[f].id+'"><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>奖品序号</td><td>兑换人</td><td>兑换时间</td><td>奖品状态</td><td id="td_'+e[f].id+'">密码</td></tr><tbody id="res_'+e[f].id+'"></tbody></table><div class="main_page" id="pri_'+e[f].id+'">&nbsp;</div></div><div id="exchange_detail'+e[f].id+'"><span>'+e[f].remark+'</span></div><div class="goto_back"><a href= "javascript:hideLottery('+e[f].id+')">收回</a></div></div>'}else{var h="";h='<div class="right_em_con"><div class="main_tab"><a class="on" href="#" >奖品详情</a></div><div id="award_detail'+e[f].id+'"><div class="main_search">奖品状态：<select id="status_'+e[f].id+'" name="status"><option value="-1">全部</option><option value="0">未兑换</option><option value="1">已兑换</option><option value="2">已发货</option><option value="3">已拒绝</option><option value="4">待回收</option></select>&nbsp;&nbsp;&nbsp;兑换人：<input type="text" id="raName_'+e[f].id+'" name="raName">&nbsp;&nbsp;&nbsp;兑换时间：<input type="text" size="10" id="startTime_'+e[f].id+'" name="startTime" class="Wdate" onclick="WdatePicker();" readonly="readonly" style="width: 100px;" onFocus="WdatePicker({dateFmt:\'yyyy-MM-dd\',maxDate:\'#F{$dp.$D("endTime")}\'})"/> --<input type="text" size="10" id="endTime_'+e[f].id+'" name="endTime" class="Wdate" onclick="WdatePicker();" readonly="readonly" style="width: 100px;" onFocus="WdatePicker({dateFmt:\'yyyy-MM-dd\',minDate:\'#F{$dp.$D("startTime")}\'})"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input class="search_but" type="button" value="搜索" onclick="searchIntegralPrize(0)">&nbsp;&nbsp;&nbsp;<input class="search_but" type="button" value="批量发货" onclick="sendBatch(2,\'确认发货？\')">&nbsp;&nbsp;&nbsp;<input class="search_but" type="button" value="批量拒绝" onclick="sendBatch(3,\'确认拒绝？\')">&nbsp;&nbsp;&nbsp;</div><div class="main_jg"></div><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td><input type="checkBox" id="check_'+e[f].id+'" value="10" onclick="allChecked(this)"/>全选</td><td>奖品序号</td><td>兑换人</td><td>兑换时间</td>';if(d==1){h+="<td>密码</td>"}h+='<td>奖品状态</td><td id="td_'+e[f].id+'">操作</td></tr><tbody id="res_'+e[f].id+'"></tbody></table><div class="main_page" id="pri_'+e[f].id+'">&nbsp;</div></div><div class="goto_back"><a href= "javascript:hideLottery('+e[f].id+')">收回</a></div></div>';c.innerHTML=h}}}}}function showIntegralExchange(c,a){$("#integralLotteryId").val(c);$("#gameStatus").val(a);$("tr[id^=integral_]").hide();var b=document.getElementById("integral_"+c);b.style.display="";integralChange(1,2)}function integralChange(b,a){var c=$("#integralLotteryId").val();$("#"+c+"_con_"+a).removeClass("on");$("#"+c+"_con_"+b).addClass("on");if(b==1){$("#award_detail"+c).css("display","");$("#exchange_detail"+c).css("display","none");searchIntegralPrize(0)}else{$("#award_detail"+c).css("display","none");$("#exchange_detail"+c).css("display","")}}function savePicture(a){var b=$("#pictureAddForm").serialize();$.ajax({type:"post",url:getPath()+"/integral/savePicture.do?type="+a,data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="ok"){alert("发布成功！");if(a==0){window.location=getPath()+"/html/searchFocusImg.html"}if(a==1){window.location=getPath()+"/html/searchSpreadImg.html"}if(a==2){window.location=getPath()+"/html/integralSetting.html"}}if(c.r=="haveNullPoint"){alert("有字段为空！")}if(c.r=="duplicatePicOrder"){alert("顺序重复！")}if(c.r=="fail"){alert("发布失败！")}}})}function loadPicture(){var b,a=location.search.substring(1,location.search.length);if(a.length>0){b=parseParam(a);var c=b.id;if(c){$.ajax({type:"post",url:getPath()+"/integral/getPictureById.do",data:"id="+c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e!=null&&e!=""){$("#picid").val(e.id);$("#title").val(e.name);$("#sequence").val(e.picOrder);var d='<img src="'+downloadPath+e.picUrl+'" width="78px" height="78px"><input type="hidden" id="picturePath" name="picturePath" value="'+e.picUrl+'"/>';$("#pictureView").html(d)}}})}}}function searchPicture(a){var b=document.getElementById("picType").value;$.ajax({type:"post",url:getPath()+"/integral/searchPicture.do",data:"picType="+b+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){searchPictureCallback(c,b)}})}function searchPictureCallback(d,c){var f,h,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchPicture",0);f=a.insertRow(a.rows.length);h=f.insertCell(f.cells.length);h.colSpan=4;h.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchPicture",d.s);var e=d.r;for(b=0;b<e.length;b++){if(e[b]!=null){var g=getPath();if(c==0){g+="/html/publishFocusImg.html?id="+e[b].id}else{g+="/html/publishSpreadImg.html?id="+e[b].id}f=a.insertRow(a.rows.length);f.className="td_int";h=f.insertCell(f.cells.length);h.innerHTML=e[b].picOrder;h=f.insertCell(f.cells.length);h.innerHTML=e[b].name;h=f.insertCell(f.cells.length);h.innerHTML=formatDate(e[b].createTime);h=f.insertCell(f.cells.length);h.innerHTML='<a href= "'+g+'">修改</a>&nbsp;&nbsp;<a href= "javascript:deletePicture('+e[b].id+')">删除</a>'}}}}function deletePicture(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/integral/deletePicture.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b=="success"){alert("删除成功！");window.location.reload()}else{alert("删除失败！")}}})}}function loadPictureSet(){$.ajax({type:"post",url:getPath()+"/integral/getPictureByType.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c!=null&&c.length>0){$("#picid").val(c[0].id);$("#link").val(c[0].link);$("#picUrl").val(c[0].link);var a='<img src="'+downloadPath+c[0].picUrl+'" width="250px" height="200px">';$("#pictureReview").html(a);var b='<img src="'+downloadPath+c[0].picUrl+'" width="78px" height="78px"><input type="hidden" id="picturePath" name="picturePath" value="'+c[0].picUrl+'"/>';$("#pictureView").html(b)}}})}function searchGuessingList(a){a=a/8;document.getElementById("res").innerHTML="";state=document.getElementById("status").value;$.ajax({type:"POST",url:getPath()+"/activity/searchMatchList.do?",data:"status="+state+"&page="+a+"&flag=1",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){state=document.getElementById("status").value;if(e.r.length>0){drawPages(e.c,"searchMatchList",a*8);for(var d=0;d<e.r.length;d++){var b="";if(e.r[d].result){b=e.r[d].result}if(state!="1"&&state!="2"){var c=Date.parse(new Date());if(e.r[d].status==0){if(c<e.r[d].startTime){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>待销售</td><td><a href= 'javascript:modifyEventMatch("+e.r[d].id+",2)'>修改</a></td><tr>"}else{if(c<=e.r[d].endTime&&c>=e.r[d].startTime){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>销售中</td><td><a href= 'javascript:modifyEventMatch("+e.r[d].id+",2)'>修改</a></td><tr>"}else{if(c>e.r[d].endTime){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已截止</td><td><a href= 'javascript:writeResultBox("+e.r[d].id+")'>结果录入</a></td><tr>"}}}}else{if(e.r[d].status==1){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已返奖</td><td></td><tr>"}else{if(e.r[d].status==2){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已开奖</td><td><a href= 'javascript:writeResultBox("+e.r[d].id+")'>结果录入</a>&nbsp;&nbsp;&nbsp;<a href= 'javascript:returnAwardBox("+e.r[d].id+")'>返奖</a></td><tr>"}}}}else{if(state==1){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已返奖</td><td></td><tr>"}else{if(state==2){document.getElementById("res").innerHTML+="<tr><td>"+guessingType[e.r[d].type]+"</td><td>"+e.r[d].homeName+"</td><td>"+e.r[d].awayName+"</td><td><a href='javascript:previewMsg(\"x"+d+"\")'>图片</a><span id='x"+d+"'style='display:none'><img src='"+e.r[d].picture+"'/></span></td><td>"+e.r[d].remark+"</td><td>"+e.r[d].option1+"</td><td>"+e.r[d].option2+"</td><td>"+e.r[d].option3+"</td><td>"+b+"</td><td>"+formatDate(e.r[d].startTime)+"</td><td>"+formatDate(e.r[d].endTime)+"</td><td>已开奖</td><td><a href= 'javascript:writeResultBox("+e.r[d].id+")'>结果录入</a>&nbsp;&nbsp;&nbsp;<a href= 'javascript:returnAwardBox("+e.r[d].id+")'>返奖</a></td><tr>"}}}}}else{document.getElementById("res").innerHTML+="<td></td><td></td><td></td><td></td><td>无数据!</td>";drawPages(e.c,"searchMatchList",a*8)}},})}function submitGuessing(){startTime=document.getElementById("salestartTime").value;endTime=document.getElementById("saleendTime").value;name=document.getElementById("name").value;position=document.getElementById("position").value;type=document.getElementById("type").value;remark=document.getElementById("remark").value;option1=document.getElementById("option1").value;option2=document.getElementById("option2").value;option3=document.getElementById("option3").value;picturePath=document.getElementById("picturePath").value;if(startTime==""||endTime==""||name==""||position==""||type==""||remark==""||option1==""||option2==""||option3==""||picturePath==""){alert("竞猜信息不得为空.")}else{$.ajax({type:"POST",url:getPath()+"/activity/addGuessing.do",async:false,data:"startTime="+startTime+"&endTime="+endTime+"&name="+name+"&position="+position+"&type="+type+"&remark="+remark+"&option1="+encodeURIComponent(option1)+"&option2="+encodeURIComponent(option2)+"&option3="+encodeURIComponent(option3)+"&picturePath="+picturePath,dataType:"text",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(a=="success"){alert("赛事添加成功");window.location.reload()}},})}}function submitModifyGuessing(a){startTime=document.getElementById("MsalestartTime").value;endTime=document.getElementById("MsaleendTime").value;name=document.getElementById("mname").value;position=document.getElementById("mposition").value;option1=document.getElementById("moption1").value;option2=document.getElementById("moption2").value;option3=document.getElementById("moption3").value;remark=document.getElementById("mremark").value;type=document.getElementById("mtype").value;picture=document.getElementById("picturePath").value;$.ajax({type:"POST",url:getPath()+"/activity/ModifyIdGuessing.do",async:false,data:"id="+a+"&startTime="+startTime+"&endTime="+endTime+"&name="+name+"&position="+position+"&option1="+encodeURIComponent(option1)+"&option2="+encodeURIComponent(option2)+"&option3="+encodeURIComponent(option3)+"&remark="+remark+"&type="+type+"&picture="+picture,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){}});alert("竞猜修改成功");window.location.reload()}function openAward(a){result=document.getElementById("result").value;if(result.length==0){alert("结果不能为空");return}$.ajax({type:"POST",url:getPath()+"/activity/ModifyIdResult.do",async:false,data:"id="+a+"&result="+result+"&status=2",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){}});closeWindow();alert("录入成功");window.location.reload()}function returnAward(a){$.ajax({type:"POST",url:getPath()+"/activity/ModifyIdResult.do",async:false,data:"id="+a+"&status=1",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){}});closeWindow();alert("返奖成功");window.location.reload()}function searchGuessingEventList(a){showRunning(11);startTime=document.getElementById("startTime").value;endTime=document.getElementById("endTime").value;state=document.getElementById("state").value;telNum=document.getElementById("telNum").value;if(startTime==""&&endTime!=""){alert("开始时间不能为空");return}if(startTime!=""&&endTime==""){alert("结束时间不能为空");return}$.ajax({type:"POST",url:getPath()+"/activity/searchOrderList.do",data:"startTime="+startTime+"&endTime="+endTime+"&startIdx="+a+"&state="+state+"&telNum="+telNum+"&flag=2",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchGuessingListCallback(b)},})}function searchGuessingListCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchGuessingEventList",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=11;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchGuessingEventList",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=d[b].id;f=e.insertCell(e.cells.length);f.innerHTML=d[b].telNum;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].betTime);f=e.insertCell(e.cells.length);f.innerHTML=guessingType[d[b].type];f=e.insertCell(e.cells.length);f.innerHTML=d[b].homeName;f=e.insertCell(e.cells.length);f.innerHTML=d[b].betContent;f=e.insertCell(e.cells.length);if(d[b].betResult){f.innerHTML=d[b].betResult}else{f.innerHTML="--"}f=e.insertCell(e.cells.length);if(d[b].betResult==d[b].betContent){f.innerHTML="1"}else{f.innerHTML="--"}f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].startTime);f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].endTime);f=e.insertCell(e.cells.length);f.innerHTML=formatStatus[d[b].state]}}}}function allChecked(){var a=document.getElementById("integralLotteryId").value;if(document.getElementById("check_"+a).checked){document.getElementById("status_"+a).value=1;searchIntegralPrize(0)}else{document.getElementById("status_"+a).value=-1;searchIntegralPrize(0)}}function allChecked1(){var a=document.getElementById("integralLotteryId").value;if(document.getElementById("check_"+a).checked){document.getElementById("status_"+a).value=2;searchCDkeyPrize(0)}else{document.getElementById("status_"+a).value=-1;searchCDkeyPrize(0)}}function sendBatch(c,e){var g=document.getElementById("integralLotteryId").value;var b="",a=document.getElementById("res_"+g).children;for(var d=0;d<a.length;d++){var f=a[d].children[0].children[0];if(f&&f.checked){b+=f.value+","}}if(b==""){alert("请至少选择一项")}else{b=b.substring(0,b.length-1);sendOut(b,c,e)}}function userStatisticsSearch(a){showRunning(8);var b=$("#statisticsForm").serialize();$.ajax({type:"post",url:getPath()+"/manage/userstatistics.do?startIdx="+a,data:b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){userStatisticSearchCallback(c)}})}function userStatisticSearchCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"userStatisticsSearch",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=8;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"userStatisticsSearch",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);if(!d[b].mobile){f.innerHTML=""}else{f.innerHTML=d[b].mobile}f=e.insertCell(e.cells.length);f.innerHTML=d[b].hd;f=e.insertCell(e.cells.length);f.innerHTML=d[b].xh;f=e.insertCell(e.cells.length);f.innerHTML=d[b].sy;f=e.insertCell(e.cells.length);f.innerHTML=d[b].c;f=e.insertCell(e.cells.length);f.innerHTML=d[b].t1;f=e.insertCell(e.cells.length);f.innerHTML=d[b].t2}}}}function exportUserstatistics(){document.getElementById("statisticsForm").action=getPath()+"/manage/userstatisticsExport.do";document.getElementById("statisticsForm").submit()}function addSerialNum(a){var b=document.getElementById("serialNum").value;if(b.trim()==""){alert("网点编号不能为空");return}var a=document.getElementById("prov").value;$.ajax({type:"post",url:getPath()+"/activity/insertSerialNum.do",data:"serialNum="+b+"&prov="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c=="success"){alert("保存成功！");window.location=getPath()+"/html/SerialNumberSearch.html?"+a}else{if(c=="duplicateStoreNum"){alert("网点编号已存在！")}else{alert("保存失败！")}}}})}function uploadSerialNum(fileElementId,prov){var exl=document.getElementById("exlFile").value;var prov=document.getElementById("prov").value;if(exl==""){alert("请上传文件");return}$.ajaxFileUpload({url:getPath()+"/activity/excelImportSerialNums.do?filename="+fileElementId+"&prov="+prov,secureuri:false,fileElementId:fileElementId,dataType:"txt",async:false,success:function(data,status){if(data.split(">").length>1){data=data.substring(data.indexOf(">")+1,data.length-6)}eval("data = "+data);if(data.r=="errorFile"){alert("上传的文件格式错误！");return}if(data.r=="duplicateStoreNum"){alert("有重复网点编号！");return}if(data.r=="fail"){alert("上传失败！");return}if(data.r=="ok"){alert("上传成功！")}}})}function searchSerialNumList(b){showRunning(2);var c=document.getElementById("SerialNum").value;var a=document.getElementById("prov").value;$.ajax({type:"POST",url:getPath()+"/activity/searchSerialNumList.do",data:"SerialNum="+c+"&startIdx="+b+"&prov="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){searchSerialNumListCallback(d)},})}function searchSerialNumListCallback(d,c){var f,g,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchSerialNumList",0);f=a.insertRow(a.rows.length);g=f.insertCell(f.cells.length);g.colSpan=2;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchSerialNumList",d.s);var e=d.r;for(b=0;b<e.length;b++){if(e[b]!=null){f=a.insertRow(a.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=e[b].siteId;g=f.insertCell(f.cells.length);g.innerHTML="<a href= 'javascript:writeSerialNumBox("+e[b].id+")'>修改</a>&nbsp;&nbsp;&nbsp;<a href= 'javascript:deleteSerialNum("+e[b].id+")'>删除</a>";if(e[b].status==1){g.innerHTML+="&nbsp;&nbsp;&nbsp;<a href= 'javascript:blackSerialNum("+e[b].id+",-1)'>加黑</a>"}else{g.innerHTML+="&nbsp;&nbsp;&nbsp;<a href= 'javascript:blackSerialNum("+e[b].id+",1)'>解除加黑</a>"}}}}}function blackSerialNum(b,a){if(confirm("确认进行吗？")){$.ajax({type:"post",url:getPath()+"/activity/blackSerialNum.do",data:"id="+b+"&status="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d.c=="success"){var c=document.getElementById("prov").value;searchSerialNumList(0,c)}else{alert("操作失败！")}},error:function(d,c){}})}}function serialCancel(){var a=document.getElementById("prov").value;window.location=getPath()+"/html/SerialNumberSearch.html?"+a}function deleteSerialNum(a){if(confirm("确认删除？")){$.ajax({type:"post",url:getPath()+"/activity/deleteSerialNum.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.c=="success"){var b=document.getElementById("prov").value;searchSerialNumList(0)}else{alert("删除失败！")}},error:function(c,b){}})}}function updateSerialNum(b){var a=document.getElementById("num").value;if(a.trim()==""){alert("网点编号不能为空");return}$.ajax({type:"post",url:getPath()+"/activity/updateSerialNum.do",data:"id="+b+"&siteId="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.c=="success"){closeWindow();searchSerialNumList(0)}else{if(c.c=="duplicateStoreNum"){alert("该编号已存在！")}else{alert("修改失败！")}}},error:function(d,c){}})}function exportSerialNum(a){document.getElementById("serialForm").action=getPath()+"/activity/serialSiteExport.do";document.getElementById("serialForm").submit()}function saveCDkey(){var a=$("#CDkeyForm").serialize();$.ajax({type:"post",url:getPath()+"/activity/saveCDkey.do",data:a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="ok"){alert("发布成功！");var b=document.getElementById("prov").value;window.location=getPath()+"/html/CDkeySearch.html?"+b}if(c.r=="haveNullPoint"){alert("有字段为空！")}if(c.r=="fail"){alert("发布失败！")}if(c.r=="errorData"){alert("数据有误！")}}})}function saveCDkeyQue(){var a=$("#CDkeyForm").serialize();$.ajax({type:"post",url:getPath()+"/activity/saveCDkeyQue.do",data:a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c.r=="ok"){alert("发布成功！");var b=document.getElementById("prov").value;window.location=getPath()+"/html/searchLottery.html?"+b}if(c.r=="haveNullPoint"){alert("有字段为空！")}if(c.r=="fail"){alert("发布失败！")}if(c.r=="errorData"){alert("数据有误！")}}})}function getActivityName(){$.ajax({type:"post",url:getPath()+"/activity/getActivityName.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b!=null&&b.length>0){var c=document.getElementById("titleId");for(var a=0;a<b.length;a++){c.options[c.options.length]=new Option(b[a].name+""+formatDateNoTime(b[a].endTime),b[a].id,false,false)}}}})}function saveAwardPrize(){var b=document.getElementById("activityName").value;var a=document.getElementById("filename").value;if(b=="0"){alert("请选择抽奖名称！");return}if(a==""){alert("请上传中奖文件！");return}$.ajax({type:"post",url:getPath()+"/activity/saveAwardPrize.do",data:"activityId="+b+"&filename="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){if(c){if(c.r=="ok"){alert("操作成功！");window.location.reload()}else{alert("操作失败！")}}}})}function getCurYueli(){showLoading();$.ajax({type:"POST",url:getPath()+"/yeuli/get.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){hideLoading();if(a&&a.s==200){$("#curImage").attr("src",a.r.local_path)}else{alert(a.r)}},})}function publishYueli(){var a=$("#memberPicview img").attr("src");showLoading();$.ajax({type:"POST",url:getPath()+"/yeuli/add.do",data:"file="+encodeURIComponent(encodeURIComponent(a)),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){hideLoading();if(b&&b.s==200){$("#curImage").attr("src",b.r)}else{alert(b.r)}},})}function getTopic(a){showLoading();$.ajax({type:"post",url:getPath()+"/manage/topic/search.do",data:"m="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){hideLoading();getTopicCallback(b)}})}function getTopicCallback(d){var f,g,c;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"getTopic",0);f=b.insertRow(b.rows.length);g=f.insertCell(f.cells.length);g.colSpan=12;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"getTopic",d.s);var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=b.insertRow(b.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=e[c].id;g=f.insertCell(f.cells.length);g.innerHTML="<span id='title"+e[c].id+"'>"+e[c].title+"</span>";g=f.insertCell(f.cells.length);g.innerHTML="<span id='positive"+e[c].id+"'>"+e[c].positive+"</span>";g=f.insertCell(f.cells.length);g.innerHTML="<span id='negative"+e[c].id+"'>"+e[c].negative+"</span>";g=f.insertCell(f.cells.length);g.innerHTML="<span id='point"+e[c].id+"'>"+e[c].point+"</span>";g=f.insertCell(f.cells.length);g.innerHTML="<img id='img"+e[c].id+"' width='100px' src='"+e[c].pic+"'/>";g=f.insertCell(f.cells.length);g.innerHTML="<span id='startTime"+e[c].id+"'>"+formatDate(e[c].startTime)+"</span>";g=f.insertCell(f.cells.length);g.innerHTML="<span id='stopTime"+e[c].id+"'>"+formatDate(e[c].stopTime)+"</span>";g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].createTime);g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].updateTime);g=f.insertCell(f.cells.length);var a=Date.parse(new Date());if(e[c].startTime>a){g.innerHTML="未开始";g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:modifyTopic('+e[c].id+')">修改</a>&nbsp;&nbsp;<a href= "javascript:deleteTopic('+e[c].id+')">删除</a>'}else{if(e[c].startTime<=a&&e[c].stopTime>=a){g.innerHTML="进行中";g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:showUserTopic('+e[c].id+',1)">详情</a>'}else{if(e[c].stopTime<a){g.innerHTML="已结束";g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:showUserTopic('+e[c].id+',2)">详情</a>'}}}f=b.insertRow(b.rows.length);f.className="td_int";f.style.display="none";f.id="topic_"+e[c].id;g=f.insertCell(f.cells.length);g.colSpan=12;g.innerHTML='<div class="right_em_con"><table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>序号</td><td>手机号</td><td>openID</td><td>投票</td><td>注数</td><td>状态</td><td>投票时间</td></tr><tbody id="res_'+e[c].id+'"></tbody></table><div class="main_page" id="pri_'+e[c].id+'">&nbsp;</div><div class="goto_back"><a href= "javascript:hideLottery0('+e[c].id+')">收回</a></div></div>'}}}}function addTopic(){$(".team_title").html("新建话题");$("#topicSearch").hide();$("#topicAdd").show()}function modifyTopic(a){$(".team_title").html("修改话题");$("#pic").html("<img width='100px' src='"+$("#img"+a).attr("src")+"'/>");$("#title").val($("#title"+a).html());$("#positive").val($("#positive"+a).html());$("#negative").val($("#negative"+a).html());$("#point").val($("#point"+a).html());$("#startTime").val($("#startTime"+a).html());$("#stopTime").val($("#stopTime"+a).html());$("#id").val(a);$("#topicSearch").hide();$("#topicAdd").show()}function deleteTopic(a){showLoading();$.ajax({type:"post",url:getPath()+"/manage/topic/delete.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){hideLoading();if(b.s==200){alert("操作成功！");cancelTopic()}else{alert(b.r)}}})}function saveTopic(){var h=$("#pic img").attr("src");if(!h){alert("请上传图片");return}h=encodeURIComponent(h);var k=document.getElementById("title").value;var g=document.getElementById("positive").value;var e=document.getElementById("negative").value;var l=document.getElementById("point").value;var d=document.getElementById("startTime").value;var c=document.getElementById("stopTime").value;showLoading();var b=$("#id").val();var f={pic:h,title:k,positive:g,negative:e,point:l,startTime:d,stopTime:c,id:b};var a=getPath()+"/manage/topic/add.do";if(b){a=getPath()+"/manage/topic/update.do"}$.ajax({type:"post",url:a,data:f,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(m){hideLoading();if(m.s==200){alert("操作成功！");cancelTopic()}else{alert(m.r)}}})}function showUserTopic(a){$("#topicId").val(a);showUserTopicByPage(0)}function showUserTopicByPage(a){var b=$("#topicId").val();showLoading();$.ajax({type:"post",url:getPath()+"/manage/topic/user/bet.do",data:"tid="+b+"&m="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){hideLoading();showUserTopicByPageCallback(c)}})}function showUserTopicByPageCallback(c){var e,g,b;var f=$("#topicId").val();var a=document.getElementById("res_"+f);document.getElementById("topic_"+f).style.display="";while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"showUserTopicByPage",0);e=a.insertRow(a.rows.length);g=e.insertCell(e.cells.length);g.colSpan=6;g.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"showUserTopicByPage",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";g=e.insertCell(e.cells.length);g.innerHTML=c.s+b+1;g=e.insertCell(e.cells.length);g.innerHTML=d[b].mobile;g=e.insertCell(e.cells.length);g.innerHTML=d[b].openId;g=e.insertCell(e.cells.length);g.innerHTML=d[b].support==1?"同意":"反对";g=e.insertCell(e.cells.length);g.innerHTML=d[b].bet;g=e.insertCell(e.cells.length);g.innerHTML=d[b].bonus==-1?"暂无结果":(d[b].bonus>0?"押中":"未押中");g=e.insertCell(e.cells.length);g.innerHTML=formatDate(d[b].createTime)}}}}function searchAllBetActivityGroupList(){$.ajax({type:"POST",url:getPath()+"/bet/activity/group.do",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d.s!=200){return}if(d.r.length>0){var c="<option value='-1'>全部</option>";for(var b=0;b<d.r.length;b++){var a=d.r[b];c+="<option value='"+a.id+"'>"+a.name+"</option>"}$("#group").html(c)}},})}function searchBetActivityUserList(e){e=e/8;document.getElementById("res").innerHTML="";var d=document.getElementById("group").value;var c=document.getElementById("startTime").value;var a=document.getElementById("endTime").value;var b=document.getElementById("mobile").value;$.ajax({type:"POST",url:getPath()+"/bet/activity/user.do?",data:"gid="+d+"&startTime="+c+"&endTime="+a+"&mobile="+b+"&page="+e,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(p){if(p.s!=200){document.getElementById("res").innerHTML+="<tr><td colspan=7>"+p.r+"</td></tr>";drawPages(p.c,"searchBetActivityUserList",e*8);return}if(p.r.length>0){drawPages(p.c,"searchBetActivityUserList",e*8);var o="";var k=new Date().getTime();for(var n=0;n<p.r.length;n++){var g=p.r[n];o+="<tr>";o+="<td>";o+=e*8+n+1;o+="</td>";o+="<td>";o+=p.t;o+="</td>";o+="<td>";o+=g.matchType==0?"足球":"篮球";o+="</td>";o+="<td>";o+=formatDateNoTime(g.activityTime);o+="</td>";o+="<td>";o+=g.mobile;o+="</td>";if(!g.list||g.list.length<=0){o+="<td>暂无信息</td>"}else{o+="<td>";o+="<table cellpadding='0' cellspacing='0' class='main_table ww_100'>";o+="<tr class='table_title'><td>日期</td><td>联赛</td><td>主队</td><td>客队</td><td>半场</td><td>比分</td><td>投注</td><td>彩果</td></tr>";for(var f in g.list){o+="<tr>";var h=g.list[f];o+="<td>";o+=h.alias;o+="</td>";o+="<td>";o+=h.league;o+="</td>";o+="<td>";o+=h.home;o+="</td>";o+="<td>";o+=h.guest;o+="</td>";if(h.hhs==-1||h.ghs==-1){o+="<td>暂无</td>"}else{o+="<td>";o+=h.hhs+":"+h.ghs;o+="</td>"}if(h.hfs==-1||h.gfs==-1){o+="<td>暂无</td>"}else{o+="<td>";o+=h.hfs+":"+h.gfs;o+="</td>"}o+="<td>";for(var l in h.bet[0].odds){o+=h.bet[0].odds[l]}o+="</td>";o+="<td>";if("-2"==h.betResult){o+="暂无彩果"}else{o+=h.betResult}o+="</td>";o+="</tr>"}o+="</table>";o+="</td>"}o+="<td>";if(g.bonus==-1){o+="未开奖"}else{if(g.bonus==0){o+="未中奖"}else{o+=g.bonus}}o+="</td>";o+="</tr>"}$("#res").html(o)}else{document.getElementById("res").innerHTML+="<tr><td colspan=4>"+p.r+"</td></tr>";drawPages(p.c,"searchBetActivityUserList",e*8);return}},})}function searchBetActivityGroupList(a){a=a/8;document.getElementById("res").innerHTML="";state=document.getElementById("status").value;$.ajax({type:"POST",url:getPath()+"/bet/activity/group.do?",data:"status="+state+"&page="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f.s!=200){document.getElementById("res").innerHTML+="<tr><td colspan=4>"+f.r+"</td></tr>";drawPages(f.c,"searchBetActivityGroupList",a*8);return}state=document.getElementById("status").value;if(f.r.length>0){drawPages(f.c,"searchBetActivityGroupList",a*8);var e="";var c=new Date().getTime();for(var d=0;d<f.r.length;d++){var b=f.r[d];e+="<tr>";e+="<td>";e+=b.name;e+="</td>";e+="<td>";e+=formatDate(b.start_time);e+="</td>";e+="<td>";e+=formatDate(b.stop_time);e+="</td>";e+="<td>";e+=formatDate(b.create_time);e+="</td>";e+="<td>";var g=getPath()+"/html/betActivity.html?gid="+b.id;if(b.start_time<c&&b.stop_time>c){e+="进行中 <a href="+g+">查看活动</a>"}else{if(b.stop_time<c){e+="已结束"}else{e+="未开始 <a href= 'javascript:modifyBetMatchGroup("+b.id+")'>修改活动组</a> <a href="+g+">查看活动</a>"}}e+="</td>";e+="</tr>"}$("#res").html(e)}else{document.getElementById("res").innerHTML+="<tr><td colspan=4>"+f.r+"</td></tr>";drawPages(f.c,"searchBetActivityGroupList",a*8);return}},})}function searchBetActivityList(a){a=a/8;document.getElementById("res").innerHTML="";state=document.getElementById("status").value;$.ajax({type:"POST",url:getPath()+"/bet/activity/list.do?",data:"status="+state+"&page="+a+"&gid="+gid,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f.s!=200){document.getElementById("res").innerHTML+="<tr><td colspan=4>"+f.r+"</td></tr>";drawPages(f.c,"searchBetActivityList",a*8);return}state=document.getElementById("status").value;if(f.r.length>0){drawPages(f.c,"searchBetActivityList",a*8);var e="";var c=new Date().getTime();for(var d=0;d<f.r.length;d++){var b=f.r[d];e+="<tr>";e+="<td>";e+=b.type==0?"足球":"篮球";e+="</td>";e+="<td>";e+=formatDate(b.start_time);e+="</td>";e+="<td>";e+=formatDate(b.stop_time);e+="</td>";e+="<td>";e+=formatDate(b.create_time);e+="</td>";e+="<td>";e+=b.times;e+="</td>";e+="<td>";if(b.start_time<c&&b.stop_time>c){e+="进行中 <a href= 'javascript:queryBetMatch("+b.id+")'>查看赛事</a>"}else{if(b.stop_time<c){e+="已结束 <a href= 'javascript:queryBetMatch("+b.id+")'>查看赛事</a>"}else{e+="未开始 <a href= 'javascript:queryBetMatch("+b.id+")'>查看赛事</a> <a href= 'javascript:deleteBetMatch("+b.id+")'>删除活动</a>"}}e+="</td>";e+="</tr>";e+="<tr id='activity_"+b.id+"' style='display:none'>";e+="<td colspan=6>";e+='<table cellpadding="0" cellspacing="0" class="main_table ww_100"><tr class="table_title"><td>赛事编号</td><td>别名</td><td>联赛名称</td>'+(b.type==0?"<td>主队</td><td>客队</td>":"<td>客队</td><td>主队</td>")+'<td>比赛时间</td><td>上半场比分</td><td>总比分</td></tr><tbody id="res_'+b.id+'"></tbody></table>';e+="</td>";e+="</tr>"}$("#res").html(e)}else{document.getElementById("res").innerHTML+="<tr><td colspan=4>"+f.r+"</td></tr>";drawPages(f.c,"searchBetActivityList",a*8);return}},})}function submitBetMatchGroup(){var c=document.getElementById("salestartTime").value;var a=document.getElementById("saleendTime").value;var b=document.getElementById("name").value;if(c==""||a==""||b==""){alert("活动信息不能为空")}else{$.ajax({type:"POST",url:getPath()+"/bet/activity/group/update.do",async:false,data:"start="+c+"&stop="+a+"&name="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){if(d.s==200){alert("创建成功");window.location.reload()}else{alert(d.r)}},})}}function modifyBetMatchGroup(a){$("#main").hide();$("#modify").show();$.ajax({type:"POST",url:getPath()+"/bet/activity/group.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.s==200&&b.r.length==1){$("#mid").val(b.r[0].id);$("#mname").val(b.r[0].name);$("#msalestartTime").val(formatDate(b.r[0].start_time));$("#msaleendTime").val(formatDate(b.r[0].stop_time))}else{alert(b.r)}}})}function submitModifyBetMatchGroup(){var c=document.getElementById("msalestartTime").value;var a=document.getElementById("msaleendTime").value;var b=document.getElementById("mname").value;var d=document.getElementById("mid").value;$.ajax({type:"POST",url:getPath()+"/bet/activity/group/update.do",async:false,data:"id="+d+"&start="+c+"&stop="+a+"&name="+b,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e.s==200){alert("修改成功");window.location.reload()}else{alert(e.r)}}})}function submitBetActivity(c){if(c==0){var b=document.getElementById("salestartTime").value;var a=document.getElementById("saleendTime").value;var e=document.getElementById("times").value}else{var b=document.getElementById("salestartTime2").value;var a=document.getElementById("saleendTime2").value;var e=document.getElementById("times2").value}var d="";$("input:checkbox:checked").each(function(){d+=$(this).attr("name")+","+$(this).val()+";"});if(b==""||a==""||d==""){alert("活动信息不能为空")}else{$.ajax({type:"POST",url:getPath()+"/bet/activity/update.do",async:false,data:"times="+e+"&type="+c+"&start="+b+"&stop="+a+"&gid="+gid+"&m="+d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f.s==200){alert("创建成功");window.location.reload()}else{alert(f.r)}},})}}function deleteBetMatch(a){if(!confirm("确定要删除该活动？")){return}$.ajax({type:"POST",url:getPath()+"/bet/activity/delete.do",async:false,data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.s==331){alert("删除成功");window.location.reload()}else{alert(b.r)}},})}function queryBetMatch(a){$.ajax({type:"POST",url:getPath()+"/bet/activity/query.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(n){var p="";if(n.s==200){if(n.r.length>0){for(var o in n.r){var h=n.r[o];for(var l in h.list){var f=h.list[l];p+="<tr>";p+="<td>";p+=f.mid;p+="</td>";p+="<td>";p+=f.alias;p+="</td>";p+="<td>";p+=f.league;p+="</td>";p+="<td>";p+=f.home;p+="</td>";p+="<td>";p+=f.guest;p+="</td>";p+="<td>";p+=f.matchTime;p+="</td>";p+="<td>";if(f.hhs==-1||f.ghs==-1){p+="暂无"}else{p+=f.hhs+":"+f.ghs}p+="</td>";p+="<td>";if(f.hfs==-1||f.gfs==-1){p+="暂无"}else{p+=f.hfs+":"+f.gfs}p+="</td>";p+="</tr>";p+="<tr><td colspan=8><table cellpadding='0' cellspacing='0' class='main_table ww_100'><tr><td>玩法</td><td>赔率</td></tr>";if(f.bet.length>0){var e="";var c="";var b="";var v="";var u="";var t="";var s="";var r="";var q="";for(var g in f.bet){var d=f.bet[g];if(d.type==1){e+="<tr>";e+="<td>";e+="胜平负";e+="</td>";e+="<td>";e+="胜("+d.odds.r3+") 平("+d.odds.r1+") 负("+d.odds.r0+")";e+="</td>";e+="</tr>"}else{if(d.type==2){c+="<tr>";c+="<td>";c+="让("+d.let+")球胜平负";c+="</td>";c+="<td>";c+="胜("+d.odds.r3+") 平("+d.odds.r1+") 负("+d.odds.r0+")";c+="</td>";c+="</tr>"}else{if(d.type==3){b+="<tr>";b+="<td>";b+="总进球";b+="</td>";b+="<td>";b+="0("+d.odds.s0+") 1("+d.odds.s1+") 2("+d.odds.s2+")3("+d.odds.s3+") 4("+d.odds.s4+") 5("+d.odds.s5+")6("+d.odds.s7+") 7("+d.odds.s7+")";b+="</td>";b+="</tr>"}else{if(d.type==4){v+="<tr>";v+="<td>";v+="比分";v+="</td>";v+="<td>";v+="1:0("+d.odds.s1_0+") ";v+="2:0("+d.odds.s2_0+") ";v+="2:1("+d.odds.s2_1+") ";v+="3:0("+d.odds.s3_0+") ";v+="3:1("+d.odds.s3_1+") ";v+="3:2("+d.odds.s3_2+") ";v+="4:0("+d.odds.s4_0+")<br>";v+="4:1("+d.odds.s4_1+") ";v+="4:2("+d.odds.s4_2+") ";v+="5:0("+d.odds.s5_0+") ";v+="5:1("+d.odds.s5_1+") ";v+="5:2("+d.odds.s5_2+") ";v+="胜其他("+d.odds.s+")<br>";v+="0:0("+d.odds.s0_0+") ";v+="1:1("+d.odds.s1_1+") ";v+="2:2("+d.odds.s2_2+") ";v+="3:3("+d.odds.s3_3+") ";v+="平其他("+d.odds.p+")<br>";v+="0:1("+d.odds.s0_1+") ";v+="0:2("+d.odds.s0_2+") ";v+="1:2("+d.odds.s1_2+") ";v+="0:3("+d.odds.s0_3+") ";v+="1:3("+d.odds.s1_3+") ";v+="2:3("+d.odds.s2_3+") ";v+="0:4("+d.odds.s0_4+")<br>";v+="1:4("+d.odds.s1_4+") ";v+="2:4("+d.odds.s2_4+") ";v+="0:5("+d.odds.s0_5+") ";v+="1:5("+d.odds.s1_5+") ";v+="2:5("+d.odds.s2_5+") ";v+="负其他("+d.odds.f+")";v+="</td>";v+="</tr>"}else{if(d.type==5){u+="<tr>";u+="<td>";u+="半全场";u+="</td>";u+="<td>";u+="胜胜("+d.odds.r33+") 胜平("+d.odds.r31+") 胜负("+d.odds.r30+")<br>平胜("+d.odds.r13+") 平平("+d.odds.r11+") 平负("+d.odds.r10+")<br>负胜("+d.odds.r03+") 负平("+d.odds.r01+") 负负("+d.odds.r00+")<br>";u+="</td>";u+="</tr>"}else{if(d.type==11){t+="<tr>";t+="<td>";t+="胜负";t+="</td>";t+="<td>";t+="主负("+d.odds.r0+") 主胜("+d.odds.r3+")";t+="</td>";t+="</tr>"}else{if(d.type==12){s+="<tr>";s+="<td>";s+="让("+d.let+")分胜负";s+="</td>";s+="<td>";s+="主负("+d.odds.r0+") 主胜("+d.odds.r3+")";s+="</td>";s+="</tr>"}else{if(d.type==13){r+="<tr>";r+="<td>";r+="胜分差";r+="</td>";r+="<td>";r+="客胜: 1-5("+d.odds.r1_5_k+") 6-10("+d.odds.r6_10_k+") 11-15("+d.odds.r11_15_k+") 16-20("+d.odds.r16_20_k+") 21-25("+d.odds.r21_25_k+") 26+("+d.odds.r26_k+")<br>主胜: 1-5("+d.odds.r1_5_z+") 6-10("+d.odds.r6_10_z+") 11-15("+d.odds.r11_15_z+") 16-20("+d.odds.r16_20_z+") 21-25("+d.odds.r21_25_z+") 26+("+d.odds.r26_z+")<br>";r+="</td>";r+="</tr>"}else{if(d.type==14){q+="<tr>";q+="<td>";q+="大小分";q+="</td>";q+="<td>";q+="大分("+d.odds.big+") 小分("+d.odds.small+")";q+="</td>";q+="</tr>"}}}}}}}}}}p+=e+c+b+v+u+t+s+r+q}else{p+="<tr><td colspan=3>暂无赔率信息</td></tr>"}p+="</table><td></tr>"}}}else{p="<tr><td colspan=5>暂无赛事数据</td></tr>"}}else{p="<tr><td colspan=5>"+n.r+"</td></tr>"}$("#res_"+a).html(p);$("#activity_"+a).show()}})}function addBetMatch(a){$("#main").hide();if(a==0){$("#addBetMatch").show()}else{$("#addBasketballMatch").show()}$.ajax({type:"POST",url:getPath()+"/bet/activity/search.do",data:"matchType="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(n){var p="";if(n.s==200){if(n.r.length>0){for(var o in n.r){var h=n.r[o];for(var l in h.list){var f=h.list[l];p+="<tr>";p+="<td>";p+=f.mid;p+="</td>";p+="<td>";p+=f.alias;p+="</td>";p+="<td>";p+=f.league;p+="</td>";p+="<td>";p+=f.guest;p+="</td>";p+="<td>";p+=f.home;p+="</td>";p+="<td>";p+=f.matchTime;p+="</td>";p+="</tr>";p+="<tr><td colspan=6><table cellpadding='0' cellspacing='0' class='main_table ww_100'><tr><td>筛选</td><td>玩法</td><td>赔率</td></tr>";if(f.bet.length>0){var e="";var c="";var b="";var v="";var u="";var t="";var s="";var r="";var q="";for(var g in f.bet){var d=f.bet[g];if(d.type==1){e+="<tr>";e+="<td>";e+="<input type='checkbox' name='"+f.mid+"' value='1'>";e+="</td>";e+="<td>";e+="胜平负";e+="</td>";e+="<td>";e+="胜("+d.odds.r3+") 平("+d.odds.r1+") 负("+d.odds.r0+")";e+="</td>";e+="</tr>"}else{if(d.type==2){c+="<tr>";c+="<td>";c+="<input type='checkbox' name='"+f.mid+"' value='2'>";c+="</td>";c+="<td>";c+="让("+d.let+")球胜平负";c+="</td>";c+="<td>";c+="胜("+d.odds.r3+") 平("+d.odds.r1+") 负("+d.odds.r0+")";c+="</td>";c+="</tr>"}else{if(d.type==3){b+="<tr>";b+="<td>";b+="<input type='checkbox' name='"+f.mid+"' value='3'>";b+="</td>";b+="<td>";b+="总进球";b+="</td>";b+="<td>";b+="0("+d.odds.s0+") 1("+d.odds.s1+") 2("+d.odds.s2+")3("+d.odds.s3+") 4("+d.odds.s4+") 5("+d.odds.s5+")6("+d.odds.s7+") 7+("+d.odds.s7+")";b+="</td>";b+="</tr>"}else{if(d.type==4){v+="<tr>";v+="<td>";v+="<input type='checkbox' name='"+f.mid+"' value='4'>";v+="</td>";v+="<td>";v+="比分";v+="</td>";v+="<td>";v+="1:0("+d.odds.s1_0+") ";v+="2:0("+d.odds.s2_0+") ";v+="2:1("+d.odds.s2_1+") ";v+="3:0("+d.odds.s3_0+") ";v+="3:1("+d.odds.s3_1+") ";v+="3:2("+d.odds.s3_2+") ";v+="4:0("+d.odds.s4_0+")<br>";v+="4:1("+d.odds.s4_1+") ";v+="4:2("+d.odds.s4_2+") ";v+="5:0("+d.odds.s5_0+") ";v+="5:1("+d.odds.s5_1+") ";v+="5:2("+d.odds.s5_2+") ";v+="胜其他("+d.odds.s+")<br>";v+="0:0("+d.odds.s0_0+") ";v+="1:1("+d.odds.s1_1+") ";v+="2:2("+d.odds.s2_2+") ";v+="3:3("+d.odds.s3_3+") ";v+="平其他("+d.odds.p+")<br>";v+="0:1("+d.odds.s0_1+") ";v+="0:2("+d.odds.s0_2+") ";v+="1:2("+d.odds.s1_2+") ";v+="0:3("+d.odds.s0_3+") ";v+="1:3("+d.odds.s1_3+") ";v+="2:3("+d.odds.s2_3+") ";v+="0:4("+d.odds.s0_4+")<br>";v+="1:4("+d.odds.s1_4+") ";v+="2:4("+d.odds.s2_4+") ";v+="0:5("+d.odds.s0_5+") ";v+="1:5("+d.odds.s1_5+") ";v+="2:5("+d.odds.s2_5+") ";v+="负其他("+d.odds.f+")";v+="</td>";v+="</tr>"}else{if(d.type==5){u+="<tr>";u+="<td>";u+="<input type='checkbox' name='"+f.mid+"' value='5'>";u+="</td>";u+="<td>";u+="半全场";u+="</td>";u+="<td>";u+="胜胜("+d.odds.r33+") 胜平("+d.odds.r31+") 胜负("+d.odds.r30+")<br>平胜("+d.odds.r13+") 平平("+d.odds.r11+") 平负("+d.odds.r10+")<br>负胜("+d.odds.r03+") 负平("+d.odds.r01+") 负负("+d.odds.r00+")<br>";u+="</td>";u+="</tr>"}else{if(d.type==11){t+="<tr>";t+="<td>";t+="<input type='checkbox' name='"+f.mid+"' value='11'>";t+="</td>";t+="<td>";t+="胜负";t+="</td>";t+="<td>";t+="主负("+d.odds.r0+") 主胜("+d.odds.r3+")";t+="</td>";t+="</tr>"}else{if(d.type==12){s+="<tr>";s+="<td>";s+="<input type='checkbox' name='"+f.mid+"' value='12'>";s+="</td>";s+="<td>";s+="让("+d.let+")分胜负";s+="</td>";s+="<td>";s+="主负("+d.odds.r0+") 主胜("+d.odds.r3+")";s+="</td>";s+="</tr>"}else{if(d.type==13){r+="<tr>";r+="<td>";r+="<input type='checkbox' name='"+f.mid+"' value='13'>";r+="</td>";r+="<td>";r+="胜分差";r+="</td>";r+="<td>";r+="客胜: 1-5("+d.odds.r1_5_k+") 6-10("+d.odds.r6_10_k+") 11-15("+d.odds.r11_15_k+") 16-20("+d.odds.r16_20_k+") 21-25("+d.odds.r21_25_k+") 26+("+d.odds.r26_k+")<br>主胜: 1-5("+d.odds.r1_5_z+") 6-10("+d.odds.r6_10_z+") 11-15("+d.odds.r11_15_z+") 16-20("+d.odds.r16_20_z+") 21-25("+d.odds.r21_25_z+") 26+("+d.odds.r26_z+")<br>";r+="</td>";r+="</tr>"}else{if(d.type==14){q+="<tr>";q+="<td>";q+="<input type='checkbox' name='"+f.mid+"' value='14'>";q+="</td>";q+="<td>";q+="大小分";q+="</td>";q+="<td>";q+="大分("+d.odds.big+") 小分("+d.odds.small+")";q+="</td>";q+="</tr>"}}}}}}}}}}p+=e+c+b+v+u+t+s+r+q}else{p+="<tr><td colspan=3>暂无赔率信息</td></tr>"}p+="</table><td></tr>"}}}else{p="<tr><td colspan=5>暂无赛事数据</td></tr>"}}else{p="<tr><td colspan=5>"+n.r+"</td></tr>"}if(a==0){$("#matchbody").html(p)}else{$("#matchbody2").html(p)}}})}function searchSlogan(a){showRunning(7);$.ajax({type:"post",url:getPath()+"/activity/searchActivity.do",data:"startIdx="+a+"&type=20",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchSloganCallback(b)}})}function searchSloganCallback(d){var f,g,c;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchSlogan",0);f=b.insertRow(b.rows.length);g=f.insertCell(f.cells.length);g.colSpan=6;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchSlogan",d.s);var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=b.insertRow(b.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=e[c].id;g=f.insertCell(f.cells.length);g.innerHTML=e[c].name;g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].startTime);g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].endTime);g=f.insertCell(f.cells.length);var a=Date.parse(new Date());if(e[c].startTime>a){g.innerHTML="未开始"}else{if(e[c].startTime<=a&&e[c].endTime>=a){g.innerHTML="进行中"}else{if(e[c].endTime<a){g.innerHTML="已结束"}}}g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:sloganQueryPage('+e[c].id+')">口号详情</a>'}}}}function searchSloganSeed(a){showRunning(6);$.ajax({type:"post",url:getPath()+"/activity/searchActivity.do",data:"startIdx="+a+"&type=30",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchSloganSeedCallback(b)}})}function searchSloganSeedCallback(d){var f,g,c;var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(d==null||!(d.r instanceof Array)||d.r.length<1){drawPages(0,"searchSloganSeed",0);f=b.insertRow(b.rows.length);g=f.insertCell(f.cells.length);g.colSpan=6;g.innerHTML=noRecord;f.style.height="200px"}else{drawPages(d.c,"searchSloganSeed",d.s);var e=d.r;for(c=0;c<e.length;c++){if(e[c]!=null){f=b.insertRow(b.rows.length);f.className="td_int";g=f.insertCell(f.cells.length);g.innerHTML=e[c].id;g=f.insertCell(f.cells.length);g.innerHTML=e[c].name;g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].startTime);g=f.insertCell(f.cells.length);g.innerHTML=formatDate(e[c].endTime);g=f.insertCell(f.cells.length);var a=Date.parse(new Date());if(e[c].startTime>a){g.innerHTML="未开始"}else{if(e[c].startTime<=a&&e[c].endTime>=a){g.innerHTML="进行中"}else{if(e[c].endTime<a){g.innerHTML="已结束"}}}g=f.insertCell(f.cells.length);g.innerHTML='<a href= "javascript:sloganSeedQueryPage('+e[c].id+')">详情</a>'}}}}function sloganQueryPage(a){window.location=getPath()+"/html/sloganQuery.html?aid="+a}function sloganSeedQueryPage(a){window.location=getPath()+"/html/sloganSeedQuery.html?aid="+a}function saveSlogan(){var d=document.getElementById("title").value;var a=document.getElementById("beginTime").value;var b=document.getElementById("endTime").value;if(d==""){alert("请输入活动名称！");return}if(a==""){alert("请选择开始时间！");return}if(b==""){alert("请选择结束时间！");return}var c="title="+d+"&beginTime="+a+"&endTime="+b+"&param1=10&type=20";$.ajax({type:"post",url:getPath()+"/activity/saveSlogan.do",data:c,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e){if(e.r=="duplicateTime"){alert("活动时间重复！");return}if(e.r=="ok"){alert("操作成功！");window.location=getPath()+"/html/sloganManage.html"}}}})}function saveSloganSeed(){var e=$("#name").html()+"投票";var b=document.getElementById("time1").value;var c=document.getElementById("time2").value;if(e==""){alert("请输入活动名称！");return}if(b==""){alert("请选择开始时间！");return}if(c==""){alert("请选择结束时间！");return}var a="";$("#seedTable tbody tr").each(function(f){var g=$(this).attr("id");g=g.substring(0,g.length-2);a+=g+","});var d="title="+e+"&beginTime="+b+"&endTime="+c+"&param1=10&type=30&sl="+a;$.ajax({type:"post",url:getPath()+"/activity/saveSloganSeed.do",data:d,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(f){if(f){if(f.r=="duplicateTime"){alert("活动时间重复！");return}if(f.r=="ok"){alert("操作成功！");window.location=getPath()+"/html/sloganSeedManage.html"}}}})}function searchSloganById(){var a=getQueryString("aid");if(!a){alert("参数错误");return}showRunning(7);$.ajax({type:"post",url:getPath()+"/activity/searchActivity.do",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}var d=c.r[0];$("#name").html(d.name);$("#startTime").html(formatDate(d.startTime));$("#endTime").html(formatDate(d.endTime));if(isSeed){searchSloganSeedList()}}})}function searchSloganList(h){var c=getQueryString("aid");if(!c){alert("参数错误");return}var a=$("#startTime").val();var e=$("#endTime").val();var g=$("#phone").val();var k=$("#slogan").val();var d=$("#order1:checked").length;var b=$("#order2:checked").length;var f={aid:c,page:h};if(g){g=$.trim(g);if(g.length>0&&!/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/.test(g)){alert("请输入正确的手机号");return}f.phone=g}if(a){f.start=a}if(e){f.end=e}if(k){f.slogan=k}if(d>0){f.orderby=1}else{if(b>0){f.orderby=2}}showRunning(7);$.ajax({type:"post",url:getPath()+"/manage/slogan/search.do",data:f,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(m){var l=document.getElementById("res");while(l.rows.length>0){l.removeChild(l.firstChild)}if(m==null||!(m.r instanceof Array)||m.r.length<1){drawPages(0,"searchSloganList",0);tr=l.insertRow(l.rows.length);td=tr.insertCell(tr.cells.length);td.colSpan=7;td.innerHTML=noRecord;tr.style.height="200px"}else{drawPages(m.c,"searchSloganList",m.s);var n=m.r;for(i=0;i<n.length;i++){if(n[i]!=null){tr=l.insertRow(l.rows.length);tr.className="td_int";td=tr.insertCell(tr.cells.length);td.innerHTML=i+1+h;td=tr.insertCell(tr.cells.length);td.id=n[i].id+"name";td.innerHTML=n[i].userName;td=tr.insertCell(tr.cells.length);td.id=n[i].id+"phone";if(n[i].phone){td.innerHTML=n[i].phone}else{td.innerHTML=""}td=tr.insertCell(tr.cells.length);td.id=n[i].id+"slogan";td.innerHTML=n[i].slogan;td=tr.insertCell(tr.cells.length);td.id=n[i].id+"time";td.innerHTML=formatDate(n[i].createTime);td=tr.insertCell(tr.cells.length);td.innerHTML="<input id='"+n[i].id+"trbox' type='checkbox' onclick='selectVoteSeed(this.checked,"+n[i].id+")'>"}}checkVoteSeed()}}})}function searchSloganSeedList(){var a=getQueryString("aid");if(!a){alert("参数错误");return}showRunning(10);$.ajax({type:"post",url:getPath()+"/manage/slogan/searchSeed.do",data:{aid:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){var b=document.getElementById("res");while(b.rows.length>0){b.removeChild(b.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){tr=b.insertRow(b.rows.length);td=tr.insertCell(tr.cells.length);td.colSpan=10;td.innerHTML=noRecord;tr.style.height="200px"}else{var d=c.r;for(i=0;i<d.length;i++){if(d[i]!=null){tr=b.insertRow(b.rows.length);tr.className="td_int";td=tr.insertCell(tr.cells.length);td.innerHTML=i+1;td=tr.insertCell(tr.cells.length);td.id=d[i].id+"name";td.innerHTML=d[i].userName;td=tr.insertCell(tr.cells.length);td.id=d[i].id+"phone";if(d[i].phone){td.innerHTML=d[i].phone}else{td.innerHTML=""}td=tr.insertCell(tr.cells.length);td.id=d[i].id+"slogan";td.innerHTML=d[i].slogan;td=tr.insertCell(tr.cells.length);td.id=d[i].id+"time";td.innerHTML=formatDate(d[i].createTime);td=tr.insertCell(tr.cells.length);td.innerHTML=d[i].count;td=tr.insertCell(tr.cells.length);td.innerHTML=d[i].rank;td=tr.insertCell(tr.cells.length);if(d[i].realName){td.innerHTML=d[i].realName}else{td.innerHTML=""}td=tr.insertCell(tr.cells.length);if(d[i].idnum){td.innerHTML=d[i].idnum}else{td.innerHTML=""}td=tr.insertCell(tr.cells.length);if(d[i].bank){td.innerHTML=d[i].bank}else{td.innerHTML=""}td=tr.insertCell(tr.cells.length);if(d[i].bankNo){td.innerHTML=d[i].bankNo}else{td.innerHTML=""}}}}}})}function selectVoteSeed(f,b){if(f){var c=$("#"+b+"name").html();var a=$("#"+b+"phone").html();var d=$("#"+b+"slogan").html();var g=$("#"+b+"time").html();var h="<tr id='"+b+"tr'><td contentEditable=true></td><td>"+c+"</td><td>"+a+"</td><td>"+d+"</td><td>"+g+"</td></tr>";$("#seedTable tbody").append(h)}else{$("#"+b+"tr").remove()}var e=0;$("#seedTable tbody tr").each(function(k){$(this).find("td:first").html(k+1);++e});if(e==0){$("#seedTable").hide();$("#seedTableDiv").hide()}else{$("#seedTable").show();$("#seedTableDiv").show()}}function saveSortSeedTable(){var a=new Array();$("#seedTable tbody tr").each(function(){var e=$(this).find("td:first");var d=Number(e.html());while(a[d]){++d}a[d]="<tr id='"+$(this).attr("id")+"'>"+$(this).html()+"</tr>"});var c="";for(var b in a){c+=a[b]}$("#seedTable tbody").html(c);calcelSortSeedTable()}function calcelSortSeedTable(){$("#seedTable tbody tr").each(function(a){var b=$(this).find("td:first");b.html(a+1)})}function checkVoteSeed(){$("#seedTable tbody tr").each(function(a){$("#"+$(this).attr("id")+"box").attr("checked","checked")})}function exportSlogan(){var f=getQueryString("aid");if(!f){alert("参数错误");return}var h=$("#startTime").val();var b=$("#endTime").val();var a=$("#phone").val();var e=$("#slogan").val();var d=$("#order1:checked").length;var c=$("#order2:checked").length;var g="aid="+f;if(h){g+="&start="+h}if(b){g+="&end="+b}if(a){g+="&phone="+a}if(e){g+="&slogan="+e}if(d>0){g+="&orderby=1"}else{if(c>0){g+="&orderby=2"}}location.href=getPath()+"/manage/slogan/download.do?"+g}function searchQuizDB(a){var b=document.getElementById("quizCate").value;showRunning(5);$.ajax({type:"post",url:getPath()+"/quiz/query.do",data:"cate="+b+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){searchQuizDBCallback(c)}})}function searchQuizDBCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchQuizDB",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=6;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"searchQuizDB",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=c.s+b+1;f=e.insertCell(e.cells.length);f.innerHTML=d[b].title;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].createTime);f=e.insertCell(e.cells.length);f.innerHTML="<a href= 'javascript:showQuizDBQuestion("+d[b].id+")'>详情</a>&nbsp;&nbsp;<a href= 'javascript:deleteQuizDB("+d[b].id+")'>删除</a>"}}}}function deleteQuizDB(a){if(!confirm("确认删除？")){return}$.ajax({type:"POST",url:getPath()+"/quiz/delete.do",async:false,data:{id:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.s==200){window.location=getPath()+"/html/quizDBSearch.html?action=search";return}else{alert(b.r)}},})}function showQuizDBQuestion(a){window.location=getPath()+"/html/quizDBQuestionSearch.html?id="+a}function searchQuizDBQuestion(a){var b=getQueryString("id");showRunning(8);$.ajax({type:"post",url:getPath()+"/quiz/item/query.do",data:"id="+b+"&startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){searchQuizDBQuestionCallback(c)}})}function searchQuizDBQuestionCallback(b){var k,c,e;var f=document.getElementById("res");while(f.rows.length>0){f.removeChild(f.firstChild)}if(b==null||!(b.r instanceof Array)||b.r.length<1){drawPages(0,"searchQuizDBQuestion",0);k=f.insertRow(f.rows.length);c=k.insertCell(k.cells.length);c.colSpan=8;c.innerHTML=noRecord;k.style.height="200px"}else{drawPages(b.c,"searchQuizDBQuestion",b.s);var d=b.r;for(e=0;e<d.length;e++){if(d[e]!=null){k=f.insertRow(f.rows.length);k.className="td_int";c=k.insertCell(k.cells.length);c.innerHTML=b.s+e+1;c=k.insertCell(k.cells.length);c.innerHTML=d[e].text;var g=d[e].options.split(";");for(var h in g){var a=g[h];c=k.insertCell(k.cells.length);c.innerHTML=a}if(g.length!=4){c=k.insertCell(k.cells.length);c.innerHTML=""}c=k.insertCell(k.cells.length);c.innerHTML=d[e].answer;c=k.insertCell(k.cells.length);c.innerHTML="<a href= 'javascript:editQuizDBItem("+d[e].id+")'>编辑</a>&nbsp;&nbsp;<a href= 'javascript:deleteQuizDBItem("+d[e].id+")'>删除</a>"}}}}function deleteQuizDBItem(a){if(!confirm("确认删除？")){return}$.ajax({type:"POST",url:getPath()+"/quiz/item/delete.do",async:false,data:{id:a},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){if(b.s==200){window.location=getPath()+"/html/quizDBQuestionSearch.html?id="+getQueryString("id");return}else{alert(b.r)}},})}function editQuizDBItem(a){$.ajax({type:"post",url:getPath()+"/quiz/item/query.do",data:"itemId="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){if(e.s!=0){alert(e.r);return}var d=e.r;if(d!=null&&d.length>0){for(var c=0;c<d.length;c++){$("#quizId2").val(d[c].id);$("#topicTitle").val(d[c].text);var b=d[c].options.split(";");$("#answerA").val(b[0]);$("#answerB").val(b[1]);$("#answerC").val(b[2]);$("#answerD").val(b[3]);$("#right"+d[c].answer).attr("checked","checked")}$("#editDetail").show();$("#queDetail").hide()}}})}function searchQuizDBQuestionForDraw(a){showRunning(8);$.ajax({type:"post",url:getPath()+"/quiz/item/query.do",data:"id="+a+"&startIdx=0&size=1000",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){searchQuizDBQuestionForDrawCallback(b,a)}})}function searchQuizDBQuestionForDrawCallback(c,a){var m=$("#quizDB"+a).is(":checked");var l,d,f;var g=document.getElementById("res"+a);while(g.rows.length>0){g.removeChild(g.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"searchQuizDBQuestion",0);l=g.insertRow(g.rows.length);d=l.insertCell(l.cells.length);d.colSpan=8;d.innerHTML=noRecord;l.style.height="200px"}else{var e=c.r;for(f=0;f<e.length;f++){if(e[f]!=null){l=g.insertRow(g.rows.length);l.className="td_int";d=l.insertCell(l.cells.length);d.innerHTML=c.s+f+1;d=l.insertCell(l.cells.length);d.innerHTML=e[f].text;var h=e[f].options.split(";");for(var k in h){var b=h[k];d=l.insertCell(l.cells.length);d.innerHTML=b}d=l.insertCell(l.cells.length);d.innerHTML=e[f].answer;d=l.insertCell(l.cells.length);if(m||quizArray[e[f].id]){d.innerHTML="<input type='checkbox' name='quiz' value='"+e[f].id+"' onclick='selectQuizDB("+a+")' class='quizDB"+a+"' checked='checked'>选择"}else{d.innerHTML="<input type='checkbox' name='quiz' value='"+e[f].id+"' onclick='selectQuizDB("+a+")' class='quizDB"+a+"'>选择"}}}}}function pageLinkSearch(a){$.ajax({type:"post",url:getPath()+"/pageLink/query.do?",data:"startIdx="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){pageLinkSearchCallback(b)}})}function pageLinkSearchCallback(c){var e,f,b;var a=document.getElementById("res");while(a.rows.length>0){a.removeChild(a.firstChild)}if(c==null||!(c.r instanceof Array)||c.r.length<1){drawPages(0,"pageLinkSearch",0);e=a.insertRow(a.rows.length);f=e.insertCell(e.cells.length);f.colSpan=5;f.innerHTML=noRecord;e.style.height="200px"}else{drawPages(c.c,"pageLinkSearch",c.s);var d=c.r;for(b=0;b<d.length;b++){if(d[b]!=null){e=a.insertRow(a.rows.length);e.className="td_int";f=e.insertCell(e.cells.length);f.innerHTML=d[b].weight;f=e.insertCell(e.cells.length);f.innerHTML=d[b].title;f=e.insertCell(e.cells.length);f.innerHTML=d[b].url;f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].createTime);f=e.insertCell(e.cells.length);f.innerHTML=formatDate(d[b].updateTime);f=e.insertCell(e.cells.length);f.innerHTML="<a href= 'javascript:updatePageLink("+d[b].id+")'>修改</a> &nbsp; <a href= 'javascript:delPageLink("+d[b].id+")'>删除</a>"}}}}function delPageLink(a){$.ajax({type:"post",url:getPath()+"/pageLink/delete.do?",data:"id="+a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){alert("删除成功");window.location=getPath()+"/html/pageLink.html"}})}function insertPageLink(){if($("#title").val().length==0){alert("标题不能为空");return}if($("#url").val().length==0){alert("链接不能为空");return}var a=$("#pageLinkForm").serialize();$.ajax({type:"post",url:getPath()+"/pageLink/add.do?",data:a,dataType:"json",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){alert("操作成功");window.location=getPath()+"/html/pageLink.html"}})};